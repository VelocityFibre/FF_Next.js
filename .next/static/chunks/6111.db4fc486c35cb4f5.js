(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[6111],{28434:(e,t,s)=>{"use strict";s.d(t,{NX:()=>d,T_:()=>m,_x:()=>p,processFile:()=>i,yG:()=>u});var a=s(12770),r=s(37085),l=s.n(r),n=s(16932);async function i(e,t){var s;let a=null==(s=e.name.split(".").pop())?void 0:s.toLowerCase();if("csv"===a)return o(e,t);if(["xlsx","xls"].includes(a||""))return c(e,t);throw Error("Unsupported file format. Please upload Excel (.xlsx, .xls) or CSV files.")}async function o(e,t){return new Promise((t,s)=>{let a=new FileReader;a.onload=e=>{var s;let a=null==(s=e.target)?void 0:s.result,r=l().parse(a,{header:!0,dynamicTyping:!0,skipEmptyLines:!0});r.errors.length>0&&n.Rm.warn("CSV parsing warnings:",{data:r.errors},"parser"),t(r.data)},a.onerror=()=>{s(Error("Failed to read file"))},a.readAsText(e)})}async function c(e,t){let s=await e.arrayBuffer(),r=a.LF(s,{type:"array",cellDates:!0,cellNF:!1,cellText:!1}),l=r.SheetNames[0],n=r.Sheets[l];return a.Wp.sheet_to_json(n,{raw:!1,dateNF:"yyyy-mm-dd"})}function d(e,t){for(let s of t){if(void 0!==e[s]&&null!==e[s]&&""!==e[s])return String(e[s]).trim();let t=Object.keys(e).find(e=>e.toLowerCase()===s.toLowerCase());if(t&&void 0!==e[t]&&null!==e[t]&&""!==e[t])return String(e[t]).trim()}}function m(e,t){let s=d(e,t);if(s){let e=parseFloat(s);return isNaN(e)?void 0:e}}function p(e,t){let s=d(e,t);if(s)try{let e=new Date(s);if(!isNaN(e.getTime()))return e.toISOString()}catch(e){n.Rm.warn("Failed to parse date:",{data:s},"parser")}}function u(e,t){let s=d(e,t);if(s){let e=s.toLowerCase();if(["yes","true","1","complete","completed"].includes(e))return!0;if(["no","false","0","incomplete","pending"].includes(e))return!1}}},32383:()=>{},50336:(e,t,s)=>{"use strict";s.r(t),s.d(t,{ProjectDetail:()=>eE});var a=s(37876),r=s(14232),l=s(88307),n=s(87212),i=s(67768),o=s(67914),c=s(82964),d=s(56939),m=s(79890),p=s(30409),u=s(99483),x=s(12770),h=s(28434);class g{static isValidPoleType(e){return["wood","concrete","steel","composite"].includes(e.toLowerCase())}static isValidPoleStatus(e){return["planned","installed","existing","removed"].includes(e.toLowerCase())}static isValidDateFormat(e){return!!e&&!isNaN(new Date(e).getTime())}static validateStatus(e,t){return e?t.includes(e.toLowerCase())?null:{field:"status",value:e,message:"Invalid status: ".concat(e,". Valid values: ").concat(t.join(", ")),severity:"error",code:"INVALID_STATUS"}:{field:"status",value:e,message:"Status is required",severity:"error",code:"MISSING_STATUS"}}}class y{static validateCoordinates(e,t){let s=[];return void 0!==e&&(e<-90||e>90)&&s.push({field:"latitude",value:e,message:"Invalid latitude: ".concat(e,". Must be between -90 and 90"),severity:"error",code:"INVALID_LATITUDE"}),void 0!==t&&(t<-180||t>180)&&s.push({field:"longitude",value:t,message:"Invalid longitude: ".concat(t,". Must be between -180 and 180"),severity:"error",code:"INVALID_LONGITUDE"}),s}static validateCoordinateQuality(e,t){let s=[];return e&&t&&e.toString()===t.toString()&&s.push({field:"coordinates",value:{latitude:e,longitude:t},message:"Latitude and longitude are identical - possible data entry error",severity:"warning",code:"SUSPICIOUS_COORDINATES"}),s}}class b{static validatePoleNumber(e){return e&&""!==e.trim()?/^[a-zA-Z0-9_-]+$/.test(e)?null:{field:"pole_number",value:e,message:"Invalid pole number format: ".concat(e,". Only alphanumeric characters, hyphens, and underscores allowed"),severity:"error",code:"INVALID_POLE_NUMBER_FORMAT"}:{field:"pole_number",value:e,message:"Pole number is required",severity:"error",code:"MISSING_POLE_NUMBER"}}static validateDropId(e){return e&&""!==e.trim()?/^[a-zA-Z0-9_-]+$/.test(e)?null:{field:"drop_id",value:e,message:"Invalid drop ID format: ".concat(e),severity:"error",code:"INVALID_DROP_ID_FORMAT"}:{field:"drop_id",value:e,message:"Drop ID is required",severity:"error",code:"MISSING_DROP_ID"}}static validateFibreLength(e){return null==e?null:e<=0?{field:"length",value:e,message:"Invalid fibre length: ".concat(e,". Must be greater than 0"),severity:"error",code:"INVALID_FIBRE_LENGTH"}:e>1e4?{field:"length",value:e,message:"Fibre length seems unusually large: ".concat(e,"m. Please verify"),severity:"warning",code:"LARGE_FIBRE_LENGTH"}:null}static validateFibreType(e){if(!e)return null;let t=["single_mode","multi_mode","armored","aerial","underground","direct_buried"];return t.includes(e.toLowerCase())?null:{field:"fibre_type",value:e,message:"Invalid fibre type: ".concat(e,". Valid types: ").concat(t.join(", ")),severity:"error",code:"INVALID_FIBRE_TYPE"}}static validateServiceType(e){if(!e)return null;let t=["residential","business","enterprise","government","backhaul","distribution"];return t.includes(e.toLowerCase())?null:{field:"service_type",value:e,message:"Invalid service type: ".concat(e,". Valid types: ").concat(t.join(", ")),severity:"warning",code:"INVALID_SERVICE_TYPE"}}static validateHeight(e){return null==e?null:e<0?{field:"height",value:e,message:"Invalid height: ".concat(e,". Cannot be negative"),severity:"error",code:"NEGATIVE_HEIGHT"}:e>100?{field:"height",value:e,message:"Height seems unusually large: ".concat(e,"m. Please verify"),severity:"warning",code:"LARGE_HEIGHT"}:null}static validateAddress(e){return e&&""!==e.trim()?e.length<5?{field:"address",value:e,message:'Address too short: "'.concat(e,'". Minimum 5 characters'),severity:"warning",code:"SHORT_ADDRESS"}:e.length>200?{field:"address",value:e,message:"Address too long: ".concat(e.length," characters. Maximum 200 characters"),severity:"error",code:"LONG_ADDRESS"}:null:null}static validateInstallationDate(e){if(!e)return null;if(!g.isValidDateFormat(e))return{field:"installation_date",value:e,message:"Invalid date format: ".concat(e),severity:"error",code:"INVALID_DATE_FORMAT"};let t=new Date(e),s=new Date,a=new Date;if(a.setFullYear(s.getFullYear()+2),t>a)return{field:"installation_date",value:e,message:"Installation date is too far in the future: ".concat(e),severity:"warning",code:"FUTURE_DATE"};let r=new Date;return(r.setFullYear(s.getFullYear()-50),t<r)?{field:"installation_date",value:e,message:"Installation date is too far in the past: ".concat(e),severity:"warning",code:"VERY_OLD_DATE"}:null}}class f{static categorizeError(e){if(e.includes("latitude")||e.includes("longitude")||e.includes("coordinate"))return"Geographic";if(e.includes("date")||e.includes("Date"))return"Temporal";if(e.includes("required")||e.includes("Missing"))return"Required Fields";if(e.includes("format")||e.includes("Invalid"))return"Format/Type";if(e.includes("duplicate")||e.includes("Duplicate"))return"Duplicates";else if(e.includes("reference")||e.includes("orphaned"))return"References";else return"Other"}static getErrorSeverity(e){return["MISSING_POLE_NUMBER","MISSING_DROP_ID","INVALID_LATITUDE","INVALID_LONGITUDE","NEGATIVE_HEIGHT","INVALID_DATE_FORMAT"].includes(e)?"error":["LARGE_FIBRE_LENGTH","LARGE_HEIGHT","FUTURE_DATE","VERY_OLD_DATE","SHORT_ADDRESS","INVALID_SERVICE_TYPE"].includes(e)?"warning":"info"}}class j{static checkDataQuality(e){let t=[];return e.latitude&&e.longitude&&e.latitude.toString()===e.longitude.toString()&&t.push({field:"coordinates",value:{latitude:e.latitude,longitude:e.longitude},message:"Latitude and longitude are identical - possible data entry error",severity:"warning",code:"SUSPICIOUS_COORDINATES"}),t.push(...this.checkPlaceholderValues(e)),t}static checkPlaceholderValues(e){let t=[],s=["test","placeholder","tbd","n/a","unknown",""];return Object.entries(e).forEach(e=>{let[a,r]=e;"string"==typeof r&&s.includes(r.toLowerCase())&&t.push({field:a,value:r,message:'Field contains placeholder value: "'.concat(r,'"'),severity:"info",code:"PLACEHOLDER_VALUE"})}),t}static checkMissingCriticalFields(e,t){let s=[];return t.forEach(t=>{e[t]&&("string"!=typeof e[t]||""!==e[t].trim())||s.push({field:t,value:e[t],message:'Critical field "'.concat(t,'" is missing or empty'),severity:"error",code:"MISSING_CRITICAL_FIELD"})}),s}static checkDataConsistency(e){let t=[];return e.installation_date&&e.planning_date&&new Date(e.installation_date)<new Date(e.planning_date)&&t.push({field:"installation_date",value:e.installation_date,message:"Installation date cannot be before planning date",severity:"error",code:"INCONSISTENT_DATES"}),"installed"!==e.status||e.installation_date||t.push({field:"installation_date",value:e.installation_date,message:'Installation date is required when status is "installed"',severity:"warning",code:"MISSING_INSTALLATION_DATE"}),t}}class v{static isValidPoleType(e){return g.isValidPoleType(e)}static isValidPoleStatus(e){return g.isValidPoleStatus(e)}static isValidDateFormat(e){return g.isValidDateFormat(e)}static validateStatus(e,t){return g.validateStatus(e,t)}static validateCoordinates(e,t){return y.validateCoordinates(e,t)}static validatePoleNumber(e){return b.validatePoleNumber(e)}static validateDropId(e){return b.validateDropId(e)}static validateFibreLength(e){return b.validateFibreLength(e)}static validateFibreType(e){return b.validateFibreType(e)}static validateServiceType(e){return b.validateServiceType(e)}static validateHeight(e){return b.validateHeight(e)}static validateAddress(e){return b.validateAddress(e)}static validateInstallationDate(e){return b.validateInstallationDate(e)}static categorizeError(e){return f.categorizeError(e)}static getErrorSeverity(e){return f.getErrorSeverity(e)}static checkDataQuality(e){return j.checkDataQuality(e)}}var N=s(16932);class _{static validatePoles(e){let t=[],s=[],a=[],r=new Set;for(let l of e){let e=[],n=v.validatePoleNumber(l.pole_number);n?e.push(n):r.has(l.pole_number)?e.push({field:"pole_number",value:l.pole_number,message:"Duplicate pole number: ".concat(l.pole_number),severity:"error",code:"DUPLICATE_POLE_NUMBER"}):r.add(l.pole_number);let i=v.validateCoordinates(l.latitude,l.longitude);e.push(...i),l.pole_type&&!v.isValidPoleType(l.pole_type)&&e.push({field:"pole_type",value:l.pole_type,message:"Invalid pole type: ".concat(l.pole_type),severity:"error",code:"INVALID_POLE_TYPE"}),l.status&&!v.isValidPoleStatus(l.status)&&e.push({field:"status",value:l.status,message:"Invalid pole status: ".concat(l.status),severity:"error",code:"INVALID_POLE_STATUS"});let o=l.height?parseFloat(l.height):void 0,c=v.validateHeight(isNaN(o)?void 0:o);c&&e.push(c);let d=v.validateAddress(l.address);d&&e.push(d);let m=v.validateInstallationDate(l.installation_date);m&&e.push(m);let p=v.checkDataQuality(l);e.push(...p),0===e.length?t.push(l):(s.push({...l,errors:e}),a.push(...e.map(e=>"Pole ".concat(l.pole_number,": ").concat(e.message))))}return{valid:t,invalid:s,errors:a}}static validateDrops(e){let t=[],s=[],a=[],r=new Set;for(let l of e){let e=[],n=v.validateDropId(l.drop_number);n?e.push(n):r.has(l.drop_number)?e.push({field:"drop_number",value:l.drop_number,message:"Duplicate drop number: ".concat(l.drop_number),severity:"error",code:"DUPLICATE_DROP_NUMBER"}):r.add(l.drop_number);let i=v.validateCoordinates(l.latitude,l.longitude);if(e.push(...i),l.cable_length){let t=parseFloat(l.cable_length);if(!isNaN(t)){let s=v.validateFibreLength(t);s&&e.push(s)}}let o=v.validateServiceType(l.service_type);o&&e.push(o);let c=v.validateAddress(l.address);c&&e.push(c);let d=v.checkDataQuality(l);e.push(...d),l.pole_number||N.Rm.warn("Drop ".concat(l.drop_number," has no pole assignment"),void 0,"sow-validator"),0===e.length?t.push(l):(s.push({...l,errors:e}),a.push(...e.map(e=>"Drop ".concat(l.drop_number,": ").concat(e.message))))}return{valid:t,invalid:s,errors:a}}static validateFibre(e){let t=[],s=[],a=[],r=new Set;for(let l of e){let e=[];l.segment_id?r.has(l.segment_id)?e.push({field:"segment_id",value:l.segment_id,message:"Duplicate segment ID: ".concat(l.segment_id),severity:"error",code:"DUPLICATE_SEGMENT_ID"}):r.add(l.segment_id):e.push({field:"segment_id",value:l.segment_id,message:"Missing segment ID",severity:"error",code:"MISSING_SEGMENT_ID"});let n=v.validateFibreLength(l.length);n&&e.push(n);let i=v.validateFibreLength(l.string_completed);i&&e.push({...i,field:"string_completed",message:i.message.replace("fibre length","string completed length")}),void 0!==l.length&&void 0!==l.string_completed&&l.string_completed>l.length&&e.push({field:"string_completed",value:{length:l.length,string_completed:l.string_completed},message:"String completed (".concat(l.string_completed,") exceeds total length (").concat(l.length,")"),severity:"error",code:"STRING_EXCEEDS_LENGTH"});let o=v.validateFibreType(l.fibre_type);o&&e.push(o);let c=v.validateInstallationDate(l.date_completed);c&&e.push({...c,field:"date_completed"});let d=v.checkDataQuality(l);e.push(...d),0===e.length?t.push(l):(s.push({...l,errors:e}),a.push(...e.map(e=>"Segment ".concat(l.segment_id,": ").concat(e.message))))}return{valid:t,invalid:s,errors:a}}static validateData(e,t){switch(t){case"poles":return this.validatePoles(e);case"drops":return this.validateDrops(e);case"fibre":return this.validateFibre(e);default:throw Error("Unsupported data type: ".concat(t))}}static crossValidateData(e,t){let s=new Set(e.map(e=>e.pole_number)),a=[],r=[],l=[],n=0,i=0;for(let e of t)e.pole_number&&(s.has(e.pole_number)?n++:(i++,a.push(e),r.includes(e.pole_number)||r.push(e.pole_number),l.push({dropId:e.drop_number,poleNumber:e.pole_number,issue:"References non-existent pole"})));return{orphanedDrops:a,missingPoles:r,inconsistentReferences:l,summary:{totalDrops:t.length,validReferences:n,invalidReferences:i}}}}class w{async processFile(e,t){let{processFile:a}=await Promise.resolve().then(s.bind(s,28434));return a(e,t)}processPoles(e){let t=[];for(let s of e){let e=(0,h.NX)(s,["label_1","label","pole_number","pole_id"]);if(!e)continue;let a={pole_number:e,latitude:(0,h.T_)(s,["lat","latitude","y","coord_y"])||void 0,longitude:(0,h.T_)(s,["lon","longitude","lng","x","coord_x"])||void 0,status:(0,h.NX)(s,["status","pole_status"])||"planned",pole_type:(0,h.NX)(s,["type_1","type","pole_type"]),pole_spec:(0,h.NX)(s,["spec_1","spec","specification"]),height:(0,h.NX)(s,["dim1","height","pole_height"]),diameter:(0,h.NX)(s,["dim2","diameter","pole_diameter"]),owner:(0,h.NX)(s,["cmpownr","owner","company_owner"]),pon_no:(0,h.T_)(s,["pon_no","pon","pon_number"]),zone_no:(0,h.T_)(s,["zone_no","zone","zone_number"]),address:(0,h.NX)(s,["address","location","pole_address"]),municipality:(0,h.NX)(s,["mun","municipality","city"]),created_date:(0,h._x)(s,["datecrtd","created_date","date_created"]),created_by:(0,h.NX)(s,["crtdby","created_by","creator"]),comments:(0,h.NX)(s,["comments","notes","remarks"]),raw_data:s};t.push(a)}return t}processDrops(e){let t=[];for(let s of e){let e=(0,h.NX)(s,["label","drop_number","drop_id","drop_label"]);if(!e)continue;let a={drop_number:e,pole_number:(0,h.NX)(s,["strtfeat","start_feature","pole_number","from_pole"])||"",cable_type:(0,h.NX)(s,["type","cable_type"]),cable_spec:(0,h.NX)(s,["spec","specification","cable_spec"]),cable_length:(0,h.NX)(s,["dim2","length","cable_length","distance"]),cable_capacity:(0,h.NX)(s,["cblcpty","capacity","cable_capacity"]),start_point:(0,h.NX)(s,["strtfeat","start_feature","from"]),end_point:(0,h.NX)(s,["endfeat","end_feature","to"]),latitude:(0,h.T_)(s,["lat","latitude","y"]),longitude:(0,h.T_)(s,["lon","longitude","lng","x"]),address:(0,h.NX)(s,["address","location","drop_address"]),pon_no:(0,h.T_)(s,["pon_no","pon","pon_number"]),zone_no:(0,h.T_)(s,["zone_no","zone","zone_number"]),municipality:(0,h.NX)(s,["mun","municipality","city"]),created_date:(0,h._x)(s,["datecrtd","created_date","date_created"]),created_by:(0,h.NX)(s,["crtdby","created_by","creator"]),raw_data:s};t.push(a)}return t}processFibre(e){let t=[];for(let s of e){let e=(0,h.NX)(s,["label","segment_id","fibre_id","cable_id"]);if(!e)continue;let a={segment_id:e,cable_size:(0,h.NX)(s,["cable size","cable_size","size","capacity"])||"",layer:(0,h.NX)(s,["layer","cable_layer","type"])||"",length:(0,h.T_)(s,["length","distance","cable_length"])||0,pon_no:(0,h.T_)(s,["pon_no","pon","pon_number"]),zone_no:(0,h.T_)(s,["zone_no","zone","zone_number"]),string_completed:(0,h.T_)(s,["String Com","string_completed","completed_length"]),date_completed:(0,h._x)(s,["Date Comp","date_completed","completion_date"]),contractor:(0,h.NX)(s,["Contractor","contractor","contractor_name"]),is_complete:(0,h.yG)(s,["Complete","is_complete","completed"]),raw_data:s};t.push(a)}return t}validatePoles(e){return _.validatePoles(e)}validateDrops(e){return _.validateDrops(e)}validateFibre(e){return _.validateFibre(e)}}let S=new w;var D=s(71624);class I{async initializeTables(e){try{return{success:(await D.s.initializeTables(e)).success}}catch(e){return N.Rm.error("Failed to initialize SOW tables",{data:e},"ApiSOWService"),{success:!1}}}async uploadPoles(e,t){try{let s=await D.s.uploadPoles(e,t);return{success:s.success,message:s.message||"Uploaded ".concat(s.upserted||0," poles"),count:s.upserted||0,errors:s.errors||[]}}catch(e){return N.Rm.error("Failed to upload poles",{data:e},"ApiSOWService"),{success:!1,message:"Failed to upload poles",errors:[e instanceof Error?e.message:"Unknown error"]}}}async uploadDrops(e,t){try{let s=await D.s.uploadDrops(e,t);return{success:s.success,message:s.message||"Uploaded ".concat(s.upserted||0," drops"),count:s.upserted||0,errors:s.errors||[]}}catch(e){return N.Rm.error("Failed to upload drops",{data:e},"ApiSOWService"),{success:!1,message:"Failed to upload drops",errors:[e instanceof Error?e.message:"Unknown error"]}}}async uploadFibre(e,t){try{let s=await D.s.uploadFibre(e,t);return{success:s.success,message:s.message||"Uploaded ".concat(s.upserted||0," fibre sections"),count:s.upserted||0,errors:s.errors||[]}}catch(e){return N.Rm.error("Failed to upload fibre",{data:e},"ApiSOWService"),{success:!1,message:"Failed to upload fibre",errors:[e instanceof Error?e.message:"Unknown error"]}}}async getProjectSOWData(e){try{return await D.s.getProjectSOWData(e)}catch(e){return N.Rm.error("Failed to get project SOW data",{data:e},"ApiSOWService"),{success:!1,error:e instanceof Error?e.message:"Unknown error",data:null}}}async getPoles(e){try{return(await D.s.getPoles(e)).data||[]}catch(e){return N.Rm.error("Failed to get poles",{data:e},"ApiSOWService"),[]}}async getDrops(e){try{return(await D.s.getDrops(e)).data||[]}catch(e){return N.Rm.error("Failed to get drops",{data:e},"ApiSOWService"),[]}}async getFibre(e){try{return(await D.s.getFibre(e)).data||[]}catch(e){return N.Rm.error("Failed to get fibre",{data:e},"ApiSOWService"),[]}}async checkHealth(){try{return await D.s.checkHealth()}catch(e){return N.Rm.error("Failed to check SOW service health",{data:e},"ApiSOWService"),{success:!1,error:"Service unavailable"}}}}let E=new I;class A{async initializeTables(e){return this.service.initializeTables(e)}async uploadPoles(e,t){return this.service.uploadPoles(e,t)}async uploadDrops(e,t){return this.service.uploadDrops(e,t)}async uploadFibre(e,t){return this.service.uploadFibre(e,t)}async updateProjectSummary(e){let{SOWSummaryService:t}=await s.e(8067).then(s.bind(s,68067));return t.updateProjectSummary(e)}async getProjectSOWData(e){return this.service.getProjectSOWData(e)}async checkHealth(){return this.service.checkHealth()}constructor(){this.service=E}}let T=new A;var P=s(36535),C=s(18935),F=s(55194),k=s(30449),L=s(21271),O=s(30155),U=s(46618),R=s(98960);function M(e){let{fileType:t,uploadedFile:s,isProcessing:r,onFileUpload:l,onRemoveFile:n,onDownloadTemplate:i}=e,o=t.icon;return(0,a.jsxs)("div",{className:(0,R.cn)("rounded-lg border-2 border-dashed p-6 transition-colors",(null==s?void 0:s.status)==="success"?"".concat(t.bgColor," ").concat(t.borderColor):(null==s?void 0:s.status)==="error"?"bg-error-50 border-error-200":"border-[var(--ff-border-secondary)] hover:border-[var(--ff-border-primary)]"),children:[(0,a.jsxs)("div",{className:"flex items-start justify-between mb-4",children:[(0,a.jsx)("div",{className:(0,R.cn)("p-2 rounded-lg",t.bgColor),children:(0,a.jsx)(o,{className:(0,R.cn)("w-6 h-6",t.color)})}),s&&(0,a.jsx)("button",{onClick:()=>n(t.type),className:"p-1 hover:bg-[var(--ff-surface-secondary)] rounded",children:(0,a.jsx)(P.A,{className:"w-4 h-4 text-[var(--ff-text-tertiary)]"})})]}),(0,a.jsx)("h3",{className:"font-medium text-[var(--ff-text-primary)] mb-1",children:t.title}),(0,a.jsx)("p",{className:"text-sm text-[var(--ff-text-secondary)] mb-4",children:t.description}),s?(0,a.jsx)(G,{uploadedFile:s}):(0,a.jsx)(W,{fileType:t,isProcessing:r,onFileUpload:l,onDownloadTemplate:i})]})}function G(e){let{uploadedFile:t}=e;return(0,a.jsxs)("div",{className:"space-y-3",children:[(0,a.jsxs)("div",{className:"flex items-center gap-2",children:[(0,a.jsx)(C.A,{className:"w-4 h-4 text-[var(--ff-text-tertiary)]"}),(0,a.jsx)("span",{className:"text-sm text-[var(--ff-text-primary)] truncate",children:t.file.name})]}),"processing"===t.status&&(0,a.jsxs)("div",{className:"flex items-center gap-2",children:[(0,a.jsx)(F.A,{className:"w-4 h-4 animate-spin text-primary-500"}),(0,a.jsx)("span",{className:"text-sm text-[var(--ff-text-secondary)]",children:"Processing..."})]}),"success"===t.status&&t.summary&&(0,a.jsxs)("div",{className:"bg-success-50 rounded-lg p-3",children:[(0,a.jsxs)("div",{className:"flex items-center gap-2 mb-2",children:[(0,a.jsx)(k.A,{className:"w-4 h-4 text-success-600"}),(0,a.jsx)("span",{className:"text-sm font-medium text-success-900",children:"Successfully processed"})]}),(0,a.jsxs)("div",{className:"text-xs text-success-700 space-y-1",children:[(0,a.jsxs)("p",{children:["Total rows: ",t.summary.total]}),(0,a.jsxs)("p",{children:["Valid: ",t.summary.valid]}),t.summary.invalid>0&&(0,a.jsxs)("p",{children:["Skipped: ",t.summary.invalid]})]}),t.summary.warnings&&t.summary.warnings.length>0&&(0,a.jsxs)("details",{className:"mt-2",children:[(0,a.jsxs)("summary",{className:"text-xs text-warning-600 cursor-pointer",children:[t.summary.warnings.length," warnings"]}),(0,a.jsxs)("div",{className:"mt-1 text-xs text-warning-600 max-h-20 overflow-y-auto",children:[t.summary.warnings.slice(0,5).map((e,t)=>(0,a.jsx)("p",{children:e},t)),t.summary.warnings.length>5&&(0,a.jsxs)("p",{children:["... and ",t.summary.warnings.length-5," more"]})]})]})]}),"error"===t.status&&(0,a.jsx)("div",{className:"bg-error-50 rounded-lg p-3",children:(0,a.jsxs)("div",{className:"flex items-start gap-2",children:[(0,a.jsx)(L.A,{className:"w-4 h-4 text-error-600 mt-0.5"}),(0,a.jsxs)("div",{children:[(0,a.jsx)("p",{className:"text-sm font-medium text-error-900",children:"Upload failed"}),(0,a.jsx)("p",{className:"text-xs text-error-700 mt-1",children:t.message})]})]})})]})}function W(e){let{fileType:t,isProcessing:s,onFileUpload:r,onDownloadTemplate:l}=e;return(0,a.jsxs)("div",{className:"space-y-3",children:[(0,a.jsxs)("label",{className:"block",children:[(0,a.jsx)("input",{type:"file",accept:".xlsx,.xls,.csv",onChange:e=>r(t.type,e),className:"hidden",disabled:s}),(0,a.jsxs)("div",{className:(0,R.cn)("flex items-center justify-center gap-2 px-4 py-2 text-sm font-medium rounded-lg transition-colors cursor-pointer",s?"bg-[var(--ff-surface-secondary)] text-[var(--ff-text-tertiary)] cursor-not-allowed":"bg-primary-600 text-white hover:bg-primary-700"),children:[(0,a.jsx)(O.A,{className:"w-4 h-4"}),"Upload File"]})]}),(0,a.jsxs)("button",{onClick:l,className:"w-full flex items-center justify-center gap-2 px-4 py-2 text-sm text-primary-600 hover:text-primary-700 hover:bg-primary-50 rounded-lg transition-colors",children:[(0,a.jsx)(U.A,{className:"w-4 h-4"}),"Download Template"]})]})}function V(e){let{files:t,allFilesUploaded:s,onComplete:r,showActions:l}=e;return 0===t.length?null:(0,a.jsxs)(a.Fragment,{children:[(0,a.jsxs)("div",{className:"bg-[var(--ff-background-secondary)] rounded-lg p-4",children:[(0,a.jsx)("h4",{className:"text-sm font-medium text-[var(--ff-text-primary)] mb-3",children:"Upload Summary"}),(0,a.jsx)("div",{className:"space-y-2",children:t.map(e=>(0,a.jsxs)("div",{className:"flex items-center justify-between text-sm",children:[(0,a.jsxs)("span",{className:"text-[var(--ff-text-secondary)] capitalize",children:[e.type,":"]}),(0,a.jsx)("span",{className:(0,R.cn)("font-medium","success"===e.status?"text-success-600":"error"===e.status?"text-error-600":"processing"===e.status?"text-primary-600":"text-[var(--ff-text-tertiary)]"),children:"success"===e.status&&e.data?"".concat(e.data.length," items"):"error"===e.status?"Failed":"processing"===e.status?"Processing...":"Pending"})]},e.type))})]}),l&&s&&r&&(0,a.jsx)("div",{className:"flex justify-end",children:(0,a.jsxs)("button",{onClick:r,className:"inline-flex items-center px-6 py-2 text-sm font-medium text-white bg-success-600 rounded-lg hover:bg-success-700 focus:outline-none focus:ring-2 focus:ring-success-500",children:[(0,a.jsx)(k.A,{className:"w-4 h-4 mr-2"}),"Continue with SOW Data"]})})]})}let H=[{type:"poles",title:"Poles Data",description:"Excel file with pole numbers, coordinates, and capacity",icon:null,color:"text-blue-600",bgColor:"bg-blue-50",borderColor:"border-blue-200",requiredColumns:["pole_number","latitude","longitude"],sampleData:[{pole_number:"P001",latitude:-33.9249,longitude:18.4241,max_drops:12},{pole_number:"P002",latitude:-33.9251,longitude:18.4243,max_drops:12}]},{type:"drops",title:"Drops Data",description:"Excel file with drop numbers, addresses, and pole assignments",icon:null,color:"text-green-600",bgColor:"bg-green-50",borderColor:"border-green-200",requiredColumns:["drop_number","pole_number","address"],sampleData:[{drop_number:"D001",pole_number:"P001",address:"123 Main St",status:"planned"},{drop_number:"D002",pole_number:"P001",address:"125 Main St",status:"planned"}]},{type:"fibre",title:"Fibre Scope",description:"Excel file with cable segments, distances, and types",icon:null,color:"text-purple-600",bgColor:"bg-purple-50",borderColor:"border-purple-200",requiredColumns:["segment_id","from_point","to_point","distance"],sampleData:[{segment_id:"S001",from_point:"P001",to_point:"P002",distance:150,cable_type:"aerial"},{segment_id:"S002",from_point:"P002",to_point:"P003",distance:200,cable_type:"underground"}]}];function X(e){let{projectId:t,onComplete:s,onDataUpdate:l,showActions:n=!0}=e,{files:o,isProcessing:h,handleFileUpload:g,removeFile:y,downloadTemplate:b}=function(e,t){let[s,a]=(0,r.useState)([]),[l,n]=(0,r.useState)(!1),o=function(){let e=(0,i.jE)();return{saveSOWData:async(t,s,a)=>{let r=(0,c.wP)(d.db),l=(0,c.H9)(d.db,"projects",t,"sow",s);r.set(l,{type:s,data:a,uploadedAt:new Date,itemCount:a.length}),"poles"===s?a.forEach(e=>{let s=(0,c.H9)(d.db,"projects",t,"poles",e.pole_number);r.set(s,{...e,projectId:t,createdAt:new Date})}):"drops"===s?a.forEach(e=>{let s=(0,c.H9)(d.db,"projects",t,"drops",e.drop_number);r.set(s,{...e,projectId:t,createdAt:new Date})}):"fibre"===s&&a.forEach(e=>{let s=(0,c.H9)(d.db,"projects",t,"fibre",e.segment_id);r.set(s,{...e,projectId:t,createdAt:new Date})}),await r.commit(),e.invalidateQueries({queryKey:["sow",t]}),e.invalidateQueries({queryKey:["project",t]})},getSOWData:async(e,t)=>{if(t){let s=(0,c.H9)(d.db,"projects",e,"sow",t),a=await (0,c.x7)(s);return a.exists()?a.data():null}{let t=(0,c.rJ)(d.db,"projects",e,"sow");return(await (0,c.GG)(t)).docs.map(e=>({id:e.id,...e.data()}))}},deleteSOWData:async(t,s)=>{let a=(0,c.wP)(d.db),r=(0,c.H9)(d.db,"projects",t,"sow",s);a.delete(r);let l="";if("poles"===s?l="poles":"drops"===s?l="drops":"fibre"===s&&(l="fibre"),l){let e=(0,c.rJ)(d.db,"projects",t,l);(await (0,c.GG)(e)).docs.forEach(e=>{a.delete(e.ref)})}await a.commit(),e.invalidateQueries({queryKey:["sow",t]}),e.invalidateQueries({queryKey:["project",t]})}}}(),m=(e,t,s,r,l)=>{a(a=>a.map(a=>a.type===e?{...a,status:t,message:s,data:r,summary:l}:a))},p=async(t,s)=>{try{await o.saveSOWData(e,t,s)}catch(e){throw N.Rm.error("Error saving ".concat(t," to Firebase:"),{data:e},"useSOWUpload"),e}},u=async a=>{n(!0);try{let r;m(a.type,"processing","Reading file...");let l=await S.processFile(a.file,a.type);if(!l||0===l.length){m(a.type,"error","File is empty or has invalid format"),n(!1);return}m(a.type,"processing","Processing data...");let i=[],o={invalid:[],errors:[]};switch(a.type){case"poles":{let e=S.processPoles(l);i=(o=S.validatePoles(e)).valid;break}case"drops":{let e=S.processDrops(l);i=(o=S.validateDrops(e)).valid;break}case"fibre":{let e=S.processFibre(l);i=(o=S.validateFibre(e)).valid}}if(0===i.length){m(a.type,"error","No valid data found in file"),n(!1);return}switch(m(a.type,"processing","Initializing database..."),await T.initializeTables(e),m(a.type,"processing","Uploading ".concat(i.length," items to database...")),a.type){case"poles":r=await T.uploadPoles(e,i);break;case"drops":r=await T.uploadDrops(e,i);break;case"fibre":r=await T.uploadFibre(e,i)}if(await p(a.type,i),m(a.type,"success",(null==r?void 0:r.message)||"Data uploaded successfully",i,{total:l.length,valid:i.length,invalid:o.invalid.length,warnings:o.errors.length>0?o.errors:void 0}),t){let e=s.reduce((e,t)=>(t.data&&(e[t.type]=t.data),e),{});e[a.type]=i,t(e)}}catch(e){N.Rm.error("Error processing ".concat(a.type," file:"),{data:e},"useSOWUpload"),m(a.type,"error","Failed to process file: ".concat(e instanceof Error?e.message:"Unknown error"))}finally{n(!1)}};return{files:s,isProcessing:l,handleFileUpload:async(e,t)=>{var s;let r=null==(s=t.target.files)?void 0:s[0];if(!r)return;a(t=>t.filter(t=>t.type!==e));let l={type:e,file:r,status:"pending"};a(e=>[...e,l]),await u(l)},removeFile:e=>{a(t=>t.filter(t=>t.type!==e))},downloadTemplate:e=>{let t=x.Wp.json_to_sheet(e.sampleData),s=x.Wp.book_new();x.Wp.book_append_sheet(s,t,"Template"),x._h(s,"".concat(e.type,"_template.xlsx"))}}}(t,l),f=H.map(e=>({...e,icon:"poles"===e.type?m.A:"drops"===e.type?p.A:u.A})),j=f.every(e=>o.find(t=>t.type===e.type&&"success"===t.status));return(0,a.jsxs)("div",{className:"space-y-6",children:[(0,a.jsx)("div",{className:"grid grid-cols-1 lg:grid-cols-3 gap-4",children:f.map(e=>{let t=o.find(t=>t.type===e.type);return(0,a.jsx)(M,{fileType:e,...t&&{uploadedFile:t},isProcessing:h,onFileUpload:g,onRemoveFile:y,onDownloadTemplate:()=>b(e)},e.type)})}),(0,a.jsx)(V,{files:o,allFilesUploaded:j,...s&&{onComplete:s},showActions:n})]})}var B=s(35711);function z(e){let{onImportClick:t}=e;return(0,a.jsx)("div",{className:"bg-white rounded-lg shadow-sm border border-gray-200 p-8",children:(0,a.jsxs)("div",{className:"text-center",children:[(0,a.jsx)(B.A,{className:"h-12 w-12 text-gray-400 mx-auto mb-4"}),(0,a.jsx)("h3",{className:"text-lg font-medium text-gray-900 mb-2",children:"No SOW Data Found"}),(0,a.jsx)("p",{className:"text-gray-500 mb-6",children:"This project doesn't have any Scope of Work data yet."}),(0,a.jsxs)("button",{onClick:t,className:"inline-flex items-center px-6 py-3 text-sm font-medium text-white bg-primary-600 rounded-lg hover:bg-primary-700 focus:outline-none focus:ring-2 focus:ring-primary-500",children:[(0,a.jsx)(O.A,{className:"w-4 h-4 mr-2"}),"Import SOW Data"]}),(0,a.jsx)("div",{className:"mt-4",children:(0,a.jsx)("p",{className:"text-sm text-gray-500",children:"Upload Excel files containing poles, drops, and fibre scope data"})})]})})}var q=s(97730);function K(e){let{hasData:t,onUpdateClick:s}=e;return(0,a.jsx)("div",{className:"p-6 border-b border-gray-200",children:(0,a.jsxs)("div",{className:"flex items-center justify-between",children:[(0,a.jsxs)("div",{className:"flex items-center",children:[(0,a.jsx)(B.A,{className:"h-6 w-6 text-primary-600 mr-3"}),(0,a.jsxs)("div",{children:[(0,a.jsx)("h2",{className:"text-lg font-semibold text-gray-900",children:"Scope of Work Data"}),(0,a.jsx)("p",{className:"text-sm text-gray-600",children:"Project SOW data management"})]})]}),t&&(0,a.jsxs)("button",{onClick:s,className:"inline-flex items-center px-4 py-2 text-sm font-medium text-primary-600 hover:text-primary-700 hover:bg-primary-50 rounded-lg transition-colors",children:[(0,a.jsx)(q.A,{className:"w-4 h-4 mr-2"}),"Update Data"]})]})})}var J=s(89183);function Q(e){let{activeTab:t,onTabChange:s,polesCount:r,dropsCount:l,fibreCount:n}=e,i=[{id:"summary",label:"Summary",icon:J.A},{id:"poles",label:"Poles (".concat(r,")"),icon:m.A},{id:"drops",label:"Drops (".concat(l,")"),icon:p.A},{id:"fibre",label:"Fibre (".concat(n,")"),icon:u.A},{id:"upload",label:"Import/Update",icon:O.A}];return(0,a.jsx)("div",{className:"border-b border-gray-200",children:(0,a.jsx)("nav",{className:"-mb-px flex space-x-8 px-6",children:i.map(e=>{let r=e.icon;return(0,a.jsxs)("button",{onClick:()=>s(e.id),className:(0,R.cn)("py-2 px-1 border-b-2 font-medium text-sm flex items-center transition-colors",t===e.id?"border-primary-500 text-primary-600":"border-transparent text-gray-500 hover:text-gray-700 hover:border-gray-300"),children:[(0,a.jsx)(r,{className:"h-4 w-4 mr-2"}),e.label]},e.id)})})})}function Y(e){let{polesCount:t,dropsCount:s,fibreCount:r}=e;return(0,a.jsxs)("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-6",children:[(0,a.jsx)("div",{className:"bg-blue-50 border border-blue-200 rounded-lg p-4",children:(0,a.jsxs)("div",{className:"flex items-center",children:[(0,a.jsx)(m.A,{className:"h-8 w-8 text-blue-600 mr-3"}),(0,a.jsxs)("div",{children:[(0,a.jsx)("h3",{className:"text-lg font-semibold text-blue-900",children:"Poles"}),(0,a.jsx)("p",{className:"text-2xl font-bold text-blue-600",children:t}),(0,a.jsx)("p",{className:"text-sm text-blue-700",children:"Infrastructure poles"})]})]})}),(0,a.jsx)("div",{className:"bg-green-50 border border-green-200 rounded-lg p-4",children:(0,a.jsxs)("div",{className:"flex items-center",children:[(0,a.jsx)(p.A,{className:"h-8 w-8 text-green-600 mr-3"}),(0,a.jsxs)("div",{children:[(0,a.jsx)("h3",{className:"text-lg font-semibold text-green-900",children:"Drops"}),(0,a.jsx)("p",{className:"text-2xl font-bold text-green-600",children:s}),(0,a.jsx)("p",{className:"text-sm text-green-700",children:"Home connections"})]})]})}),(0,a.jsx)("div",{className:"bg-purple-50 border border-purple-200 rounded-lg p-4",children:(0,a.jsxs)("div",{className:"flex items-center",children:[(0,a.jsx)(u.A,{className:"h-8 w-8 text-purple-600 mr-3"}),(0,a.jsxs)("div",{children:[(0,a.jsx)("h3",{className:"text-lg font-semibold text-purple-900",children:"Fibre"}),(0,a.jsx)("p",{className:"text-2xl font-bold text-purple-600",children:r}),(0,a.jsx)("p",{className:"text-sm text-purple-700",children:"Cable segments"})]})]})})]})}function Z(e){var t;let{sowData:s,polesCount:r,dropsCount:l,fibreCount:n}=e;return(0,a.jsxs)("div",{className:"bg-gray-50 rounded-lg p-4",children:[(0,a.jsx)("h4",{className:"font-medium text-gray-900 mb-3",children:"Data Status"}),(0,a.jsxs)("div",{className:"grid grid-cols-2 gap-4 text-sm",children:[(0,a.jsxs)("div",{children:[(0,a.jsx)("span",{className:"text-gray-600",children:"Source:"}),(0,a.jsx)("span",{className:"ml-2 font-medium",children:"Firebase Firestore"})]}),(0,a.jsxs)("div",{children:[(0,a.jsx)("span",{className:"text-gray-600",children:"Last Updated:"}),(0,a.jsx)("span",{className:"ml-2 font-medium",children:(null==s||null==(t=s.poles)?void 0:t.uploadedAt)?new Date(s.poles.uploadedAt).toLocaleDateString():"Unknown"})]}),(0,a.jsxs)("div",{children:[(0,a.jsx)("span",{className:"text-gray-600",children:"Total Items:"}),(0,a.jsx)("span",{className:"ml-2 font-medium",children:r+l+n})]}),(0,a.jsxs)("div",{children:[(0,a.jsx)("span",{className:"text-gray-600",children:"Status:"}),(0,a.jsxs)("span",{className:"ml-2 font-medium text-green-600",children:[(0,a.jsx)(k.A,{className:"inline w-4 h-4 mr-1"}),"Active"]})]})]})]})}function $(e){let{poles:t,drops:s}=e;if(0===t.length)return null;let r=t.reduce((e,t)=>e+(t.max_drops||12),0),l=s.length/t.length,n=s.length/(12*t.length)*100;return(0,a.jsxs)("div",{className:"bg-blue-50 rounded-lg p-4",children:[(0,a.jsx)("h4",{className:"font-medium text-blue-900 mb-3",children:"Pole Statistics"}),(0,a.jsxs)("div",{className:"grid grid-cols-3 gap-4 text-sm",children:[(0,a.jsxs)("div",{children:[(0,a.jsx)("span",{className:"text-blue-600",children:"Total Capacity:"}),(0,a.jsxs)("span",{className:"ml-2 font-medium text-blue-900",children:[r," drops"]})]}),(0,a.jsxs)("div",{children:[(0,a.jsx)("span",{className:"text-blue-600",children:"Avg Drops/Pole:"}),(0,a.jsx)("span",{className:"ml-2 font-medium text-blue-900",children:l.toFixed(1)})]}),(0,a.jsxs)("div",{children:[(0,a.jsx)("span",{className:"text-blue-600",children:"Coverage:"}),(0,a.jsxs)("span",{className:"ml-2 font-medium text-blue-900",children:[n.toFixed(0),"%"]})]})]})]})}function ee(e){let{type:t,data:s,maxRows:r=20}=e,l=s.slice(0,r);return 0===s.length?(0,a.jsxs)("p",{className:"text-gray-500",children:["No ",t," data found"]}):"poles"===t?(0,a.jsxs)(a.Fragment,{children:[(0,a.jsx)("div",{className:"overflow-x-auto",children:(0,a.jsxs)("table",{className:"w-full text-sm",children:[(0,a.jsx)("thead",{className:"bg-gray-50",children:(0,a.jsxs)("tr",{children:[(0,a.jsx)("th",{className:"px-4 py-2 text-left font-medium text-gray-900",children:"Pole Number"}),(0,a.jsx)("th",{className:"px-4 py-2 text-left font-medium text-gray-900",children:"GPS Coordinates"}),(0,a.jsx)("th",{className:"px-4 py-2 text-left font-medium text-gray-900",children:"Max Drops"}),(0,a.jsx)("th",{className:"px-4 py-2 text-left font-medium text-gray-900",children:"Status"})]})}),(0,a.jsx)("tbody",{className:"divide-y divide-gray-200",children:l.map(e=>(0,a.jsxs)("tr",{className:"hover:bg-gray-50",children:[(0,a.jsx)("td",{className:"px-4 py-2 font-medium text-gray-900",children:e.pole_number}),(0,a.jsx)("td",{className:"px-4 py-2 text-gray-600",children:e.latitude&&e.longitude?"".concat(Number(e.latitude).toFixed(6),", ").concat(Number(e.longitude).toFixed(6)):"No GPS"}),(0,a.jsx)("td",{className:"px-4 py-2 text-gray-700",children:e.max_drops||12}),(0,a.jsx)("td",{className:"px-4 py-2",children:(0,a.jsx)("span",{className:(0,R.cn)("inline-flex items-center px-2 py-1 rounded-full text-xs font-medium","completed"===e.status?"bg-green-100 text-green-800":"in_progress"===e.status?"bg-yellow-100 text-yellow-800":"bg-gray-100 text-gray-800"),children:e.status||"planned"})})]},e.id||e.pole_number))})]})}),s.length>r&&(0,a.jsxs)("div",{className:"text-center py-4 text-gray-500 text-sm",children:["Showing first ",r," of ",s.length," poles"]})]}):"drops"===t?(0,a.jsxs)(a.Fragment,{children:[(0,a.jsx)("div",{className:"overflow-x-auto",children:(0,a.jsxs)("table",{className:"w-full text-sm",children:[(0,a.jsx)("thead",{className:"bg-gray-50",children:(0,a.jsxs)("tr",{children:[(0,a.jsx)("th",{className:"px-4 py-2 text-left font-medium text-gray-900",children:"Drop Number"}),(0,a.jsx)("th",{className:"px-4 py-2 text-left font-medium text-gray-900",children:"Pole Number"}),(0,a.jsx)("th",{className:"px-4 py-2 text-left font-medium text-gray-900",children:"Address"}),(0,a.jsx)("th",{className:"px-4 py-2 text-left font-medium text-gray-900",children:"Customer"}),(0,a.jsx)("th",{className:"px-4 py-2 text-left font-medium text-gray-900",children:"Status"})]})}),(0,a.jsx)("tbody",{className:"divide-y divide-gray-200",children:l.map(e=>(0,a.jsxs)("tr",{className:"hover:bg-gray-50",children:[(0,a.jsx)("td",{className:"px-4 py-2 font-medium text-gray-900",children:e.drop_number}),(0,a.jsx)("td",{className:"px-4 py-2 text-gray-700",children:e.pole_number||"Not assigned"}),(0,a.jsx)("td",{className:"px-4 py-2 text-gray-700",children:e.address||"Not specified"}),(0,a.jsx)("td",{className:"px-4 py-2 text-gray-700",children:e.customer_name||"-"}),(0,a.jsx)("td",{className:"px-4 py-2",children:(0,a.jsx)("span",{className:(0,R.cn)("inline-flex items-center px-2 py-1 rounded-full text-xs font-medium","active"===e.status?"bg-green-100 text-green-800":"installed"===e.status?"bg-blue-100 text-blue-800":"bg-gray-100 text-gray-800"),children:e.status||"planned"})})]},e.id||e.drop_number))})]})}),s.length>r&&(0,a.jsxs)("div",{className:"text-center py-4 text-gray-500 text-sm",children:["Showing first ",r," of ",s.length," drops"]})]}):(0,a.jsxs)(a.Fragment,{children:[(0,a.jsx)("div",{className:"overflow-x-auto",children:(0,a.jsxs)("table",{className:"w-full text-sm",children:[(0,a.jsx)("thead",{className:"bg-gray-50",children:(0,a.jsxs)("tr",{children:[(0,a.jsx)("th",{className:"px-4 py-2 text-left font-medium text-gray-900",children:"Segment ID"}),(0,a.jsx)("th",{className:"px-4 py-2 text-left font-medium text-gray-900",children:"From → To"}),(0,a.jsx)("th",{className:"px-4 py-2 text-left font-medium text-gray-900",children:"Distance"}),(0,a.jsx)("th",{className:"px-4 py-2 text-left font-medium text-gray-900",children:"Cable Type"}),(0,a.jsx)("th",{className:"px-4 py-2 text-left font-medium text-gray-900",children:"Installation"}),(0,a.jsx)("th",{className:"px-4 py-2 text-left font-medium text-gray-900",children:"Status"})]})}),(0,a.jsx)("tbody",{className:"divide-y divide-gray-200",children:l.map(e=>(0,a.jsxs)("tr",{className:"hover:bg-gray-50",children:[(0,a.jsx)("td",{className:"px-4 py-2 font-medium text-gray-900",children:e.segment_id}),(0,a.jsxs)("td",{className:"px-4 py-2 text-gray-700",children:[e.from_point," → ",e.to_point]}),(0,a.jsxs)("td",{className:"px-4 py-2 text-gray-700",children:[e.distance,"m"]}),(0,a.jsx)("td",{className:"px-4 py-2 text-gray-700",children:e.cable_type||"standard"}),(0,a.jsx)("td",{className:"px-4 py-2 text-gray-700",children:e.installation_method||"aerial"}),(0,a.jsx)("td",{className:"px-4 py-2",children:(0,a.jsx)("span",{className:(0,R.cn)("inline-flex items-center px-2 py-1 rounded-full text-xs font-medium","installed"===e.status?"bg-green-100 text-green-800":"in_progress"===e.status?"bg-yellow-100 text-yellow-800":"bg-gray-100 text-gray-800"),children:e.status||"planned"})})]},e.id||e.segment_id))})]})}),s.length>r&&(0,a.jsxs)("div",{className:"text-center py-4 text-gray-500 text-sm",children:["Showing first ",r," of ",s.length," segments"]})]})}function et(e){let{projectId:t,projectName:s="Project"}=e,[l,n]=(0,r.useState)("summary"),[i,m]=(0,r.useState)(!1),{data:p,isLoading:u}=(0,o.I)({queryKey:["sow",t],queryFn:async()=>{let e=(0,c.rJ)(d.db,"projects",t,"sow"),s=await (0,c.GG)(e),a={};return s.docs.forEach(e=>{a[e.id]=e.data()}),a},enabled:!!t}),{data:x=[]}=(0,o.I)({queryKey:["poles",t],queryFn:async()=>{let e=(0,c.rJ)(d.db,"projects",t,"poles");return(await (0,c.GG)(e)).docs.map(e=>({id:e.id,...e.data()}))},enabled:!!t}),{data:h=[]}=(0,o.I)({queryKey:["drops",t],queryFn:async()=>{let e=(0,c.rJ)(d.db,"projects",t,"drops");return(await (0,c.GG)(e)).docs.map(e=>({id:e.id,...e.data()}))},enabled:!!t}),{data:g=[]}=(0,o.I)({queryKey:["fibre",t],queryFn:async()=>{let e=(0,c.rJ)(d.db,"projects",t,"fibre");return(await (0,c.GG)(e)).docs.map(e=>({id:e.id,...e.data()}))},enabled:!!t}),y=x.length>0||h.length>0||g.length>0;return u?(0,a.jsxs)("div",{className:"flex items-center justify-center p-8",children:[(0,a.jsx)("div",{className:"animate-spin rounded-full h-8 w-8 border-b-2 border-blue-600"}),(0,a.jsx)("span",{className:"ml-3 text-gray-600",children:"Loading SOW data..."})]}):y||i?i?(0,a.jsxs)("div",{className:"bg-white rounded-lg shadow-sm border border-gray-200 p-6",children:[(0,a.jsxs)("div",{className:"mb-6",children:[(0,a.jsx)("h2",{className:"text-lg font-semibold text-gray-900",children:"Import SOW Data"}),(0,a.jsx)("p",{className:"text-sm text-gray-600 mt-1",children:"Upload Excel files containing poles, drops, and fibre scope data"})]}),(0,a.jsx)(X,{projectId:t,projectName:s,onComplete:()=>{m(!1),n("summary")}}),(0,a.jsx)("div",{className:"mt-6 pt-6 border-t border-gray-200",children:(0,a.jsx)("button",{onClick:()=>m(!1),className:"text-sm text-gray-600 hover:text-gray-700",children:"Cancel and go back"})})]}):(0,a.jsxs)("div",{className:"bg-white rounded-lg shadow-sm border border-gray-200",children:[(0,a.jsx)(K,{hasData:y,onUpdateClick:()=>n("upload")}),(0,a.jsx)(Q,{activeTab:l,onTabChange:n,polesCount:x.length,dropsCount:h.length,fibreCount:g.length}),(0,a.jsxs)("div",{className:"p-6",children:["summary"===l&&(0,a.jsxs)("div",{className:"space-y-6",children:[(0,a.jsx)(Y,{polesCount:x.length,dropsCount:h.length,fibreCount:g.length}),(0,a.jsx)(Z,{sowData:p,polesCount:x.length,dropsCount:h.length,fibreCount:g.length}),(0,a.jsx)($,{poles:x,drops:h})]}),"poles"===l&&(0,a.jsxs)("div",{className:"space-y-4",children:[(0,a.jsxs)("div",{className:"flex items-center justify-between mb-4",children:[(0,a.jsx)("h3",{className:"text-lg font-semibold text-gray-900",children:"Poles Data"}),(0,a.jsxs)("span",{className:"text-sm text-gray-500",children:[x.length," total poles"]})]}),(0,a.jsx)(ee,{type:"poles",data:x})]}),"drops"===l&&(0,a.jsxs)("div",{className:"space-y-4",children:[(0,a.jsxs)("div",{className:"flex items-center justify-between mb-4",children:[(0,a.jsx)("h3",{className:"text-lg font-semibold text-gray-900",children:"Drops Data"}),(0,a.jsxs)("span",{className:"text-sm text-gray-500",children:[h.length," total drops"]})]}),(0,a.jsx)(ee,{type:"drops",data:h})]}),"fibre"===l&&(0,a.jsxs)("div",{className:"space-y-4",children:[(0,a.jsxs)("div",{className:"flex items-center justify-between mb-4",children:[(0,a.jsx)("h3",{className:"text-lg font-semibold text-gray-900",children:"Fibre Segments"}),(0,a.jsxs)("span",{className:"text-sm text-gray-500",children:[g.length," total segments"]})]}),(0,a.jsx)(ee,{type:"fibre",data:g})]}),"upload"===l&&(0,a.jsxs)("div",{className:"space-y-6",children:[(0,a.jsxs)("div",{children:[(0,a.jsx)("h3",{className:"text-lg font-semibold text-gray-900 mb-2",children:"Import or Update SOW Data"}),(0,a.jsx)("p",{className:"text-sm text-gray-600",children:"Upload new Excel files to add or update poles, drops, and fibre scope data for this project."})]}),(0,a.jsx)(X,{projectId:t,projectName:s,onComplete:()=>{n("summary")},showActions:!1})]})]})]}):(0,a.jsx)(z,{onImportClick:()=>m(!0)})}var es=s(19345);function ea(e){let{project:t}=e;return(0,a.jsxs)("div",{className:"bg-white rounded-lg shadow-sm border border-gray-200 p-6",children:[(0,a.jsx)("h2",{className:"text-lg font-semibold text-gray-900 mb-4",children:"Project Information"}),(0,a.jsxs)("div",{className:"space-y-4",children:[t.description&&(0,a.jsxs)("div",{children:[(0,a.jsx)("h3",{className:"text-sm font-medium text-gray-500 mb-1",children:"Description"}),(0,a.jsx)("p",{className:"text-gray-900",children:t.description})]}),(0,a.jsxs)("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[(0,a.jsxs)("div",{children:[(0,a.jsx)("h3",{className:"text-sm font-medium text-gray-500 mb-1",children:"Location"}),(0,a.jsxs)("div",{className:"flex items-center text-gray-900",children:[(0,a.jsx)(m.A,{className:"h-4 w-4 mr-2"}),t.location]})]}),t.clientName&&(0,a.jsxs)("div",{children:[(0,a.jsx)("h3",{className:"text-sm font-medium text-gray-500 mb-1",children:"Client"}),(0,a.jsxs)("div",{className:"flex items-center text-gray-900",children:[(0,a.jsx)(es.A,{className:"h-4 w-4 mr-2"}),t.clientName]})]})]})]})]})}function er(e){let{project:t}=e;return(0,a.jsxs)("div",{className:"bg-white rounded-lg shadow-sm border border-gray-200 p-6",children:[(0,a.jsx)("h2",{className:"text-lg font-semibold text-gray-900 mb-4",children:"Progress"}),(0,a.jsxs)("div",{className:"space-y-4",children:[(0,a.jsxs)("div",{children:[(0,a.jsxs)("div",{className:"flex items-center justify-between text-sm text-gray-600 mb-2",children:[(0,a.jsx)("span",{children:"Overall Progress"}),(0,a.jsxs)("span",{children:[Math.round(t.actualProgress||0),"%"]})]}),(0,a.jsx)("div",{className:"w-full bg-gray-200 rounded-full h-3",children:(0,a.jsx)("div",{className:"bg-blue-600 h-3 rounded-full transition-all duration-300",style:{width:"".concat(t.actualProgress||0,"%")}})})]}),(0,a.jsxs)("div",{className:"grid grid-cols-2 gap-4 text-center",children:[(0,a.jsxs)("div",{className:"bg-gray-50 rounded-lg p-3",children:[(0,a.jsx)("div",{className:"text-2xl font-semibold text-gray-900",children:0}),(0,a.jsx)("div",{className:"text-sm text-gray-500",children:"Tasks Completed"})]}),(0,a.jsxs)("div",{className:"bg-gray-50 rounded-lg p-3",children:[(0,a.jsx)("div",{className:"text-2xl font-semibold text-gray-900",children:0}),(0,a.jsx)("div",{className:"text-sm text-gray-500",children:"Tasks Remaining"})]})]})]})]})}var el=s(75375),en=s(58875);function ei(e){let{project:t,onNavigateBack:s,onEdit:r,onDelete:l}=e;return(0,a.jsxs)("div",{className:"flex items-center justify-between",children:[(0,a.jsxs)("div",{className:"flex items-center gap-4",children:[(0,a.jsx)("button",{onClick:s,className:"p-2 text-gray-600 hover:text-gray-900 hover:bg-gray-100 rounded-full",children:(0,a.jsx)(el.A,{className:"h-5 w-5"})}),(0,a.jsxs)("div",{children:[(0,a.jsx)("h1",{className:"text-2xl font-semibold text-gray-900",children:t.name}),(0,a.jsx)("p",{className:"text-gray-600 mt-1",children:t.code})]})]}),(0,a.jsxs)("div",{className:"flex items-center gap-2",children:[(0,a.jsxs)("button",{onClick:r,className:"inline-flex items-center px-4 py-2 text-gray-700 border border-gray-300 rounded-lg hover:bg-gray-50 transition-colors",children:[(0,a.jsx)(en.A,{className:"h-4 w-4 mr-2"}),"Edit"]}),(0,a.jsxs)("button",{onClick:l,className:"inline-flex items-center px-4 py-2 text-red-600 border border-red-300 rounded-lg hover:bg-red-50 transition-colors",children:[(0,a.jsx)(P.A,{className:"h-4 w-4 mr-2"}),"Delete"]})]})]})}var eo=s(37683),ec=s(10835),ed=s(72806);let em={[eo.Ks.PLANNING]:"bg-yellow-100 text-yellow-800 dark:bg-yellow-900/20 dark:text-yellow-300",[eo.Ks.ACTIVE]:"bg-green-100 text-green-800 dark:bg-green-900/20 dark:text-green-300",[eo.Ks.ON_HOLD]:"bg-orange-100 text-orange-800 dark:bg-orange-900/20 dark:text-orange-300",[eo.Ks.COMPLETED]:"bg-blue-100 text-blue-800 dark:bg-blue-900/20 dark:text-blue-300",[eo.Ks.CANCELLED]:"bg-red-100 text-red-800 dark:bg-red-900/20 dark:text-red-300"},ep={[eo.bx.LOW]:"bg-gray-100 text-gray-800 dark:bg-gray-900/20 dark:text-gray-300",[eo.bx.MEDIUM]:"bg-blue-100 text-blue-800 dark:bg-blue-900/20 dark:text-blue-300",[eo.bx.HIGH]:"bg-orange-100 text-orange-800 dark:bg-orange-900/20 dark:text-orange-300",[eo.bx.CRITICAL]:"bg-red-100 text-red-800 dark:bg-red-900/20 dark:text-red-300"},eu=e=>new Intl.NumberFormat("en-ZA",{style:"currency",currency:"ZAR"}).format(e),ex=e=>e?(e.toDate?e.toDate():new Date(e)).toLocaleDateString("en-ZA",{day:"numeric",month:"short",year:"numeric"}):"N/A",eh=e=>Math.round(e||0);function eg(e){var t,s;let r,{project:l}=e;return(0,a.jsxs)("div",{className:"flex items-center gap-4",children:[(0,a.jsx)("span",{className:"inline-flex items-center px-3 py-1 rounded-full text-sm font-medium ".concat(em[l.status]||"bg-gray-100 text-gray-800"),children:(t=l.status)?t.charAt(0).toUpperCase()+t.slice(1).replace("_"," "):"Unknown"}),(0,a.jsx)("span",{className:"inline-flex items-center px-3 py-1 rounded-full text-sm font-medium ".concat(ep[l.priority]||"bg-gray-100 text-gray-800"),children:(s=l.priority)?s.charAt(0).toUpperCase()+s.slice(1)+" Priority":"No Priority"}),(0,a.jsx)("span",{className:"inline-flex items-center px-3 py-1 rounded-full text-sm font-medium bg-gray-100 text-gray-800",children:(r=l.projectType)?r.toUpperCase():"STANDARD"})]})}function ey(e){let{activeTab:t,onTabChange:s}=e;return(0,a.jsx)("div",{className:"border-b border-gray-200",children:(0,a.jsx)("nav",{className:"-mb-px flex space-x-8",children:[{id:"overview",label:"Overview"},{id:"hierarchy",label:"Project Hierarchy"},{id:"sow",label:"SOW Data"},{id:"timeline",label:"Timeline"}].map(e=>(0,a.jsx)("button",{onClick:()=>s(e.id),className:"py-2 px-1 border-b-2 font-medium text-sm ".concat(t===e.id?"border-blue-500 text-blue-600":"border-transparent text-gray-500 hover:text-gray-700 hover:border-gray-300"),children:e.label},e.id))})})}var eb=s(21744),ef=s(66042),ej=s(18024),ev=s(9674);function eN(e){let{project:t}=e;return(0,a.jsxs)("div",{className:"bg-white rounded-lg shadow-sm border border-gray-200 p-6",children:[(0,a.jsx)("h2",{className:"text-lg font-semibold text-gray-900 mb-4",children:"Key Details"}),(0,a.jsxs)("div",{className:"space-y-4",children:[(0,a.jsxs)("div",{className:"flex items-center",children:[(0,a.jsx)(eb.A,{className:"h-5 w-5 text-gray-400 mr-3"}),(0,a.jsxs)("div",{children:[(0,a.jsx)("p",{className:"text-sm font-medium text-gray-900",children:"Start Date"}),(0,a.jsx)("p",{className:"text-sm text-gray-500",children:ex(t.startDate)})]})]}),(0,a.jsxs)("div",{className:"flex items-center",children:[(0,a.jsx)(eb.A,{className:"h-5 w-5 text-gray-400 mr-3"}),(0,a.jsxs)("div",{children:[(0,a.jsx)("p",{className:"text-sm font-medium text-gray-900",children:"Expected End"}),(0,a.jsx)("p",{className:"text-sm text-gray-500",children:ex(t.endDate)})]})]}),(0,a.jsxs)("div",{className:"flex items-center",children:[(0,a.jsx)(ef.A,{className:"h-5 w-5 text-gray-400 mr-3"}),(0,a.jsxs)("div",{children:[(0,a.jsx)("p",{className:"text-sm font-medium text-gray-900",children:"Budget"}),(0,a.jsx)("p",{className:"text-sm text-gray-500",children:eu(t.budget||0)})]})]}),(0,a.jsxs)("div",{className:"flex items-center",children:[(0,a.jsx)(ej.A,{className:"h-5 w-5 text-gray-400 mr-3"}),(0,a.jsxs)("div",{children:[(0,a.jsx)("p",{className:"text-sm font-medium text-gray-900",children:"Working Hours"}),(0,a.jsx)("p",{className:"text-sm text-gray-500",children:"N/A"})]})]}),t.projectManager&&(0,a.jsxs)("div",{className:"flex items-center",children:[(0,a.jsx)(ev.A,{className:"h-5 w-5 text-gray-400 mr-3"}),(0,a.jsxs)("div",{children:[(0,a.jsx)("p",{className:"text-sm font-medium text-gray-900",children:"Project Manager"}),(0,a.jsx)("p",{className:"text-sm text-gray-500",children:t.projectManager})]})]})]})]})}function e_(e){let{project:t}=e;return(0,a.jsxs)("div",{className:"bg-white rounded-lg shadow-sm border border-gray-200 p-6",children:[(0,a.jsx)("h2",{className:"text-lg font-semibold text-gray-900 mb-4",children:"Quick Stats"}),(0,a.jsxs)("div",{className:"space-y-3",children:[(0,a.jsxs)("div",{className:"flex justify-between",children:[(0,a.jsx)("span",{className:"text-sm text-gray-600",children:"Budget Used"}),(0,a.jsx)("span",{className:"text-sm font-medium text-gray-900",children:eu(t.actualCost||0)})]}),t.actualCost&&(0,a.jsxs)("div",{className:"flex justify-between",children:[(0,a.jsx)("span",{className:"text-sm text-gray-600",children:"Actual Cost"}),(0,a.jsx)("span",{className:"text-sm font-medium text-gray-900",children:eu(t.actualCost)})]}),(0,a.jsxs)("div",{className:"flex justify-between",children:[(0,a.jsx)("span",{className:"text-sm text-gray-600",children:"Current Phase"}),(0,a.jsx)("span",{className:"text-sm font-medium text-gray-900",children:t.phase||"Planning"})]})]})]})}function ew(e){let{hierarchy:t,isLoading:s}=e;return s?(0,a.jsx)("div",{className:"bg-white rounded-lg shadow-sm border border-gray-200",children:(0,a.jsx)("div",{className:"flex items-center justify-center p-8",children:(0,a.jsx)("div",{className:"animate-spin rounded-full h-8 w-8 border-b-2 border-blue-600"})})}):t?(0,a.jsx)("div",{className:"bg-white rounded-lg shadow-sm border border-gray-200",children:(0,a.jsxs)("div",{className:"p-6",children:[(0,a.jsx)("h2",{className:"text-lg font-semibold text-gray-900 mb-6",children:"Project Hierarchy"}),(0,a.jsx)("div",{className:"space-y-6",children:t.phases&&t.phases.length>0?t.phases.map(e=>(0,a.jsxs)("div",{className:"border border-gray-200 rounded-lg",children:[(0,a.jsx)("div",{className:"p-4 bg-gray-50 border-b border-gray-200",children:(0,a.jsxs)("div",{className:"flex items-center justify-between",children:[(0,a.jsxs)("div",{className:"flex items-center",children:[(e=>{switch(e){case eo.ko.COMPLETED:return(0,a.jsx)(k.A,{className:"h-5 w-5 text-green-600"});case eo.ko.IN_PROGRESS:return(0,a.jsx)(ec.A,{className:"h-5 w-5 text-blue-600"});case eo.ko.ON_HOLD:return(0,a.jsx)(L.A,{className:"h-5 w-5 text-red-600"});default:return(0,a.jsx)(ed.A,{className:"h-5 w-5 text-gray-400"})}})(e.status),(0,a.jsxs)("div",{className:"ml-3",children:[(0,a.jsxs)("h3",{className:"text-base font-semibold text-gray-900",children:["Phase ",e.order,": ",e.name]}),(0,a.jsxs)("p",{className:"text-sm text-gray-500",children:[e.status.replace("_"," ")," • ",eh(e.progress),"% complete"]})]})]}),(0,a.jsx)("div",{className:"w-24 bg-gray-200 rounded-full h-2",children:(0,a.jsx)("div",{className:"bg-blue-600 h-2 rounded-full",style:{width:"".concat(eh(e.progress),"%")}})})]})}),e.steps&&e.steps.length>0&&(0,a.jsx)("div",{className:"p-4",children:(0,a.jsx)("div",{className:"space-y-4",children:e.steps.map(e=>(0,a.jsxs)("div",{className:"ml-4 border-l-2 border-gray-200 pl-4",children:[(0,a.jsxs)("div",{className:"flex items-center justify-between",children:[(0,a.jsxs)("div",{children:[(0,a.jsx)("h4",{className:"text-sm font-medium text-gray-900",children:e.name}),(0,a.jsxs)("p",{className:"text-xs text-gray-500",children:[e.status.replace("_"," ")," • ",e.estimatedHours,"h estimated"]})]}),(0,a.jsxs)("div",{className:"text-xs text-gray-500",children:[eh(e.progress),"%"]})]}),e.tasks&&e.tasks.length>0&&(0,a.jsxs)("div",{className:"mt-2 ml-4 space-y-1",children:[e.tasks.slice(0,3).map(e=>(0,a.jsxs)("div",{className:"flex items-center text-xs",children:[(0,a.jsx)("div",{className:"w-2 h-2 rounded-full mr-2 ".concat(e.status===eo.e1.COMPLETED?"bg-green-500":e.status===eo.e1.IN_PROGRESS?"bg-blue-500":"bg-gray-300")}),(0,a.jsx)("span",{className:"text-gray-600 truncate",children:e.name})]},e.id)),e.tasks.length>3&&(0,a.jsxs)("div",{className:"text-xs text-gray-500 ml-4",children:["+",e.tasks.length-3," more tasks"]})]})]},e.id))})})]},e.id)):(0,a.jsx)("p",{className:"text-gray-500 text-center py-8",children:"No project phases available"})})]})}):(0,a.jsx)("div",{className:"bg-white rounded-lg shadow-sm border border-gray-200 p-8 text-center",children:(0,a.jsx)("p",{className:"text-gray-500",children:"No hierarchy data available"})})}function eS(){return(0,a.jsxs)("div",{className:"bg-white rounded-lg shadow-sm border border-gray-200 p-6",children:[(0,a.jsx)("h2",{className:"text-lg font-semibold text-gray-900 mb-4",children:"Project Timeline"}),(0,a.jsx)("p",{className:"text-gray-500",children:"Timeline view coming soon..."})]})}function eD(){return(0,a.jsx)("div",{className:"flex items-center justify-center min-h-[400px]",children:(0,a.jsx)("div",{className:"animate-spin rounded-full h-12 w-12 border-b-2 border-blue-600"})})}function eI(e){let{onNavigateBack:t}=e;return(0,a.jsx)("div",{className:"flex items-center justify-center min-h-[400px]",children:(0,a.jsxs)("div",{className:"text-center",children:[(0,a.jsx)("div",{className:"text-red-500 text-6xl mb-4",children:"⚠️"}),(0,a.jsx)("h2",{className:"text-xl font-semibold text-gray-900 mb-2",children:"Project not found"}),(0,a.jsx)("p",{className:"text-gray-600 mb-4",children:"The project you're looking for doesn't exist or has been deleted."}),(0,a.jsx)("button",{onClick:t,className:"px-4 py-2 bg-blue-600 text-white rounded-lg hover:bg-blue-700 transition-colors",children:"Back to Projects"})]})})}function eE(){let e=(0,l.Zp)(),{id:t}=(0,l.g)(),[s,i]=(0,r.useState)("overview"),{data:o,isLoading:c,error:d}=(0,n.By)(t),{data:m,isLoading:p}=(0,n.Ww)(t),u=(0,n.eW)();if(c)return(0,a.jsx)(eD,{});if(d||!o)return(0,a.jsx)(eI,{onNavigateBack:()=>e("/app/projects")});let x=async()=>{window.confirm("Are you sure you want to delete this project? This action cannot be undone.")&&(await u.mutateAsync(t),e("/app/projects"))};return(0,a.jsxs)("div",{className:"max-w-7xl mx-auto space-y-6",children:[(0,a.jsx)(ei,{project:o,onNavigateBack:()=>e("/app/projects"),onEdit:()=>e("/app/projects/".concat(t,"/edit")),onDelete:x}),(0,a.jsx)(eg,{project:o}),(0,a.jsx)(ey,{activeTab:s,onTabChange:i}),"overview"===s&&(0,a.jsx)("div",{className:"space-y-6",children:(0,a.jsxs)("div",{className:"grid grid-cols-1 lg:grid-cols-3 gap-6",children:[(0,a.jsxs)("div",{className:"lg:col-span-2 space-y-6",children:[(0,a.jsx)(ea,{project:o}),(0,a.jsx)(er,{project:o})]}),(0,a.jsxs)("div",{className:"space-y-6",children:[(0,a.jsx)(eN,{project:o}),(0,a.jsx)(e_,{project:o})]})]})}),"hierarchy"===s&&(0,a.jsx)(ew,{hierarchy:m,isLoading:p}),"sow"===s&&(0,a.jsx)(et,{projectId:t,projectName:o.name}),"timeline"===s&&(0,a.jsx)(eS,{})]})}},56939:(e,t,s)=>{"use strict";s.d(t,{db:()=>m});var a=s(16042),r=s(76559),l=s(82964),n=s(22128),i=s(65364);let o={apiKey:i.env.NEXT_PUBLIC_FIREBASE_API_KEY||"AIzaSyDvW-ImXptnYIX7IDR78pdruw9BAp5A8Q8",authDomain:i.env.NEXT_PUBLIC_FIREBASE_AUTH_DOMAIN||"fibreflow-292c7.firebaseapp.com",projectId:i.env.NEXT_PUBLIC_FIREBASE_PROJECT_ID||"fibreflow-292c7",storageBucket:i.env.NEXT_PUBLIC_FIREBASE_STORAGE_BUCKET||"fibreflow-292c7.firebasestorage.app",messagingSenderId:i.env.NEXT_PUBLIC_FIREBASE_MESSAGING_SENDER_ID||"178707510767",appId:i.env.NEXT_PUBLIC_FIREBASE_APP_ID||"1:178707510767:web:a9455c8f053de03fbff21a",measurementId:i.env.NEXT_PUBLIC_FIREBASE_MEASUREMENT_ID||"G-3S74XHZ49B"},c=0===(0,a.Dk)().length?(0,a.Wp)(o):(0,a.Sx)(),d=(0,r.xI)(c),m=(0,l.aU)(c),p=(0,n.c7)(c);if("true"===i.env.NEXT_PUBLIC_ENABLE_OFFLINE&&(0,l.Q5)(m).catch(e=>{"failed-precondition"===e.code?console.warn("Firebase persistence failed: Multiple tabs open"):"unimplemented"===e.code&&console.warn("Firebase persistence not available in this browser")}),"development"===i.env.NEXT_PUBLIC_APP_ENV&&"true"===i.env.NEXT_PUBLIC_USE_EMULATORS)try{(0,r.Wq)(d,"http://localhost:9099",{disableWarnings:!0}),(0,l.vN)(m,"localhost",8080),(0,n.nb)(p,"localhost",9199),console.log("\uD83D\uDD27 Connected to Firebase emulators")}catch(e){console.debug("Firebase emulators connection skipped:",e)}},71624:(e,t,s)=>{"use strict";s.d(t,{s:()=>a});let a={initializeTables:async e=>(await fetch("/api/sow/initialize",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({projectId:e})})).json(),async uploadPoles(e,t){if(t.length<=300)return this._uploadPolesChunk(e,t);console.log("Uploading ".concat(t.length," poles in chunks of ").concat(300));let s=0,a=0,r=[];for(let l=0;l<t.length;l+=300){let n=t.slice(l,l+300),i=Math.floor(l/300)+1,o=Math.ceil(t.length/300);console.log("Uploading chunk ".concat(i,"/").concat(o," (").concat(n.length," poles)"));try{let t=await this._uploadPolesChunk(e,n);s+=t.inserted||0,a+=t.updated||0,t.errors&&r.push(...t.errors)}catch(e){throw console.error("Chunk ".concat(i," failed:"),e),Error("Failed at chunk ".concat(i,"/").concat(o,": ").concat(e.message))}l+300<t.length&&await new Promise(e=>setTimeout(e,100))}return{success:!0,inserted:s,updated:a,errors:r,message:"Successfully uploaded ".concat(t.length," poles in ").concat(Math.ceil(t.length/300)," chunks")}},async _uploadPolesChunk(e,t){let s=await fetch("/api/sow/poles",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({projectId:e,poles:t})});if(!s.ok){let e=await s.text();throw console.error("Upload poles failed:",s.status,e),Error("Upload failed: ".concat(s.status," - ").concat(e.substring(0,100)))}let a=s.headers.get("content-type");if(!a||!a.includes("application/json"))throw console.error("Non-JSON response:",(await s.text()).substring(0,200)),Error("Server returned non-JSON response");return s.json()},getPoles:async e=>(await fetch("/api/sow/poles?projectId=".concat(e))).json(),async uploadDrops(e,t){if(t.length<=250)return this._uploadDropsChunk(e,t);console.log("Uploading ".concat(t.length," drops in chunks of ").concat(250));let s=0,a=0,r=[];for(let l=0;l<t.length;l+=250){let n=t.slice(l,l+250),i=Math.floor(l/250)+1,o=Math.ceil(t.length/250);console.log("Uploading chunk ".concat(i,"/").concat(o," (").concat(n.length," drops)"));try{let t=await this._uploadDropsChunk(e,n);s+=t.inserted||0,a+=t.updated||0,t.errors&&r.push(...t.errors)}catch(e){throw console.error("Chunk ".concat(i," failed:"),e),Error("Failed at chunk ".concat(i,"/").concat(o,": ").concat(e.message))}l+250<t.length&&await new Promise(e=>setTimeout(e,100))}return{success:!0,inserted:s,updated:a,errors:r,message:"Successfully uploaded ".concat(t.length," drops in ").concat(Math.ceil(t.length/250)," chunks")}},async _uploadDropsChunk(e,t){let s=await fetch("/api/sow/drops",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({projectId:e,drops:t})});if(!s.ok){let e=await s.text();throw console.error("Upload drops failed:",s.status,e),Error("Upload failed: ".concat(s.status," - ").concat(e.substring(0,100)))}let a=s.headers.get("content-type");if(!a||!a.includes("application/json"))throw console.error("Non-JSON response:",(await s.text()).substring(0,200)),Error("Server returned non-JSON response");return s.json()},getDrops:async e=>(await fetch("/api/sow/drops?projectId=".concat(e))).json(),async uploadFibre(e,t){if(t.length<=200)return this._uploadFibreChunk(e,t);console.log("Uploading ".concat(t.length," fibre records in chunks of ").concat(200));let s=0,a=0,r=[];for(let l=0;l<t.length;l+=200){let n=t.slice(l,l+200),i=Math.floor(l/200)+1,o=Math.ceil(t.length/200);console.log("Uploading chunk ".concat(i,"/").concat(o," (").concat(n.length," fibre records)"));try{let t=await this._uploadFibreChunk(e,n);s+=t.inserted||0,a+=t.updated||0,t.errors&&r.push(...t.errors)}catch(e){throw console.error("Chunk ".concat(i," failed:"),e),Error("Failed at chunk ".concat(i,"/").concat(o,": ").concat(e.message))}l+200<t.length&&await new Promise(e=>setTimeout(e,100))}return{success:!0,inserted:s,updated:a,errors:r,message:"Successfully uploaded ".concat(t.length," fibre records in ").concat(Math.ceil(t.length/200)," chunks")}},async _uploadFibreChunk(e,t){let s=await fetch("/api/sow/fibre",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({projectId:e,fibres:t})});if(!s.ok){let e=await s.text();throw console.error("Upload fibre failed:",s.status,e),Error("Upload failed: ".concat(s.status," - ").concat(e.substring(0,100)))}return s.json()},getFibre:async e=>(await fetch("/api/sow/fibre?projectId=".concat(e))).json(),getProjectSOWData:async e=>(await fetch("/api/sow/project?projectId=".concat(e))).json(),async getSOWSummary(e){let t=e?"?projectIds=".concat(e.join(",")):"";return(await fetch("/api/sow/summary".concat(t))).json()},checkHealth:async()=>(await fetch("/api/sow/health")).json()}},83686:()=>{}}]);