"use strict";(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[9143],{6318:(e,t,r)=>{r.d(t,{xi:()=>a});function a(e){try{if(!e)return new Date;if("object"==typeof e&&"toDate"in e&&"function"==typeof e.toDate)return e.toDate();if("string"==typeof e){let t=new Date(e);if(!isNaN(t.getTime()))return t;return new Date}if(e instanceof Date){if(!isNaN(e.getTime()))return e;return new Date}if("number"==typeof e){let t=new Date(e);if(!isNaN(t.getTime()))return t}return new Date}catch(e){return new Date}}},29143:(e,t,r)=>{r.d(t,{r:()=>u});let a={name:"name",Name:"name",email:"email",Email:"email",phone:"phone",Phone:"phone","employee id":"employeeId","Employee ID":"employeeId",position:"position",Position:"position",department:"department",Department:"department","department ":"department","Primary Group":"department","reports to":"managerName","reports to ":"managerName","Reports To":"managerName",Level:"level",Status:"status",Skills:"skills",address:"address",Address:"address",city:"city",City:"city",province:"province",Province:"province",postalCode:"postalCode","Postal Code":"postalCode","Emergency Contact Name":"emergencyContactName","Emergency Contact Phone":"emergencyContactPhone","start date":"startDate","Start Date":"startDate","Contract Type":"contractType","Working Hours":"workingHours","Alternative Phone":"alternativePhone"},n=["employee id","name","email","phone","position","department","reports to","address","city","province","postalCode","start date"];var o=r(61368),i=r(16932);async function s(e){try{let{staffNeonService:t}=await Promise.all([r.e(669),r.e(225)]).then(r.bind(r,60225)),a=await t.getAll(),n=a.find(t=>t.name.toLowerCase().trim()===e.toLowerCase().trim());if(n&&n.id)return n.id;let o=a.find(t=>t.name.toLowerCase().includes(e.toLowerCase().trim())||e.toLowerCase().includes(t.name.toLowerCase().trim()));if(o&&o.id)return o.id;return null}catch(e){return i.Rm.error("Error looking up manager by name:",{data:e},"managerResolver"),null}}var m=r(31499);async function l(e){arguments.length>1&&void 0!==arguments[1]&&arguments[1];let{staffService:t}=await Promise.all([r.e(669),r.e(225),r.e(6660)]).then(r.bind(r,66660)),a=[],n=[],l=0,c=0,p=function(e){let t=new Set;return e.forEach(e=>{e.managerName&&e.managerName.trim()&&t.add(e.managerName.trim())}),t}(e);i.Rm.info("\uD83D\uDCCA Unique managers found:",{data:Array.from(p)},"rowProcessor");let d=[...e].sort((e,t)=>{var r,a;let n=p.has((null==(r=e.name)?void 0:r.trim())||""),o=p.has((null==(a=t.name)?void 0:a.trim())||"");return n&&!o?-1:!n&&o?1:0});for(let r=0;r<d.length;r++){let p=d[r],u=e.indexOf(p)+2;try{let e;if(!p.name||""===p.name.trim()){a.push({row:u,field:"name",message:"Name is required"}),c++;continue}if(!p.email||""===p.email.trim()){a.push({row:u,field:"email",message:"Email is required"}),c++;continue}if(!p.phone||""===p.phone.trim()){a.push({row:u,field:"phone",message:"Phone is required"}),c++;continue}if(!p.employeeId||""===p.employeeId.trim()){i.Rm.info("Row ".concat(u," missing employeeId. Available fields:"),{data:Object.keys(p)},"rowProcessor"),a.push({row:u,field:"employeeId",message:"Employee ID is required"}),c++;continue}if(p.managerName&&p.managerName.trim()&&""!==p.managerName.trim()){let t=p.managerName.trim();try{let r=await s(t);r&&(e=r)}catch(e){}}let d=p.employeeId&&""!==p.employeeId.trim()?p.employeeId.trim():"AUTO_".concat(Date.now(),"_").concat(r);i.Rm.info("Manager lookup result:",{data:{managerName:p.managerName,resolvedUuid:e,reportsToType:typeof e,reportsToValue:JSON.stringify(e)}},"rowProcessor");let f=new Date;if(p.startDate){let e=function(e){if(e){if(e instanceof Date)return e;if("number"==typeof e){let t=new Date(1900,0,1);return new Date(t.getTime()+(e-2)*864e5)}if("string"==typeof e){let t=e.match(/^(\d{4})\/(\d{1,2})\/(\d{1,2})$/);if(t){let[,e,r,a]=t;return new Date(parseInt(e),parseInt(r)-1,parseInt(a))}let r=e.match(/^(\d{1,2})\/(\d{1,2})\/(\d{4})$/);if(r){let[,e,t,a]=r;return new Date(parseInt(a),parseInt(t)-1,parseInt(e))}let a=e.match(/^(\d{4})-(\d{1,2})-(\d{1,2})$/);if(a){let[,e,t,r]=a;return new Date(parseInt(e),parseInt(t)-1,parseInt(r))}let n=new Date(e);if(!isNaN(n.getTime()))return n}}}(p.startDate);e&&(f=e)}let N={name:p.name.trim(),email:p.email.trim(),phone:p.phone.trim()||"",...p.alternativePhone&&{alternativePhone:p.alternativePhone},employeeId:d,position:p.position||"Staff",department:p.department||"Operations",contractType:o.h$.PERMANENT,status:o.fo.ACTIVE,...e&&{reportsTo:e},startDate:f,address:p.address||"",city:p.city||"",province:p.province||"",postalCode:p.postalCode||"",...p.emergencyContactName&&{emergencyContactName:p.emergencyContactName},...p.emergencyContactPhone&&{emergencyContactPhone:p.emergencyContactPhone},experienceYears:0,workingHours:"9:00-17:00",availableWeekends:!1,availableNights:!1,timeZone:"Africa/Johannesburg",maxProjectCount:5,skills:function(e){if(!e)return[];let t=[];for(let r of e.split(",").map(e=>e.trim()))if(r){let e=Object.values(m.ef).find(e=>e.toLowerCase().replace(/_/g," ")===r.toLowerCase()||e.toLowerCase()===r.toLowerCase());e&&t.push(e)}return t}(p.skills)};i.Rm.info("\uD83D\uDCDD Creating or updating staff member: ".concat(N.name," (Employee ID: ").concat(N.employeeId,", undefined, 'rowProcessor');"));let g=await t.createOrUpdate(N);g?(n.push(g),l++):(c++,a.push({row:u,field:"",message:"Failed to create/update staff member"}))}catch(e){i.Rm.error("❌ Error processing row ".concat(u,":"),{data:e},"rowProcessor"),c++,a.push({row:u,field:"",message:e instanceof Error?e.message:"Unknown error occurred"})}}return{success:0===c,total:e.length,imported:l,failed:c,errors:a,staffMembers:n}}async function c(e){let t=!(arguments.length>1)||void 0===arguments[1]||arguments[1];return new Promise((r,n)=>{let o=new FileReader;o.onload=async e=>{try{var o;let n=(null==(o=e.target)?void 0:o.result).split("\n").filter(e=>e.trim()),s=n[0].split(",").map(e=>e.trim());i.Rm.info("Header mapping will be:",{data:s.map(e=>"".concat(e," -> ").concat(a[e]||"unmapped"))},"csvProcessor");let m=[];for(let e=1;e<n.length;e++){let t=n[e].split(",").map(e=>e.trim()),r={};s.forEach((e,n)=>{r[a[e]||e.toLowerCase().replace(/\s+/g,"")]=t[n]||""}),m.push(r)}let c=await l(m,t);r(c)}catch(e){n(e)}},o.onerror=()=>n(Error("Failed to read CSV file")),o.readAsText(e)})}var p=r(12770),d=r(6318);let u={importFromCSV:c,importFromExcel:async function e(e){let t=!(arguments.length>1)||void 0===arguments[1]||arguments[1];return new Promise((r,a)=>{let n=new FileReader;n.onload=async e=>{try{var n;let a=null==(n=e.target)?void 0:n.result,o=p.LF(a,{type:"binary"}),i=o.SheetNames[0],s=o.Sheets[i],m=p.Wp.sheet_to_json(s,{raw:!1,dateNF:"yyyy/mm/dd"}).map(e=>({employeeId:e["Employee ID"]||e["employee id"]||"",name:e.Name||e.name||"",email:e.Email||e.email||"",phone:e.Phone||e.phone||"",position:e.Position||e.position||"Staff",department:e.Department||e.department||e["Primary Group"]||"Operations",managerName:e["Reports To"]||e["reports to"]||"",skills:e.Skills||e.skills||"",alternativePhone:e["Alternative Phone"]||e["alternative phone"]||"",address:e.Address||e.address||"",city:e.City||e.city||"",province:e.Province||e.province||"",postalCode:e["Postal Code"]||e["postal code"]||"",emergencyContactName:e["Emergency Contact Name"]||"",emergencyContactPhone:e["Emergency Contact Phone"]||"",startDate:e["Start Date"]||e["start date"]||"",contractType:e["Contract Type"]||"",workingHours:e["Working Hours"]||""})),c=await l(m,t);r(c)}catch(e){a(e)}},n.onerror=()=>a(Error("Failed to read Excel file")),n.readAsBinaryString(e)})},exportToExcel:function(e){let t=e.map(e=>({"Employee ID":e.employeeId||"",Name:e.name,Email:e.email,Phone:e.phone,Position:e.position||"",Department:e.department||"",Status:e.status,"Start Date":e.startDate?(0,d.xi)(e.startDate).toLocaleDateString():"",Manager:e.managerName||"","Alternative Phone":e.alternativePhone||"","Contract Type":e.contractType||""})),r=p.Wp.json_to_sheet(t),a=p.Wp.book_new();p.Wp.book_append_sheet(a,r,"Staff");let n="staff_export_".concat(new Date().toISOString().split("T")[0],".xlsx");p._h(a,n)},getImportTemplate:()=>n.join(",")}},31499:(e,t,r)=>{r.d(t,{Lz:()=>a,ef:()=>i,fo:()=>n,h$:()=>o});var a=function(e){return e.INTERN="intern",e.JUNIOR="junior",e.INTERMEDIATE="intermediate",e.SENIOR="senior",e.LEAD="lead",e.MANAGER="manager",e.SENIOR_MANAGER="senior_manager",e.DIRECTOR="director",e.EXECUTIVE="executive",e}({}),n=function(e){return e.ACTIVE="active",e.INACTIVE="inactive",e.ON_LEAVE="on_leave",e.SUSPENDED="suspended",e.TERMINATED="terminated",e.RESIGNED="resigned",e.RETIRED="retired",e}({}),o=function(e){return e.PERMANENT="permanent",e.CONTRACT="contract",e.TEMPORARY="temporary",e.FREELANCE="freelance",e.INTERN="intern",e.CONSULTANT="consultant",e}({}),i=function(e){return e.FIBRE_SPLICING="fibre_splicing",e.OTDR_TESTING="otdr_testing",e.POWER_METER_TESTING="power_meter_testing",e.CABLE_INSTALLATION="cable_installation",e.POLE_INSTALLATION="pole_installation",e.TRENCHING="trenching",e.DUCT_INSTALLATION="duct_installation",e.NETWORK_DESIGN="network_design",e.NETWORK_CONFIGURATION="network_configuration",e.TROUBLESHOOTING="troubleshooting",e.MAINTENANCE="maintenance",e.PROJECT_MANAGEMENT="project_management",e.TEAM_LEADERSHIP="team_leadership",e.PLANNING="planning",e.COORDINATION="coordination",e.SAFETY_PROTOCOLS="safety_protocols",e.QUALITY_CONTROL="quality_control",e.COMPLIANCE="compliance",e.CUSTOMER_RELATIONS="customer_relations",e.COMMUNICATION="communication",e.PROBLEM_SOLVING="problem_solving",e}({})},61368:(e,t,r)=>{r.d(t,{h$:()=>a.h$,ef:()=>a.ef,Lz:()=>a.Lz,fo:()=>a.fo});var a=r(31499);r(82964)}}]);