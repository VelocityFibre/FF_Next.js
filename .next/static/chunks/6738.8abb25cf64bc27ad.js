(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[6738],{18024:(e,t,s)=>{"use strict";s.d(t,{A:()=>a});let a=(0,s(56467).A)("Clock",[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["polyline",{points:"12 6 12 12 16 14",key:"68esgv"}]])},21744:(e,t,s)=>{"use strict";s.d(t,{A:()=>a});let a=(0,s(56467).A)("Calendar",[["rect",{width:"18",height:"18",x:"3",y:"4",rx:"2",ry:"2",key:"eu3xkr"}],["line",{x1:"16",x2:"16",y1:"2",y2:"6",key:"m3sa8f"}],["line",{x1:"8",x2:"8",y1:"2",y2:"6",key:"18kwsl"}],["line",{x1:"3",x2:"21",y1:"10",y2:"10",key:"xt86sb"}]])},28364:(e,t,s)=>{"use strict";s.d(t,{A:()=>a});let a=(0,s(56467).A)("FileText",[["path",{d:"M14.5 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V7.5L14.5 2z",key:"1nnpy2"}],["polyline",{points:"14 2 14 8 20 8",key:"1ew0cm"}],["line",{x1:"16",x2:"8",y1:"13",y2:"13",key:"14keom"}],["line",{x1:"16",x2:"8",y1:"17",y2:"17",key:"17nazh"}],["line",{x1:"10",x2:"8",y1:"9",y2:"9",key:"1a5vjj"}]])},30155:(e,t,s)=>{"use strict";s.d(t,{A:()=>a});let a=(0,s(56467).A)("Upload",[["path",{d:"M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4",key:"ih7n3h"}],["polyline",{points:"17 8 12 3 7 8",key:"t8dd8p"}],["line",{x1:"12",x2:"12",y1:"3",y2:"15",key:"widbto"}]])},30359:(e,t,s)=>{"use strict";s.d(t,{A:()=>a});let a=(0,s(56467).A)("Eye",[["path",{d:"M2 12s3-7 10-7 10 7 10 7-3 7-10 7-10-7-10-7Z",key:"rwhkz3"}],["circle",{cx:"12",cy:"12",r:"3",key:"1v7zrd"}]])},30449:(e,t,s)=>{"use strict";s.d(t,{A:()=>a});let a=(0,s(56467).A)("CheckCircle",[["path",{d:"M22 11.08V12a10 10 0 1 1-5.93-9.14",key:"g774vq"}],["polyline",{points:"22 4 12 14.01 9 11.01",key:"6xbx8j"}]])},33616:(e,t,s)=>{"use strict";s.d(t,{A:()=>a});let a=(0,s(56467).A)("Send",[["path",{d:"m22 2-7 20-4-9-9-4Z",key:"1q3vgg"}],["path",{d:"M22 2 11 13",key:"nzbqef"}]])},46618:(e,t,s)=>{"use strict";s.d(t,{A:()=>a});let a=(0,s(56467).A)("Download",[["path",{d:"M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4",key:"ih7n3h"}],["polyline",{points:"7 10 12 15 17 10",key:"2ggqvy"}],["line",{x1:"12",x2:"12",y1:"15",y2:"3",key:"1vk2je"}]])},58875:(e,t,s)=>{"use strict";s.d(t,{A:()=>a});let a=(0,s(56467).A)("PenSquare",[["path",{d:"M11 4H4a2 2 0 0 0-2 2v14a2 2 0 0 0 2 2h14a2 2 0 0 0 2-2v-7",key:"1qinfi"}],["path",{d:"M18.5 2.5a2.12 2.12 0 0 1 3 3L12 15l-4 1 1-4Z",key:"w2jsv5"}]])},66042:(e,t,s)=>{"use strict";s.d(t,{A:()=>a});let a=(0,s(56467).A)("DollarSign",[["line",{x1:"12",x2:"12",y1:"2",y2:"22",key:"7eqyqh"}],["path",{d:"M17 5H9.5a3.5 3.5 0 0 0 0 7h5a3.5 3.5 0 0 1 0 7H6",key:"1b0p4s"}]])},76738:(e,t,s)=>{"use strict";s.r(t),s.d(t,{SOWManagement:()=>N});var a=s(37876),r=s(30155),l=s(28364),n=s(89099);function i(){let e=(0,n.useRouter)(),{projectId:t}=e.query,s="string"==typeof t?t:"";return(0,a.jsx)("div",{className:"bg-white rounded-lg shadow-sm border border-neutral-200 p-6",children:(0,a.jsxs)("div",{className:"flex items-center justify-between",children:[(0,a.jsxs)("div",{children:[(0,a.jsx)("h1",{className:"text-2xl font-semibold text-neutral-900",children:"SOW Management"}),(0,a.jsx)("p",{className:"text-neutral-600 mt-1",children:"Manage Statements of Work and project contracts"})]}),(0,a.jsxs)("div",{className:"flex gap-3",children:[(0,a.jsxs)("button",{onClick:()=>{e.push(s?"/sow/import?projectId=".concat(s):"/sow/import")},className:"px-4 py-2 bg-white border border-neutral-300 text-neutral-700 rounded-lg hover:bg-neutral-50 flex items-center gap-2",children:[(0,a.jsx)(r.A,{className:"h-4 w-4"}),"Import SOW"]}),(0,a.jsxs)("button",{className:"px-4 py-2 bg-primary-600 text-white rounded-lg hover:bg-primary-700 flex items-center gap-2",children:[(0,a.jsx)(l.A,{className:"h-4 w-4"}),"New SOW"]})]})]})})}var c=s(30449),d=s(18024),o=s(66042);function x(e){let{sows:t}=e;return(0,a.jsxs)("div",{className:"grid grid-cols-1 md:grid-cols-4 gap-4",children:[(0,a.jsxs)("div",{className:"bg-white rounded-lg border border-neutral-200 p-4",children:[(0,a.jsxs)("div",{className:"flex items-center justify-between mb-2",children:[(0,a.jsx)("span",{className:"text-sm text-neutral-600",children:"Total SOWs"}),(0,a.jsx)(l.A,{className:"h-4 w-4 text-neutral-400"})]}),(0,a.jsx)("p",{className:"text-2xl font-semibold text-neutral-900",children:t.length})]}),(0,a.jsxs)("div",{className:"bg-white rounded-lg border border-neutral-200 p-4",children:[(0,a.jsxs)("div",{className:"flex items-center justify-between mb-2",children:[(0,a.jsx)("span",{className:"text-sm text-neutral-600",children:"Active"}),(0,a.jsx)(c.A,{className:"h-4 w-4 text-success-600"})]}),(0,a.jsx)("p",{className:"text-2xl font-semibold text-success-600",children:t.filter(e=>"active"===e.status).length})]}),(0,a.jsxs)("div",{className:"bg-white rounded-lg border border-neutral-200 p-4",children:[(0,a.jsxs)("div",{className:"flex items-center justify-between mb-2",children:[(0,a.jsx)("span",{className:"text-sm text-neutral-600",children:"Pending"}),(0,a.jsx)(d.A,{className:"h-4 w-4 text-warning-600"})]}),(0,a.jsx)("p",{className:"text-2xl font-semibold text-warning-600",children:t.filter(e=>"pending_approval"===e.status).length})]}),(0,a.jsxs)("div",{className:"bg-white rounded-lg border border-neutral-200 p-4",children:[(0,a.jsxs)("div",{className:"flex items-center justify-between mb-2",children:[(0,a.jsx)("span",{className:"text-sm text-neutral-600",children:"Total Value"}),(0,a.jsx)(o.A,{className:"h-4 w-4 text-primary-600"})]}),(0,a.jsxs)("p",{className:"text-2xl font-semibold text-primary-600",children:["$",t.reduce((e,t)=>e+t.value,0).toLocaleString()]})]})]})}var p=s(98960);function m(e){let{filter:t,onFilterChange:s}=e;return(0,a.jsx)("div",{className:"bg-white rounded-lg shadow-sm border border-neutral-200 p-1",children:(0,a.jsx)("div",{className:"flex space-x-1",children:[{key:"all",label:"All SOWs"},{key:"draft",label:"Draft"},{key:"pending_approval",label:"Pending Approval"},{key:"active",label:"Active"},{key:"completed",label:"Completed"}].map(e=>{let{key:r,label:l}=e;return(0,a.jsx)("button",{onClick:()=>s(r),className:(0,p.cn)("flex-1 px-4 py-2 text-sm font-medium rounded-lg transition-colors",t===r?"bg-primary-100 text-primary-700":"text-neutral-600 hover:text-neutral-900 hover:bg-neutral-100"),children:l},r)})})})}var u=s(21744),h=s(30359),j=s(58875),y=s(46618),f=s(33616);function b(e){let{sows:t}=e;return(0,a.jsx)("div",{className:"bg-white rounded-lg shadow-sm border border-neutral-200",children:(0,a.jsx)("div",{className:"overflow-x-auto",children:(0,a.jsxs)("table",{className:"w-full",children:[(0,a.jsx)("thead",{className:"bg-neutral-50 border-b border-neutral-200",children:(0,a.jsxs)("tr",{children:[(0,a.jsx)("th",{className:"px-6 py-3 text-left text-xs font-medium text-neutral-500 uppercase",children:"SOW Number"}),(0,a.jsx)("th",{className:"px-6 py-3 text-left text-xs font-medium text-neutral-500 uppercase",children:"Project"}),(0,a.jsx)("th",{className:"px-6 py-3 text-left text-xs font-medium text-neutral-500 uppercase",children:"Client"}),(0,a.jsx)("th",{className:"px-6 py-3 text-left text-xs font-medium text-neutral-500 uppercase",children:"Value"}),(0,a.jsx)("th",{className:"px-6 py-3 text-left text-xs font-medium text-neutral-500 uppercase",children:"Duration"}),(0,a.jsx)("th",{className:"px-6 py-3 text-left text-xs font-medium text-neutral-500 uppercase",children:"Milestones"}),(0,a.jsx)("th",{className:"px-6 py-3 text-left text-xs font-medium text-neutral-500 uppercase",children:"Status"}),(0,a.jsx)("th",{className:"px-6 py-3 text-right text-xs font-medium text-neutral-500 uppercase",children:"Actions"})]})}),(0,a.jsx)("tbody",{className:"divide-y divide-neutral-200",children:t.map(e=>{var t;return(0,a.jsxs)("tr",{className:"hover:bg-neutral-50",children:[(0,a.jsx)("td",{className:"px-6 py-4",children:(0,a.jsxs)("div",{children:[(0,a.jsx)("div",{className:"font-medium text-neutral-900",children:e.sowNumber}),(0,a.jsxs)("div",{className:"text-xs text-neutral-500",children:["v",e.version]})]})}),(0,a.jsx)("td",{className:"px-6 py-4",children:(0,a.jsxs)("div",{children:[(0,a.jsx)("div",{className:"text-sm text-neutral-900",children:e.projectName}),e.importedData&&(0,a.jsxs)("div",{className:"text-xs text-neutral-500 mt-1",children:[e.importedData.poles," poles • ",e.importedData.houses," houses • ",e.importedData.spares," spares • ",e.importedData.fibre," fibre"]})]})}),(0,a.jsx)("td",{className:"px-6 py-4",children:(0,a.jsx)("div",{className:"text-sm text-neutral-900",children:e.clientName})}),(0,a.jsx)("td",{className:"px-6 py-4",children:(0,a.jsxs)("div",{className:"text-sm font-medium text-neutral-900",children:[e.currency," ",e.value.toLocaleString()]})}),(0,a.jsx)("td",{className:"px-6 py-4",children:(0,a.jsx)("div",{className:"text-sm text-neutral-600",children:(0,a.jsxs)("div",{className:"flex items-center gap-1",children:[(0,a.jsx)(u.A,{className:"h-3 w-3"}),new Date(e.startDate).toLocaleDateString()," -",new Date(e.endDate).toLocaleDateString()]})})}),(0,a.jsx)("td",{className:"px-6 py-4",children:e.milestones.length>0?(0,a.jsxs)("div",{children:[(0,a.jsxs)("div",{className:"text-sm text-neutral-900 mb-1",children:[e.milestones.filter(e=>"completed"===e.status).length,"/",e.milestones.length]}),(0,a.jsx)("div",{className:"w-20 bg-neutral-200 rounded-full h-2",children:(0,a.jsx)("div",{className:"bg-primary-600 h-2 rounded-full",style:{width:"".concat(0===(t=e.milestones).length?0:t.filter(e=>"completed"===e.status).length/t.length*100,"%")}})})]}):(0,a.jsx)("span",{className:"text-sm text-neutral-400",children:"No milestones"})}),(0,a.jsx)("td",{className:"px-6 py-4",children:(0,a.jsx)("span",{className:(0,p.cn)("px-2 py-1 text-xs font-medium rounded-full border",function(e){switch(e){case"approved":case"completed":return"bg-success-100 text-success-800 border-success-200";case"active":return"bg-info-100 text-info-800 border-info-200";case"pending_approval":return"bg-warning-100 text-warning-800 border-warning-200";case"rejected":return"bg-error-100 text-error-800 border-error-200";default:return"bg-neutral-100 text-neutral-800 border-neutral-200"}}(e.status)),children:e.status.replace("_"," ")})}),(0,a.jsx)("td",{className:"px-6 py-4 text-right",children:(0,a.jsxs)("div",{className:"flex items-center justify-end gap-2",children:[(0,a.jsx)("button",{className:"p-1 hover:bg-neutral-100 rounded",children:(0,a.jsx)(h.A,{className:"h-4 w-4 text-neutral-600"})}),(0,a.jsx)("button",{className:"p-1 hover:bg-neutral-100 rounded",children:(0,a.jsx)(j.A,{className:"h-4 w-4 text-neutral-600"})}),(0,a.jsx)("button",{className:"p-1 hover:bg-neutral-100 rounded",children:(0,a.jsx)(y.A,{className:"h-4 w-4 text-neutral-600"})}),"draft"===e.status&&(0,a.jsx)("button",{className:"p-1 hover:bg-neutral-100 rounded",children:(0,a.jsx)(f.A,{className:"h-4 w-4 text-primary-600"})})]})})]},e.id)})})]})})})}var g=s(14232);function N(){let{sows:e,filteredSOWs:t,filter:s,setFilter:r,loading:l,error:n}=function(){let[e,t]=(0,g.useState)([]),[s,a]=(0,g.useState)("all"),[r,l]=(0,g.useState)(!0),[n,i]=(0,g.useState)(null);(0,g.useEffect)(()=>{c()},[]);let c=async()=>{try{l(!0);let e=await fetch("/api/sow/list?type=all&pageSize=1000"),s=await e.json();if(!s.success)throw Error(s.error||"Failed to fetch SOW data");let a=s.data||[],r=new Map;a.forEach(e=>{let t=e.project_id;r.has(t)||r.set(t,{project_id:t,project_name:e.project_name||"Unknown Project",project_code:e.project_code||"",poles:[],drops:[],fibre:[]});let s=r.get(t);"pole"===e.type?s.poles.push(e):"drop"===e.type?s.drops.push(e):"fibre"===e.type&&s.fibre.push(e)});let n=Array.from(r.values()).map(e=>{let t=e.poles.length,s=e.drops.length,a=e.fibre.length,r=e.drops.filter(e=>e.address&&e.address.startsWith("LAW.ONT.DR")).length,l=e.drops.filter(e=>e.address&&("Spare"===e.address||e.address.toLowerCase().includes("spare"))).length,n=e.fibre.reduce((e,t)=>e+(parseFloat(t.distance)||0),0);return{id:e.project_id,sowNumber:"SOW-".concat(e.project_code||e.project_id.substring(0,8)),projectName:e.project_name,clientName:"Lawley Municipality",status:t>0||s>0||a>0?"active":"draft",version:"1.0",value:0,currency:"ZAR",startDate:new Date().toISOString(),endDate:new Date().toISOString(),scope:["".concat(t," poles"),"".concat(r," houses connected"),"".concat(l," spare drops"),"".concat(a," fibre segments (").concat((n/1e3).toFixed(2),"km)")],deliverables:["Network infrastructure data","Poles and drops mapping","Fibre route documentation"],milestones:[],approvals:[],documents:[],createdDate:new Date().toISOString(),lastModified:new Date().toISOString(),createdBy:"System Import",importedData:{poles:t,drops:s,houses:r,spares:l,fibre:a,fibreDistance:n}}});t(n),i(null)}catch(e){console.error("Error fetching SOW data:",e),i("Failed to load SOW data"),t([])}finally{l(!1)}},d="all"===s?e:e.filter(e=>e.status===s);return{sows:e,filteredSOWs:d,filter:s,setFilter:a,loading:r,error:n,refetch:c}}();return l?(0,a.jsx)("div",{className:"flex items-center justify-center h-64",children:(0,a.jsxs)("div",{className:"text-center",children:[(0,a.jsx)("div",{className:"animate-spin rounded-full h-12 w-12 border-b-2 border-primary mx-auto"}),(0,a.jsx)("p",{className:"mt-4 text-gray-600",children:"Loading SOW data from database..."})]})}):n?(0,a.jsx)("div",{className:"flex items-center justify-center h-64",children:(0,a.jsxs)("div",{className:"text-center text-red-600",children:[(0,a.jsx)("p",{className:"text-xl font-semibold",children:"Error loading SOW data"}),(0,a.jsx)("p",{className:"mt-2",children:n})]})}):(0,a.jsxs)("div",{className:"space-y-6",children:[(0,a.jsx)(i,{}),(0,a.jsx)(x,{sows:e}),(0,a.jsx)(m,{filter:s,onFilterChange:r}),(0,a.jsx)(b,{sows:t}),0===e.length&&(0,a.jsxs)("div",{className:"text-center py-8 text-gray-500",children:[(0,a.jsx)("p",{className:"text-lg",children:"No SOW data found"}),(0,a.jsx)("p",{className:"mt-2",children:"Import SOW data through the project import wizard to see it here"})]})]})}},89099:(e,t,s)=>{e.exports=s(6763)},98960:(e,t,s)=>{"use strict";s.d(t,{cn:()=>l});var a=s(69241),r=s(29573);function l(){for(var e=arguments.length,t=Array(e),s=0;s<e;s++)t[s]=arguments[s];return(0,r.QP)((0,a.$)(t))}}}]);