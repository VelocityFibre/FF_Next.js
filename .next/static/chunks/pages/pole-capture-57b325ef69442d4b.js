(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[7067],{1815:(e,t,r)=>{"use strict";r.d(t,{A:()=>l});let l=(0,r(56467).A)("Save",[["path",{d:"M19 21H5a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2h11l5 5v11a2 2 0 0 1-2 2z",key:"1owoqh"}],["polyline",{points:"17 21 17 13 7 13 7 21",key:"1md35c"}],["polyline",{points:"7 3 7 8 15 8",key:"8nz8an"}]])},10722:(e,t,r)=>{"use strict";r.r(t),r.d(t,{default:()=>v});var l=r(37876),a=r(1815),s=r(98960),n=r(14232),o=function(e){return e.NOT_STARTED="not_started",e.PLANNED="planned",e.APPROVED="approved",e.IN_PROGRESS="in_progress",e.INSTALLED="installed",e.TESTED="tested",e.COMPLETED="completed",e.CANCELLED="cancelled",e}({});let d=[{id:"pole_number",label:"Pole Number",required:!0,captured:!1},{id:"pole_overview",label:"Pole Overview",required:!0,captured:!1},{id:"drop_connections",label:"Drop Connections",required:!0,captured:!1},{id:"fiber_routing",label:"Fiber Routing",required:!0,captured:!1},{id:"ground_level",label:"Ground Level",required:!0,captured:!1},{id:"safety_compliance",label:"Safety Compliance",required:!0,captured:!1}];var u=r(16932),i=r(97842);function c(e){let{onCancel:t}=e;return(0,l.jsx)("div",{className:"sticky top-0 z-10 bg-white border-b border-neutral-200 px-4 py-3",children:(0,l.jsxs)("div",{className:"flex items-center justify-between",children:[(0,l.jsx)("h1",{className:"text-lg font-semibold",children:"Capture Pole Data"}),(0,l.jsx)("button",{onClick:t,className:"p-2 hover:bg-neutral-100 rounded-lg",children:(0,l.jsx)(i.A,{className:"h-5 w-5"})})]})})}var p=r(30449);let m=(0,r(56467).A)("Navigation",[["polygon",{points:"3 11 22 2 13 21 11 13 3 11",key:"1ltx0t"}]]);function x(e){let{gpsLocation:t,isCapturingGPS:r,onCaptureGPS:a}=e;return(0,l.jsxs)("div",{className:"bg-white rounded-lg p-4 border border-neutral-200",children:[(0,l.jsxs)("div",{className:"flex items-center justify-between mb-2",children:[(0,l.jsx)("label",{className:"text-sm font-medium text-neutral-700",children:"GPS Location *"}),t&&(0,l.jsx)(p.A,{className:"h-5 w-5 text-success-600"})]}),t?(0,l.jsxs)("div",{className:"text-sm text-neutral-600",children:["Lat: ",t.lat.toFixed(6),", Lng: ",t.lng.toFixed(6)]}):(0,l.jsx)("button",{onClick:a,disabled:r,className:"w-full px-4 py-2 bg-primary-600 text-white rounded-lg flex items-center justify-center gap-2",children:r?(0,l.jsx)(l.Fragment,{children:"Loading..."}):(0,l.jsxs)(l.Fragment,{children:[(0,l.jsx)(m,{className:"h-4 w-4"}),"Capture GPS Location"]})})]})}var b=r(88489);function h(e){let{photos:t,onPhotoCapture:r}=e;return(0,l.jsxs)("div",{className:"bg-white rounded-lg p-4 border border-neutral-200",children:[(0,l.jsxs)("h3",{className:"text-sm font-medium text-neutral-700 mb-3",children:["Required Photos (",t.filter(e=>e.captured).length,"/6)"]}),(0,l.jsx)("div",{className:"grid grid-cols-2 gap-3",children:t.map((e,t)=>(0,l.jsxs)("button",{onClick:()=>r(t),className:(0,s.cn)("relative aspect-square rounded-lg border-2 overflow-hidden",e.captured?"border-success-500 bg-success-50":"border-neutral-300 bg-neutral-50"),children:[e.captured&&e.url?(0,l.jsx)("img",{src:e.url,alt:e.label,className:"w-full h-full object-cover"}):(0,l.jsxs)("div",{className:"flex flex-col items-center justify-center h-full p-2",children:[(0,l.jsx)(b.A,{className:"h-6 w-6 text-neutral-400 mb-1"}),(0,l.jsx)("span",{className:"text-xs text-neutral-600 text-center",children:e.label})]}),e.captured&&(0,l.jsx)("div",{className:"absolute top-1 right-1 bg-success-600 rounded-full p-1",children:(0,l.jsx)(p.A,{className:"h-3 w-3 text-white"})}),e.required&&!e.captured&&(0,l.jsx)("div",{className:"absolute top-1 left-1",children:(0,l.jsx)("span",{className:"text-error-500 text-xs",children:"*"})})]},e.id))})]})}function g(e){let{formData:t,onAddDrop:r,onUpdateDrop:a}=e;return(0,l.jsxs)("div",{className:"bg-white rounded-lg p-4 border border-neutral-200",children:[(0,l.jsxs)("div",{className:"flex items-center justify-between mb-3",children:[(0,l.jsxs)("h3",{className:"text-sm font-medium text-neutral-700",children:["Drops (",t.currentDrops,"/",t.maxDrops,")"]}),t.currentDrops<t.maxDrops&&(0,l.jsx)("button",{onClick:r,className:"text-primary-600 text-sm",children:"+ Add Drop"})]}),t.drops.map((e,t)=>(0,l.jsxs)("div",{className:"mb-3 p-3 bg-neutral-50 rounded-lg",children:[(0,l.jsxs)("div",{className:"grid grid-cols-2 gap-2",children:[(0,l.jsx)("input",{type:"text",value:e.dropNumber,onChange:e=>a(t,"dropNumber",e.target.value),placeholder:"Drop #",className:"px-2 py-1 text-sm border border-neutral-300 rounded"}),(0,l.jsx)("input",{type:"text",value:e.customerName,onChange:e=>a(t,"customerName",e.target.value),placeholder:"Customer",className:"px-2 py-1 text-sm border border-neutral-300 rounded"})]}),(0,l.jsx)("input",{type:"text",value:e.address,onChange:e=>a(t,"address",e.target.value),placeholder:"Address",className:"w-full mt-2 px-2 py-1 text-sm border border-neutral-300 rounded"})]},t))]})}function N(e){let{projectId:t,onSave:r,onCancel:i}=e,{formData:p,setFormData:m,photos:b,gpsLocation:N,isCapturingGPS:v,fileInputRef:f,allRequiredComplete:j,captureGPS:y,handlePhotoCapture:w,handleFileSelect:D,addDrop:C,updateDrop:P,validateAndPrepareSaveData:A}=function(e){let[t,r]=(0,n.useState)({projectId:e,poleNumber:"",status:o.NOT_STARTED,maxDrops:12,currentDrops:0,drops:[]}),[l,a]=(0,n.useState)(d),[s,i]=(0,n.useState)(null),[c,p]=(0,n.useState)(!1),[m,x]=(0,n.useState)(null),b=(0,n.useRef)(null),h=t.poleNumber&&s&&l.filter(e=>e.required).every(e=>e.captured);return{formData:t,setFormData:r,photos:l,gpsLocation:s,isCapturingGPS:c,fileInputRef:b,allRequiredComplete:h,captureGPS:()=>{p(!0),"geolocation"in navigator?navigator.geolocation.getCurrentPosition(e=>{let t={lat:e.coords.latitude,lng:e.coords.longitude};i(t),r(e=>({...e,latitude:t.lat,longitude:t.lng})),p(!1)},e=>{u.Rm.error("GPS error:",{data:e},"usePoleCapture"),p(!1),alert("Unable to get GPS location. Please enable location services.")},{enableHighAccuracy:!0}):(alert("GPS not supported on this device"),p(!1))},handlePhotoCapture:e=>{var t;x(e),null==(t=b.current)||t.click()},handleFileSelect:e=>{var t;let r=null==(t=e.target.files)?void 0:t[0];if(r&&null!==m){let e=new FileReader;e.onload=e=>{var t;let s=[...l];s[m]={...s[m],captured:!0,url:null==(t=e.target)?void 0:t.result,file:r},a(s),x(null)},e.readAsDataURL(r)}},addDrop:()=>{if(t.currentDrops<t.maxDrops){let e={dropNumber:"D".concat(t.currentDrops+1),poleNumber:t.poleNumber,customerName:"",address:"",installationType:"aerial",status:"pending"};r(t=>({...t,drops:[...t.drops,e],currentDrops:t.currentDrops+1}))}},updateDrop:(e,l,a)=>{let s=[...t.drops];s[e]={...s[e],[l]:a},r(e=>({...e,drops:s}))},validateAndPrepareSaveData:()=>{if(!t.poleNumber)return alert("Pole number is required"),null;if(!s)return alert("GPS location is required"),null;if(!l.filter(e=>e.required).every(e=>e.captured))return alert("Please capture all required photos"),null;let e={vfPoleId:t.poleNumber,projectId:t.projectId,projectCode:"",poleNumber:t.poleNumber,dateInstalled:new Date,location:"".concat(t.latitude||0,", ").concat(t.longitude||0),poleType:"wooden",contractorId:"",workingTeam:"",dropCount:t.currentDrops,maxCapacity:t.maxDrops,connectedDrops:t.drops.map(e=>e.dropNumber),createdAt:new Date,updatedAt:new Date,createdBy:"",updatedBy:""};return t.status&&(e.status=t.status.toString()),t.latitude&&t.longitude&&(e.gpsCoordinates={latitude:t.latitude,longitude:t.longitude}),e}}}(t),k=async()=>{let e=A();e&&await r(e)};return(0,l.jsxs)("div",{className:"min-h-screen bg-neutral-50 pb-20",children:[(0,l.jsx)(c,{onCancel:i}),(0,l.jsxs)("div",{className:"p-4 space-y-4",children:[(0,l.jsxs)("div",{className:"bg-white rounded-lg p-4 border border-neutral-200",children:[(0,l.jsx)("label",{className:"block text-sm font-medium text-neutral-700 mb-2",children:"Pole Number *"}),(0,l.jsx)("input",{type:"text",value:p.poleNumber,onChange:e=>m(t=>({...t,poleNumber:e.target.value})),className:"w-full px-3 py-2 border border-neutral-300 rounded-lg",placeholder:"Enter pole number"})]}),(0,l.jsx)(x,{gpsLocation:N,isCapturingGPS:v,onCaptureGPS:y}),(0,l.jsx)(h,{photos:b,onPhotoCapture:w}),(0,l.jsx)(g,{formData:p,onAddDrop:C,onUpdateDrop:P}),(0,l.jsxs)("div",{className:"bg-white rounded-lg p-4 border border-neutral-200",children:[(0,l.jsx)("label",{className:"block text-sm font-medium text-neutral-700 mb-2",children:"Notes"}),(0,l.jsx)("textarea",{value:p.notes,onChange:e=>m(t=>({...t,notes:e.target.value})),className:"w-full px-3 py-2 border border-neutral-300 rounded-lg",rows:3,placeholder:"Additional notes..."})]})]}),(0,l.jsx)("input",{ref:f,type:"file",accept:"image/*",capture:"environment",onChange:D,className:"hidden"}),(0,l.jsx)("div",{className:"fixed bottom-0 left-0 right-0 bg-white border-t border-neutral-200 p-4",children:(0,l.jsxs)("button",{onClick:k,disabled:!j,className:(0,s.cn)("w-full py-3 rounded-lg font-medium flex items-center justify-center gap-2",j?"bg-primary-600 text-white":"bg-neutral-200 text-neutral-400"),children:[(0,l.jsx)(a.A,{className:"h-5 w-5"}),"Save Pole Data"]})})]})}function v(){return(0,l.jsx)(N,{})}},30449:(e,t,r)=>{"use strict";r.d(t,{A:()=>l});let l=(0,r(56467).A)("CheckCircle",[["path",{d:"M22 11.08V12a10 10 0 1 1-5.93-9.14",key:"g774vq"}],["polyline",{points:"22 4 12 14.01 9 11.01",key:"6xbx8j"}]])},36466:(e,t,r)=>{(window.__NEXT_P=window.__NEXT_P||[]).push(["/pole-capture",function(){return r(10722)}])},88489:(e,t,r)=>{"use strict";r.d(t,{A:()=>l});let l=(0,r(56467).A)("Camera",[["path",{d:"M14.5 4h-5L7 7H4a2 2 0 0 0-2 2v9a2 2 0 0 0 2 2h16a2 2 0 0 0 2-2V9a2 2 0 0 0-2-2h-3l-2.5-3z",key:"1tc9qg"}],["circle",{cx:"12",cy:"13",r:"3",key:"1vg3eu"}]])},97842:(e,t,r)=>{"use strict";r.d(t,{A:()=>l});let l=(0,r(56467).A)("X",[["path",{d:"M18 6 6 18",key:"1bl5f8"}],["path",{d:"m6 6 12 12",key:"d8bk6v"}]])},98960:(e,t,r)=>{"use strict";r.d(t,{cn:()=>s});var l=r(69241),a=r(29573);function s(){for(var e=arguments.length,t=Array(e),r=0;r<e;r++)t[r]=arguments[r];return(0,a.QP)((0,l.$)(t))}}},e=>{e.O(0,[2749,636,6593,8792],()=>e(e.s=36466)),_N_E=e.O()}]);