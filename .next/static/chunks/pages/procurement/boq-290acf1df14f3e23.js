(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[5229],{19625:(e,t,a)=>{"use strict";a.r(t),a.d(t,{__N_SSP:()=>W,default:()=>H});var r=a(37876),s=a(14232),c=a(89099),o=a(55194),n=a(28364);let i={search:"",status:"",mappingStatus:"",uploadedBy:"",dateRange:"all"},d={draft:"Draft",uploaded:"Uploaded",mapping:"Mapping",mapped:"Mapped",approved:"Approved",archived:"Archived"},l={draft:"bg-gray-100 text-gray-800",uploaded:"bg-blue-100 text-blue-800",mapping:"bg-yellow-100 text-yellow-800",mapped:"bg-green-100 text-green-800",approved:"bg-green-100 text-green-800",archived:"bg-gray-100 text-gray-800",mapping_review:"bg-orange-100 text-orange-800"},p={pending:"Pending",in_progress:"In Progress",mapped:"Mapped",exception:"Exception"},u={pending:"bg-gray-100 text-gray-800",in_progress:"bg-yellow-100 text-yellow-800",mapped:"bg-green-100 text-green-800",exception:"bg-red-100 text-red-800",completed:"bg-green-100 text-green-800"},m={currentUser:null,onAuthStateChanged:()=>()=>{},signOut:()=>Promise.resolve(),signInWithEmailAndPassword:()=>Promise.reject(Error("Use Clerk authentication")),createUserWithEmailAndPassword:()=>Promise.reject(Error("Use Clerk authentication"))};var h=a(76559),g=a(16932),y=a(95365);let x="/api/procurement";async function j(e){let t=await e.json();if(!t.success)throw Error(t.error||"API request failed");return t.data||t}let f=async()=>j(await fetch("".concat(x,"?resource=health"),{method:"GET"})),O={stock:{async getPositions(e,t){let a=new URLSearchParams({resource:"stock",projectId:e,...t});return j(await fetch("".concat(x,"?").concat(a),{method:"GET"}))},getPosition:async(e,t)=>j(await fetch("".concat(x,"?resource=stock&projectId=").concat(e,"&id=").concat(t),{method:"GET"})),createPosition:async(e,t)=>j(await fetch("".concat(x,"?resource=stock&projectId=").concat(e),{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(t)})),updatePosition:async(e,t,a)=>j(await fetch("".concat(x,"?resource=stock&projectId=").concat(e,"&id=").concat(t),{method:"PUT",headers:{"Content-Type":"application/json"},body:JSON.stringify(a)})),async deletePosition(e,t){let a=await fetch("".concat(x,"?resource=stock&projectId=").concat(e,"&id=").concat(t),{method:"DELETE"});await j(a)},async getMovements(e,t){let a=new URLSearchParams({resource:"stock",action:"movements",projectId:e,...t});return j(await fetch("".concat(x,"?").concat(a),{method:"GET"}))},createMovement:async(e,t)=>j(await fetch("".concat(x,"?resource=stock&action=movement&projectId=").concat(e),{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(t)})),processBulkMovement:async(e,t)=>j(await fetch("".concat(x,"?resource=stock&action=bulk-movement&projectId=").concat(e),{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(t)})),getDashboard:async e=>j(await fetch("".concat(x,"?resource=stock&action=dashboard&projectId=").concat(e),{method:"GET"}))},purchaseOrders:{async getOrders(e,t){let a=new URLSearchParams({resource:"purchase-orders",projectId:e,...t});return j(await fetch("".concat(x,"?").concat(a),{method:"GET"}))},getOrder:async(e,t)=>j(await fetch("".concat(x,"?resource=purchase-orders&projectId=").concat(e,"&id=").concat(t),{method:"GET"})),createOrder:async(e,t)=>j(await fetch("".concat(x,"?resource=purchase-orders&projectId=").concat(e),{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(t)})),updateOrder:async(e,t,a)=>j(await fetch("".concat(x,"?resource=purchase-orders&projectId=").concat(e,"&id=").concat(t),{method:"PUT",headers:{"Content-Type":"application/json"},body:JSON.stringify(a)})),async deleteOrder(e,t){let a=await fetch("".concat(x,"?resource=purchase-orders&projectId=").concat(e,"&id=").concat(t),{method:"DELETE"});await j(a)}},rfq:{async getRFQs(e,t){let a=new URLSearchParams({resource:"rfq",projectId:e,...t});return j(await fetch("".concat(x,"?").concat(a),{method:"GET"}))},getRFQ:async(e,t)=>j(await fetch("".concat(x,"?resource=rfq&projectId=").concat(e,"&id=").concat(t),{method:"GET"})),createRFQ:async(e,t)=>j(await fetch("".concat(x,"?resource=rfq&projectId=").concat(e),{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(t)})),updateRFQ:async(e,t,a)=>j(await fetch("".concat(x,"?resource=rfq&projectId=").concat(e,"&id=").concat(t),{method:"PUT",headers:{"Content-Type":"application/json"},body:JSON.stringify(a)})),async deleteRFQ(e,t){let a=await fetch("".concat(x,"?resource=rfq&projectId=").concat(e,"&id=").concat(t),{method:"DELETE"});await j(a)},getSupplierHistory:async(e,t)=>j(await fetch("".concat(x,"?resource=rfq&action=supplier-history&projectId=").concat(e,"&supplierId=").concat(t),{method:"GET"})),async addSuppliers(e,t,a){let r=await fetch("".concat(x,"?resource=rfq&action=add-suppliers&projectId=").concat(e,"&id=").concat(t),{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({supplierIds:a})});await j(r)},async replaceSuppliers(e,t,a){let r=await fetch("".concat(x,"?resource=rfq&action=replace-suppliers&projectId=").concat(e,"&id=").concat(t),{method:"PUT",headers:{"Content-Type":"application/json"},body:JSON.stringify({supplierIds:a})});await j(r)},async removeSuppliers(e,t,a){let r=await fetch("".concat(x,"?resource=rfq&action=remove-suppliers&projectId=").concat(e,"&id=").concat(t),{method:"DELETE",headers:{"Content-Type":"application/json"},body:JSON.stringify({supplierIds:a})});await j(r)}},boq:{async getBOQs(e,t){let a=new URLSearchParams({resource:"boq",projectId:e,...t});return j(await fetch("".concat(x,"?").concat(a),{method:"GET"}))},getBOQ:async(e,t)=>j(await fetch("".concat(x,"?resource=boq&projectId=").concat(e,"&id=").concat(t),{method:"GET"})),createBOQ:async(e,t)=>j(await fetch("".concat(x,"?resource=boq&projectId=").concat(e),{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(t)})),updateBOQ:async(e,t,a)=>j(await fetch("".concat(x,"?resource=boq&projectId=").concat(e,"&id=").concat(t),{method:"PUT",headers:{"Content-Type":"application/json"},body:JSON.stringify(a)})),async deleteBOQ(e,t){let a=await fetch("".concat(x,"?resource=boq&projectId=").concat(e,"&id=").concat(t),{method:"DELETE"});await j(a)},getItems:async(e,t)=>j(await fetch("".concat(x,"?resource=boq&action=items&projectId=").concat(e,"&boqId=").concat(t),{method:"GET"})),getExceptions:async(e,t)=>j(await fetch("".concat(x,"?resource=boq&action=exceptions&projectId=").concat(e,"&boqId=").concat(t),{method:"GET"})),importBOQ:async(e,t)=>j(await fetch("".concat(x,"?resource=boq&action=import&projectId=").concat(e),{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(t)})),async performMapping(e,t,a){let r=await fetch("".concat(x,"?resource=boq&action=map&projectId=").concat(e,"&id=").concat(t),{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({mappings:a})});await j(r)},async resolveException(e,t,a){let r=await fetch("".concat(x,"?resource=boq&action=resolve-exception&projectId=").concat(e,"&id=").concat(t),{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(a)});await j(r)}},healthCheck:f};class w{static async getStockPositions(e,t){let a=await O.stock.getPositions(e.projectId,t);return{positions:a.data,total:a.total,page:a.page,limit:a.limit}}static async getStockPositionById(e,t){return O.stock.getPosition(e.projectId,t)}static async createStockPosition(e,t){return O.stock.createPosition(e.projectId,t)}static async updateStockPosition(e,t,a){return O.stock.updatePosition(e.projectId,t,a)}static async getStockMovements(e,t){let a=await O.stock.getMovements(e.projectId,t);return{movements:a.data,total:a.total,page:a.page,limit:a.limit}}static async createStockMovement(e,t){return O.stock.createMovement(e.projectId,t)}static async processBulkMovement(e,t){return O.stock.processBulkMovement(e.projectId,{...t,userId:e.userId})}static async getDashboardData(e){return O.stock.getDashboard(e.projectId)}static async getBOQsByProject(e,t){return(await O.boq.getBOQs(t)).data}static async getBOQ(e,t){return O.boq.getBOQ(e.projectId,t)}static async getBOQWithItems(e,t){let[a,r,s]=await Promise.all([O.boq.getBOQ(e.projectId,t),O.boq.getItems(e.projectId,t),O.boq.getExceptions(e.projectId,t)]);return{...a,items:r,exceptions:s}}static async createBOQ(e,t){return O.boq.createBOQ(e.projectId,{...t,createdBy:e.userId})}static async updateBOQ(e,t,a){return O.boq.updateBOQ(e.projectId,t,a)}static async deleteBOQ(e,t){return O.boq.deleteBOQ(e.projectId,t)}static async importBOQ(e,t){return O.boq.importBOQ(e.projectId,t)}static async getBOQItems(e,t){return await O.boq.getItems(e.projectId,t)}static async getBOQItem(e,t){throw Error("getBOQItem not implemented - API endpoint needed")}static async createBOQItem(e,t,a){throw Error("createBOQItem not implemented - API endpoint needed")}static async updateBOQItem(e,t,a){throw Error("updateBOQItem not implemented - API endpoint needed")}static async deleteBOQItem(e,t){throw Error("deleteBOQItem not implemented - API endpoint needed")}static async getBOQExceptions(e,t){return await O.boq.getExceptions(e.projectId,t)}static async getBOQException(e,t){throw Error("getBOQException not implemented - API endpoint needed")}static async createBOQException(e,t,a){throw Error("createBOQException not implemented - API endpoint needed")}static async updateBOQException(e,t,a){throw Error("updateBOQException not implemented - API endpoint needed")}static async deleteException(e,t){throw Error("deleteException not implemented - API endpoint needed")}static async getRFQList(e,t){let a=await O.rfq.getRFQs(e.projectId,t);return{rfqs:a.data,total:a.total,page:a.page,limit:a.limit}}static async getRFQById(e,t){return O.rfq.getRFQ(e.projectId,t)}static async createRFQ(e,t){return O.rfq.createRFQ(e.projectId,{...t,createdBy:e.userId})}static async updateRFQ(e,t,a){return O.rfq.updateRFQ(e.projectId,t,a)}static async deleteRFQ(e,t){return O.rfq.deleteRFQ(e.projectId,t)}static async getPurchaseOrders(e,t){let a=await O.purchaseOrders.getOrders(e.projectId,t);return{orders:a.data,total:a.total,page:a.page,limit:a.limit}}static async getPurchaseOrderById(e,t){return O.purchaseOrders.getOrder(e.projectId,t)}static async createPurchaseOrder(e,t){return O.purchaseOrders.createOrder(e.projectId,{...t,createdBy:e.userId})}static async updatePurchaseOrder(e,t,a){return O.purchaseOrders.updateOrder(e.projectId,t,a)}static async deletePurchaseOrder(e,t){return O.purchaseOrders.deleteOrder(e.projectId,t)}static async getHealthStatus(){return O.healthCheck()}}let b={getBOQWithItems:w.getBOQWithItems,getBOQsByProject:w.getBOQsByProject,getBOQ:w.getBOQ,updateBOQ:w.updateBOQ,deleteBOQ:w.deleteBOQ,createBOQ:w.createBOQ,importBOQ:w.importBOQ,getBOQItems:w.getBOQItems,getBOQItem:w.getBOQItem,createBOQItem:w.createBOQItem,updateBOQItem:w.updateBOQItem,deleteBOQItem:w.deleteBOQItem,getBOQExceptions:w.getBOQExceptions,getBOQException:w.getBOQException,createBOQException:w.createBOQException,updateBOQException:w.updateBOQException,deleteException:w.deleteException,getStockPositions:w.getStockPositions,getStockPositionById:w.getStockPositionById,createStockPosition:w.createStockPosition,updateStockPosition:w.updateStockPosition,getStockMovements:w.getStockMovements,createStockMovement:w.createStockMovement,processBulkMovement:w.processBulkMovement,getDashboardData:w.getDashboardData,getRFQList:w.getRFQList,getRFQById:w.getRFQById,createRFQ:w.createRFQ,updateRFQ:w.updateRFQ,deleteRFQ:w.deleteRFQ,getPurchaseOrders:w.getPurchaseOrders,getPurchaseOrderById:w.getPurchaseOrderById,createPurchaseOrder:w.createPurchaseOrder,updatePurchaseOrder:w.updatePurchaseOrder,deletePurchaseOrder:w.deletePurchaseOrder,getHealthStatus:w.getHealthStatus};class B{}B.getBOQWithItems=w.getBOQWithItems,B.getBOQsByProject=w.getBOQsByProject,B.getBOQ=w.getBOQ,B.updateBOQ=w.updateBOQ,B.deleteBOQ=w.deleteBOQ,B.createBOQ=w.createBOQ,B.getBOQItems=w.getBOQItems,B.getBOQItem=w.getBOQItem,B.createBOQItem=w.createBOQItem,B.updateBOQItem=w.updateBOQItem,B.deleteBOQItem=w.deleteBOQItem,B.getBOQExceptions=w.getBOQExceptions,B.getBOQException=w.getBOQException,B.createBOQException=w.createBOQException,B.updateBOQException=w.updateBOQException,B.deleteException=w.deleteException;var Q=a(97685),v=a(59452),I=a(19878),N=a(30155),E=a(97730);function P(e){let{totalBOQs:t,filteredCount:a,showFilters:s,setShowFilters:c,onCreateBOQ:o,onUploadBOQ:n,onRefresh:i}=e;return(0,r.jsxs)("div",{className:"flex items-center justify-between",children:[(0,r.jsxs)("div",{children:[(0,r.jsx)("h2",{className:"text-xl font-semibold text-gray-900",children:"Bill of Quantities"}),(0,r.jsx)("p",{className:"text-sm text-gray-500 mt-1",children:a===t?"".concat(t," BOQs"):"".concat(a," of ").concat(t," BOQs")})]}),(0,r.jsxs)("div",{className:"flex items-center space-x-2",children:[(0,r.jsxs)("button",{onClick:()=>c(!s),className:"px-3 py-2 border rounded-md text-sm font-medium flex items-center ".concat(s?"bg-blue-50 border-blue-200 text-blue-700":"border-gray-300 text-gray-700 hover:bg-gray-50"),children:[(0,r.jsx)(v.A,{className:"h-4 w-4 mr-2"}),"Filters"]}),(0,r.jsxs)("button",{onClick:i,className:"px-3 py-2 border border-gray-300 text-gray-700 rounded-md text-sm font-medium hover:bg-gray-50 flex items-center",children:[(0,r.jsx)(I.A,{className:"h-4 w-4 mr-2"}),"Refresh"]}),n&&(0,r.jsxs)("button",{onClick:n,className:"px-3 py-2 bg-blue-600 text-white rounded-md text-sm font-medium hover:bg-blue-700 flex items-center",children:[(0,r.jsx)(N.A,{className:"h-4 w-4 mr-2"}),"Upload BOQ"]}),o&&(0,r.jsxs)("button",{onClick:o,className:"px-3 py-2 bg-blue-600 text-white rounded-md text-sm font-medium hover:bg-blue-700 flex items-center",children:[(0,r.jsx)(E.A,{className:"h-4 w-4 mr-2"}),"Create BOQ"]})]})]})}var S=a(17734),k=a(51165),C=a(21744);function T(e){let{filters:t,setFilters:a,uploaders:s}=e;return(0,r.jsxs)("div",{className:"bg-white p-4 rounded-lg border space-y-3",children:[(0,r.jsxs)("div",{className:"grid grid-cols-1 md:grid-cols-5 gap-3",children:[(0,r.jsxs)("div",{className:"relative md:col-span-2",children:[(0,r.jsx)(S.A,{className:"absolute left-3 top-1/2 transform -translate-y-1/2 h-4 w-4 text-gray-400"}),(0,r.jsx)("input",{type:"text",placeholder:"Search BOQs...",value:t.search,onChange:e=>a({...t,search:e.target.value}),className:"pl-10 pr-4 py-2 w-full border border-gray-300 rounded-md text-sm"})]}),(0,r.jsxs)("select",{value:t.status,onChange:e=>a({...t,status:e.target.value}),className:"px-3 py-2 border border-gray-300 rounded-md text-sm",children:[(0,r.jsx)("option",{value:"",children:"All Statuses"}),Object.entries(d).map(e=>{let[t,a]=e;return(0,r.jsx)("option",{value:t,children:a},t)})]}),(0,r.jsxs)("select",{value:t.mappingStatus,onChange:e=>a({...t,mappingStatus:e.target.value}),className:"px-3 py-2 border border-gray-300 rounded-md text-sm",children:[(0,r.jsx)("option",{value:"",children:"All Mapping"}),Object.entries(p).map(e=>{let[t,a]=e;return(0,r.jsx)("option",{value:t,children:a},t)})]}),(0,r.jsxs)("div",{className:"relative",children:[(0,r.jsx)(k.A,{className:"absolute left-3 top-1/2 transform -translate-y-1/2 h-4 w-4 text-gray-400"}),(0,r.jsxs)("select",{value:t.uploadedBy,onChange:e=>a({...t,uploadedBy:e.target.value}),className:"pl-10 pr-4 py-2 w-full border border-gray-300 rounded-md text-sm",children:[(0,r.jsx)("option",{value:"",children:"All Users"}),s.map(e=>(0,r.jsx)("option",{value:e,children:e},e))]})]})]}),(0,r.jsxs)("div",{className:"flex items-center justify-between",children:[(0,r.jsxs)("div",{className:"relative",children:[(0,r.jsx)(C.A,{className:"absolute left-3 top-1/2 transform -translate-y-1/2 h-4 w-4 text-gray-400"}),(0,r.jsxs)("select",{value:t.dateRange,onChange:e=>a({...t,dateRange:e.target.value}),className:"pl-10 pr-4 py-2 border border-gray-300 rounded-md text-sm",children:[(0,r.jsx)("option",{value:"all",children:"All Time"}),(0,r.jsx)("option",{value:"7days",children:"Last 7 Days"}),(0,r.jsx)("option",{value:"30days",children:"Last 30 Days"}),(0,r.jsx)("option",{value:"90days",children:"Last 90 Days"})]})]}),Object.values(t).some(e=>""!==e&&"all"!==e)&&(0,r.jsx)("button",{onClick:()=>a(i),className:"text-sm text-blue-600 hover:text-blue-700",children:"Clear filters"})]})]})}var A=a(30449),R=a(18024),F=a(66691),q=a(80192),U=a(30359),L=a(58618),D=a(46618),M=a(30512),J=a(36535);function _(e){let{boq:t,isSelected:a=!1,onClick:c,onView:o,onEdit:i,onDownload:d,onArchive:p,onDelete:m,actionMenuOpen:h,setActionMenuOpen:g}=e,y=(0,s.useRef)(null);return(0,s.useEffect)(()=>{let e=e=>{y.current&&!y.current.contains(e.target)&&g(!1)};return h?(document.addEventListener("mousedown",e),()=>document.removeEventListener("mousedown",e)):()=>{}},[h,g]),(0,r.jsx)("div",{className:"bg-white rounded-lg border p-4 hover:shadow-md transition-shadow cursor-pointer ".concat(a?"border-blue-500 shadow-md":"border-gray-200"),onClick:c,children:(0,r.jsxs)("div",{className:"flex items-start justify-between",children:[(0,r.jsxs)("div",{className:"flex-1 min-w-0",children:[(0,r.jsxs)("div",{className:"flex items-center space-x-3",children:[(0,r.jsx)(n.A,{className:"h-5 w-5 text-blue-500 flex-shrink-0"}),(0,r.jsxs)("div",{className:"min-w-0 flex-1",children:[(0,r.jsx)("h3",{className:"text-lg font-medium text-gray-900 truncate",children:t.title||t.fileName}),(0,r.jsxs)("div",{className:"flex items-center space-x-2 mt-1",children:[(0,r.jsx)("span",{className:"px-2 py-1 rounded-full text-xs font-medium ".concat(l[t.status]),children:t.status.charAt(0).toUpperCase()+t.status.slice(1)}),(0,r.jsxs)("span",{className:"text-sm text-gray-500",children:["v",t.version]})]})]})]}),(0,r.jsxs)("div",{className:"mt-3 flex items-center space-x-4 text-sm text-gray-500",children:[(0,r.jsxs)("div",{className:"flex items-center",children:[(0,r.jsx)(C.A,{className:"h-4 w-4 mr-1"}),new Date(t.createdAt).toLocaleDateString()]}),(0,r.jsxs)("div",{className:"flex items-center",children:[(0,r.jsx)(k.A,{className:"h-4 w-4 mr-1"}),t.uploadedBy]}),(0,r.jsxs)("div",{className:"flex items-center",children:[(0,r.jsx)(n.A,{className:"h-4 w-4 mr-1"}),t.itemCount||0," items"]})]}),t.description&&(0,r.jsx)("p",{className:"mt-2 text-sm text-gray-600 line-clamp-2",children:t.description}),(0,r.jsxs)("div",{className:"mt-3 flex items-center justify-between",children:[(0,r.jsxs)("div",{className:"flex items-center space-x-3",children:[(0,r.jsxs)("div",{className:"flex items-center",children:[(e=>{switch(e){case"mapped":return(0,r.jsx)(A.A,{className:"h-4 w-4 text-green-500"});case"mapping":return(0,r.jsx)(R.A,{className:"h-4 w-4 text-yellow-500"});case"exception":return(0,r.jsx)(F.A,{className:"h-4 w-4 text-red-500"});default:return(0,r.jsx)(R.A,{className:"h-4 w-4 text-gray-500"})}})(t.mappingStatus||"pending"),(0,r.jsx)("span",{className:"ml-1 px-2 py-1 rounded-full text-xs font-medium ".concat(u[t.mappingStatus||"pending"]),children:t.mappingStatus||"Pending"})]}),t.itemCount>0&&(0,r.jsxs)("div",{className:"text-sm text-gray-500",children:[Math.round(t.mappedItems/t.itemCount*100),"% mapped"]})]}),t.itemCount>0&&(0,r.jsx)("div",{className:"w-24 bg-gray-200 rounded-full h-2",children:(0,r.jsx)("div",{className:"bg-blue-600 h-2 rounded-full",style:{width:"".concat(Math.round(t.mappedItems/t.itemCount*100),"%")}})})]})]}),(0,r.jsxs)("div",{className:"relative ml-4",ref:y,children:[(0,r.jsx)("button",{onClick:e=>{e.stopPropagation(),g(!h)},className:"p-1 text-gray-500 hover:text-gray-700",children:(0,r.jsx)(q.A,{className:"h-5 w-5"})}),h&&(0,r.jsx)("div",{className:"absolute right-0 mt-1 w-48 bg-white rounded-md shadow-lg border z-10",children:(0,r.jsxs)("div",{className:"py-1",children:[(0,r.jsxs)("button",{onClick:e=>{e.stopPropagation(),o()},className:"w-full text-left px-4 py-2 text-sm text-gray-700 hover:bg-gray-50 flex items-center",children:[(0,r.jsx)(U.A,{className:"h-4 w-4 mr-3"}),"View Details"]}),(0,r.jsxs)("button",{onClick:e=>{e.stopPropagation(),i()},className:"w-full text-left px-4 py-2 text-sm text-gray-700 hover:bg-gray-50 flex items-center",children:[(0,r.jsx)(L.A,{className:"h-4 w-4 mr-3"}),"Edit BOQ"]}),(0,r.jsxs)("button",{onClick:e=>{e.stopPropagation(),d()},className:"w-full text-left px-4 py-2 text-sm text-gray-700 hover:bg-gray-50 flex items-center",children:[(0,r.jsx)(D.A,{className:"h-4 w-4 mr-3"}),"Download"]}),(0,r.jsx)("div",{className:"border-t border-gray-100"}),(0,r.jsxs)("button",{onClick:e=>{e.stopPropagation(),p()},className:"w-full text-left px-4 py-2 text-sm text-gray-700 hover:bg-gray-50 flex items-center",children:[(0,r.jsx)(M.A,{className:"h-4 w-4 mr-3"}),"Archive"]}),(0,r.jsxs)("button",{onClick:e=>{e.stopPropagation(),m()},className:"w-full text-left px-4 py-2 text-sm text-red-600 hover:bg-red-50 flex items-center",children:[(0,r.jsx)(J.A,{className:"h-4 w-4 mr-3"}),"Delete"]})]})})]})]})})}function G(e){let{onSelectBOQ:t,onCreateBOQ:a,onUploadBOQ:d,selectedBOQId:l,className:p}=e,{boqs:u,filteredAndSortedBOQs:x,filters:j,setFilters:f,isLoading:O,showFilters:w,setShowFilters:B,actionMenuOpen:v,setActionMenuOpen:I,filterOptions:N,loadBOQs:E,handleViewBOQ:S,handleEditBOQ:k,handleDownloadBOQ:C,handleArchiveBOQ:A,handleDeleteBOQ:R}=(e=>{let{context:t}=function(){let{user:e,isLoading:t}=function(){let[e,t]=(0,s.useState)(null),[a,r]=(0,s.useState)(!0),[c,o]=(0,s.useState)(null);return(0,s.useEffect)(()=>{let e=(0,h.hg)(m,e=>{e?t({id:e.uid,email:e.email,name:e.displayName,photoURL:e.photoURL,role:"user",permissions:[]}):t(null),r(!1)},e=>{g.Rm.error("Auth state change error:",{data:e},"useAuth"),o(e.message),r(!1)});return()=>e()},[]),{user:e,isLoading:a,isAuthenticated:!!e,error:c}}(),{currentProject:a,isLoading:r}=function(){let e=(0,c.useRouter)(),t="string"==typeof e.query.projectId?e.query.projectId:void 0,[a,r]=(0,s.useState)(null),[o,n]=(0,s.useState)(!1),[i,d]=(0,s.useState)(null),l=async e=>{try{n(!0),d(null);let t=await y.Q.getById(e);r(t)}catch(e){g.Rm.error("Failed to load project:",{data:e},"useProject"),d(e instanceof Error?e.message:"Failed to load project"),r(null)}finally{n(!1)}},p=async()=>{t&&await l(t)};return(0,s.useEffect)(()=>{if(t)l(t);else{let e=localStorage.getItem("currentProjectId");e&&l(e)}},[t]),{currentProject:a,isLoading:o,error:i,setCurrentProject:r,refreshProject:p}}(),o=e?a?null:"No project selected":"User not authenticated",n=e&&a?{userId:e.id,userName:e.name||e.email||"Unknown User",projectId:a.id,projectName:a.name,permissions:{canCreateBOQ:!0,canEditBOQ:!0,canDeleteBOQ:!1,canApproveBOQ:!1,canCreateRFQ:!0,canEditRFQ:!0,canDeleteRFQ:!1,canCreatePO:!0,canEditPO:!0,canDeletePO:!1,canApprovePO:!1,canManageStock:!0,canViewReports:!0,isAdmin:!1},metadata:{userEmail:e.email||"",timestamp:new Date}}:null;return{context:n,isLoading:t||r,error:o,hasContext:!!n}}(),[a,r]=(0,s.useState)([]),[o,n]=(0,s.useState)(i),[d,l]=(0,s.useState)("createdAt"),[p,u]=(0,s.useState)("desc"),[x,j]=(0,s.useState)(!0),[f,O]=(0,s.useState)(!1),[w,B]=(0,s.useState)(null);(0,s.useEffect)(()=>{v()},[t]);let v=async()=>{if(t)try{j(!0);let e=await b.getBOQsByProject(t,t.projectId);r(e)}catch(e){g.Rm.error("Failed to load BOQs:",{data:e},"useBOQList"),Q.Ay.error("Failed to load BOQs")}finally{j(!1)}},I=(0,s.useMemo)(()=>({uploaders:[...new Set(a.map(e=>e.uploadedBy).filter(Boolean))]}),[a]),N=(0,s.useMemo)(()=>{let e=a.filter(e=>{if(o.search){var t,a,r;let s=o.search.toLowerCase();if(!(null==(t=e.title)?void 0:t.toLowerCase().includes(s))&&!(null==(a=e.fileName)?void 0:a.toLowerCase().includes(s))&&!(null==(r=e.description)?void 0:r.toLowerCase().includes(s)))return!1}if(o.status&&e.status!==o.status||o.mappingStatus&&e.mappingStatus!==o.mappingStatus||o.uploadedBy&&e.uploadedBy!==o.uploadedBy)return!1;if("all"!==o.dateRange){let t=new Date,a=new Date(e.createdAt),r=Math.floor((t.getTime()-a.getTime())/864e5);switch(o.dateRange){case"7days":if(r>7)return!1;break;case"30days":if(r>30)return!1;break;case"90days":if(r>90)return!1}}return!0});return e.sort((e,t)=>{let a,r;switch(d){case"createdAt":a=new Date(e.createdAt).getTime(),r=new Date(t.createdAt).getTime();break;case"version":a=e.version,r=t.version;break;case"itemCount":a=e.itemCount||0,r=t.itemCount||0;break;case"mappingProgress":a=e.mappingProgress||0,r=t.mappingProgress||0;break;case"status":a=e.status,r=t.status;break;default:return 0}return"asc"===p?a<r?-1:+(a>r):a>r?-1:+(a<r)}),e},[a,o,d,p]),E=async e=>{try{let t=new Blob([JSON.stringify(e,null,2)],{type:"application/json"}),a=URL.createObjectURL(t),r=document.createElement("a");r.href=a,r.download="".concat(e.fileName||"boq","_").concat(new Date().toISOString().split("T")[0],".json"),document.body.appendChild(r),r.click(),document.body.removeChild(r),URL.revokeObjectURL(a),Q.Ay.success("BOQ downloaded successfully")}catch(e){g.Rm.error("Failed to download BOQ:",{data:e},"useBOQList"),Q.Ay.error("Failed to download BOQ")}B(null)},P=async e=>{try{r(t=>t.map(t=>t.id===e.id?{...t,status:"archived"}:t)),Q.Ay.success("BOQ archived successfully")}catch(e){g.Rm.error("Failed to archive BOQ:",{data:e},"useBOQList"),Q.Ay.error("Failed to archive BOQ")}B(null)},S=async e=>{if(window.confirm("Are you sure you want to delete this BOQ? This action cannot be undone.")){try{await b.deleteBOQ(t,e.id),r(t=>t.filter(t=>t.id!==e.id)),Q.Ay.success("BOQ deleted successfully")}catch(e){g.Rm.error("Failed to delete BOQ:",{data:e},"useBOQList"),Q.Ay.error("Failed to delete BOQ")}B(null)}};return{boqs:a,filteredAndSortedBOQs:N,filters:o,setFilters:n,sortField:d,sortDirection:p,handleSort:e=>{d===e?u(e=>"asc"===e?"desc":"asc"):(l(e),u("asc"))},isLoading:x,showFilters:f,setShowFilters:O,actionMenuOpen:w,setActionMenuOpen:B,filterOptions:I,loadBOQs:v,handleViewBOQ:t=>{null==e||e(t),B(null)},handleEditBOQ:e=>{B(null)},handleDownloadBOQ:E,handleArchiveBOQ:P,handleDeleteBOQ:S}})(t);return O?(0,r.jsxs)("div",{className:"flex items-center justify-center h-64",children:[(0,r.jsx)(o.A,{className:"h-8 w-8 animate-spin text-blue-600"}),(0,r.jsx)("span",{className:"ml-2 text-gray-600",children:"Loading BOQs..."})]}):(0,r.jsxs)("div",{className:"space-y-6 ".concat(p),children:[(0,r.jsx)(P,{totalBOQs:u.length,filteredCount:x.length,showFilters:w,setShowFilters:B,onCreateBOQ:a,onUploadBOQ:d,onRefresh:E}),w&&(0,r.jsx)(T,{filters:j,setFilters:f,uploaders:N.uploaders}),x.length>0?(0,r.jsx)("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6",children:x.map(e=>(0,r.jsx)(_,{boq:e,isSelected:l===e.id,onClick:()=>S(e),onView:()=>S(e),onEdit:()=>k(e),onDownload:()=>C(e),onArchive:()=>A(e),onDelete:()=>R(e),actionMenuOpen:v===e.id,setActionMenuOpen:t=>I(t?e.id:null)},e.id))}):(0,r.jsxs)("div",{className:"text-center py-12 bg-white rounded-lg border",children:[(0,r.jsx)(n.A,{className:"mx-auto h-12 w-12 text-gray-400"}),(0,r.jsx)("h3",{className:"mt-4 text-lg font-medium text-gray-900",children:"No BOQs Found"}),(0,r.jsx)("p",{className:"mt-2 text-sm text-gray-500",children:0===u.length?"No BOQs have been created for this project yet.":"No BOQs match your current filters."}),0===u.length&&(a||d)&&(0,r.jsxs)("div",{className:"mt-6 flex justify-center space-x-3",children:[a&&(0,r.jsx)("button",{onClick:a,className:"px-4 py-2 bg-blue-600 text-white rounded-md text-sm font-medium hover:bg-blue-700",children:"Create BOQ"}),d&&(0,r.jsx)("button",{onClick:d,className:"px-4 py-2 border border-gray-300 text-gray-700 rounded-md text-sm font-medium hover:bg-gray-50",children:"Upload BOQ"})]}),Object.values(j).some(e=>""!==e&&"all"!==e)&&(0,r.jsx)("button",{onClick:()=>f(i),className:"mt-4 px-4 py-2 bg-blue-600 text-white rounded-md text-sm font-medium hover:bg-blue-700",children:"Clear Filters"})]})]})}var W=!0;function H(e){let{projectId:t,projectName:a,initialData:o=[]}=e,n=(0,c.useRouter)(),[i,d]=(0,s.useState)(o),[l,p]=(0,s.useState)(!o.length);(0,s.useEffect)(()=>{o.length||u()},[t]);let u=async()=>{p(!0);try{let e=await fetch(t?"/api/procurement/boq?projectId=".concat(t):"/api/procurement/boq");if(!e.ok)throw Error("Failed to load BOQ data");let a=await e.json();d(a.items||[])}catch(e){console.error("Error loading BOQ data:",e)}finally{p(!1)}};return(0,r.jsx)("div",{className:"min-h-screen bg-gray-50",children:(0,r.jsxs)("div",{className:"max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-8",children:[(0,r.jsxs)("div",{className:"mb-8",children:[(0,r.jsx)("h1",{className:"text-3xl font-bold text-gray-900",children:"Bill of Quantities"}),a&&(0,r.jsxs)("p",{className:"mt-2 text-gray-600",children:["Project: ",a]})]}),l?(0,r.jsx)("div",{className:"flex justify-center items-center h-64",children:(0,r.jsx)("div",{className:"text-gray-500",children:"Loading BOQ data..."})}):(0,r.jsx)(G,{onCreateBOQ:()=>{n.push("/procurement/boq/new")},className:"mt-6"})]})})}},34001:(e,t,a)=>{(window.__NEXT_P=window.__NEXT_P||[]).push(["/procurement/boq",function(){return a(19625)}])},95365:(e,t,a)=>{"use strict";a.d(t,{Q:()=>c});var r=a(16932);class s{async getAll(){try{let e=await fetch(this.baseUrl);if(!e.ok)throw Error("Failed to fetch projects: ".concat(e.statusText));return(await e.json()).projects||[]}catch(e){throw r.Rm.error("Error fetching projects:",e,"ProjectsService"),e}}async getById(e){try{let t=await fetch("".concat(this.baseUrl,"/").concat(e));if(!t.ok){if(404===t.status)return null;throw Error("Failed to fetch project: ".concat(t.statusText))}return(await t.json()).project}catch(e){throw r.Rm.error("Error fetching project by ID:",e,"ProjectsService"),e}}async create(e){try{let t=await fetch(this.baseUrl,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(e)});if(!t.ok)throw Error("Failed to create project: ".concat(t.statusText));return(await t.json()).project}catch(e){throw r.Rm.error("Error creating project:",e,"ProjectsService"),e}}async update(e,t){try{let a=await fetch("".concat(this.baseUrl,"/").concat(e),{method:"PUT",headers:{"Content-Type":"application/json"},body:JSON.stringify(t)});if(!a.ok)throw Error("Failed to update project: ".concat(a.statusText));return(await a.json()).project}catch(e){throw r.Rm.error("Error updating project:",e,"ProjectsService"),e}}async delete(e){try{let t=await fetch("".concat(this.baseUrl,"/").concat(e),{method:"DELETE"});if(!t.ok)throw Error("Failed to delete project: ".concat(t.statusText))}catch(e){throw r.Rm.error("Error deleting project:",e,"ProjectsService"),e}}async getByClient(e){try{let t=await fetch("".concat(this.baseUrl,"?clientId=").concat(e));if(!t.ok)throw Error("Failed to fetch projects by client: ".concat(t.statusText));return(await t.json()).projects||[]}catch(e){throw r.Rm.error("Error fetching projects by client:",e,"ProjectsService"),e}}async getStats(){try{let e=await fetch("".concat(this.baseUrl,"/stats"));if(!e.ok)throw Error("Failed to fetch project stats: ".concat(e.statusText));return await e.json()}catch(e){throw r.Rm.error("Error fetching project stats:",e,"ProjectsService"),e}}async search(e){try{let t=await fetch("".concat(this.baseUrl,"/search?q=").concat(encodeURIComponent(e)));if(!t.ok)throw Error("Failed to search projects: ".concat(t.statusText));return(await t.json()).projects||[]}catch(e){throw r.Rm.error("Error searching projects:",e,"ProjectsService"),e}}constructor(){this.baseUrl="/api/projects"}}let c=new s}},e=>{e.O(0,[7020,6672,7726,636,6593,8792],()=>e(e.s=34001)),_N_E=e.O()}]);