"use strict";(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[6656],{6656:(e,t,r)=>{r.r(t),r.d(t,{ProjectCreationWizard:()=>F});var a=r(37876),s=r(14232),n=r(89099),i=r(48230),l=r.n(i),o=r(88992),d=r(30449),c=r(18935),u=r(7342),m=r(19264),x=r(59516),p=r(1714),g=r(87212),b=r(49249),f=r(79890);let h=[{id:"basic",title:"Basic Information",description:"Project name, client, and timeline",icon:b.A,component:"basic"},{id:"details",title:"Project Details",description:"Location, budget, and team assignment",icon:f.A,component:"details"},{id:"review",title:"Review & Create",description:"Review all information and create project",icon:d.A,component:"review"}];var j=r(98960);function y(e){let{currentStep:t}=e;return(0,a.jsxs)("div",{className:"mb-8",children:[(0,a.jsx)("h1",{className:"text-2xl font-bold text-gray-900 mb-6",children:"Create New Project"}),(0,a.jsx)("div",{className:"flex items-center justify-between mb-6",children:h.map((e,r)=>{let s=r===t,n=r<t,i=e.icon;return(0,a.jsxs)("div",{className:"flex items-center flex-1",children:[(0,a.jsxs)("div",{className:"flex flex-col items-center",children:[(0,a.jsx)("div",{className:(0,j.cn)("w-10 h-10 rounded-full flex items-center justify-center mb-2",s?"bg-blue-600 text-white":n?"bg-green-600 text-white":"bg-gray-200 text-gray-600"),children:(0,a.jsx)(i,{size:20})}),(0,a.jsxs)("div",{className:"text-center",children:[(0,a.jsx)("p",{className:(0,j.cn)("text-sm font-medium",s?"text-blue-600":n?"text-green-600":"text-gray-500"),children:e.title}),(0,a.jsx)("p",{className:"text-xs text-gray-500 hidden sm:block",children:e.description})]})]}),r<h.length-1&&(0,a.jsx)("div",{className:(0,j.cn)("flex-1 h-px mx-4 mt-5",n?"bg-green-600":"bg-gray-200")})]},e.id)})})]})}var N=r(75375),v=r(55194);function w(e){let{currentStep:t,onPrevious:r,onNext:s,onSubmit:n,isSubmitting:i,isLastStep:l}=e;return(0,a.jsxs)("div",{className:"flex justify-between items-center pt-6 border-t border-gray-200",children:[(0,a.jsxs)("button",{type:"button",onClick:r,disabled:0===t,className:"flex items-center px-4 py-2 text-sm font-medium text-gray-700 bg-white border border-gray-300 rounded-md hover:bg-gray-50 disabled:opacity-50 disabled:cursor-not-allowed",children:[(0,a.jsx)(N.A,{size:16,className:"mr-2"}),"Previous"]}),(0,a.jsxs)("div",{className:"text-sm text-gray-500",children:["Step ",t+1," of ",h.length]}),l?(0,a.jsx)("button",{type:"button",onClick:n,disabled:i,className:"flex items-center px-6 py-2 text-sm font-medium text-white bg-blue-600 border border-transparent rounded-md hover:bg-blue-700 disabled:opacity-50 disabled:cursor-not-allowed",children:i?(0,a.jsxs)(a.Fragment,{children:[(0,a.jsx)(v.A,{size:16,className:"mr-2 animate-spin"}),"Creating Project..."]}):"Create Project"}):(0,a.jsxs)("button",{type:"button",onClick:s,className:"flex items-center px-4 py-2 text-sm font-medium text-white bg-blue-600 border border-transparent rounded-md hover:bg-blue-700",children:["Next",(0,a.jsx)(m.A,{size:16,className:"ml-2"})]})]})}async function C(e,t){try{var r;let a=await fetch("https://nominatim.openstreetmap.org/reverse?format=json&lat=".concat(e,"&lon=").concat(t,"&countrycodes=za&addressdetails=1&accept-language=en"),{headers:{"User-Agent":"FibreFlow-Project-Management"}});if(!a.ok)throw Error("Geocoding service unavailable");let s=await a.json();if(!s||!s.address)return null;let n=s.address,i=n.city||n.town||n.village||n.suburb||n.hamlet||"Unknown City",l=n.municipality||n.county||n.state_district||function(e){if(!e)return null;for(let t of[/([A-Za-z\s]+)\s+Local\s+Municipality/i,/([A-Za-z\s]+)\s+Municipality/i,/([A-Za-z\s]+)\s+Metropolitan\s+Municipality/i,/([A-Za-z\s]+)\s+District\s+Municipality/i]){let r=e.match(t);if(r)return r[1].trim()}return null}(s.display_name)||"Unknown Municipality",o=(r=n.state||n.province)?({"eastern cape":"Eastern Cape",ec:"Eastern Cape","free state":"Free State",fs:"Free State",gauteng:"Gauteng",gp:"Gauteng","kwazulu-natal":"KwaZulu-Natal",kzn:"KwaZulu-Natal",limpopo:"Limpopo",lp:"Limpopo",mpumalanga:"Mpumalanga",mp:"Mpumalanga","northern cape":"Northern Cape",nc:"Northern Cape","north west":"North West",northwest:"North West",nw:"North West","western cape":"Western Cape",wc:"Western Cape"})[r.toLowerCase().trim()]||r:"";return{city:i.trim(),municipalDistrict:l.trim(),province:o}}catch(e){return null}}function E(e,t){let r=t.toUpperCase(),a=parseFloat(e.replace(/[°'"″′]/g,""));if(!isNaN(a))return a*("S"===r||"W"===r?-1:1);let s=e.match(/(\d+)(?:°|d)?\s*(\d+(?:\.\d+)?)(?:['′]|m)?\s*(\d+(?:\.\d+)?)(?:["″]|s)?/i);if(s){let e=parseInt(s[1]),t=parseFloat(s[2])||0;return(e+t/60+(parseFloat(s[3])||0)/3600)*("S"===r||"W"===r?-1:1)}return null}var P=r(16932);function S(e){let{register:t,errors:r,clients:s,isClientsLoading:n}=e;return(0,a.jsxs)("div",{className:"space-y-6",children:[(0,a.jsxs)("div",{children:[(0,a.jsx)("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Project Name *"}),(0,a.jsx)("input",{...t("name",{required:"Project name is required"}),type:"text",className:"w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500",placeholder:"Enter project name"}),r.name&&(0,a.jsx)("p",{className:"mt-1 text-sm text-red-600",children:r.name.message})]}),(0,a.jsxs)("div",{children:[(0,a.jsx)("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Description"}),(0,a.jsx)("textarea",{...t("description"),rows:3,className:"w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500",placeholder:"Brief description of the project"})]}),(0,a.jsxs)("div",{children:[(0,a.jsx)("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Client *"}),n?(0,a.jsx)("div",{className:"w-full px-3 py-2 border border-gray-300 rounded-md bg-gray-50",children:"Loading clients..."}):(0,a.jsxs)("select",{...t("clientId",{required:"Client is required"}),className:"w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500",children:[(0,a.jsx)("option",{value:"",children:"Select a client"}),null==s?void 0:s.map(e=>(0,a.jsx)("option",{value:e.id,children:e.name},e.id))]}),r.clientId&&(0,a.jsx)("p",{className:"mt-1 text-sm text-red-600",children:r.clientId.message})]})]})}function I(e){var t,r,s,n;let{register:i,errors:l,gpsState:o,onGetCurrentLocation:d,onGpsInputParse:c,onGpsInputChange:u}=e,{isGeocoding:m,geocodingError:x,gpsInput:p}=o;return(0,a.jsxs)("div",{children:[(0,a.jsxs)("div",{className:"flex items-center justify-between mb-2",children:[(0,a.jsx)("label",{className:"block text-sm font-medium text-gray-700",children:"GPS Coordinates *"}),(0,a.jsxs)("button",{type:"button",onClick:d,disabled:m,className:"inline-flex items-center px-3 py-1 text-xs font-medium text-blue-600 bg-blue-50 border border-blue-200 rounded-md hover:bg-blue-100 disabled:opacity-50",children:[m?(0,a.jsx)(v.A,{className:"w-3 h-3 mr-1 animate-spin"}):(0,a.jsx)(f.A,{className:"w-3 h-3 mr-1"}),"Use Current Location"]})]}),(0,a.jsxs)("div",{className:"mb-4 p-3 bg-blue-50 border border-blue-200 rounded-md",children:[(0,a.jsx)("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Paste GPS Coordinates (Any Format)"}),(0,a.jsxs)("div",{className:"flex gap-2",children:[(0,a.jsx)("input",{type:"text",value:p,onChange:e=>u(e.target.value),placeholder:"e.g., -34.031085, 18.463559 or 33.9221\xb0 S, 18.4231\xb0 E",className:"flex-1 px-3 py-2 text-sm border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500"}),(0,a.jsx)("button",{type:"button",onClick:c,disabled:!p.trim()||m,className:"px-4 py-2 text-sm font-medium text-white bg-blue-600 rounded-md hover:bg-blue-700 disabled:opacity-50 disabled:cursor-not-allowed",children:"Parse"})]}),(0,a.jsx)("p",{className:"mt-1 text-xs text-gray-600",children:"Supports: decimal (-34.031, 18.463), DMS (33\xb055'19\" S, 18\xb025'23\" E), and more"})]}),(0,a.jsxs)("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[(0,a.jsxs)("div",{children:[(0,a.jsx)("input",{...i("location.coordinates.latitude",{required:"Latitude is required",pattern:{value:/^-?([1-8]?[0-9]\.{1}\d{1,6}$|90\.{1}0{1,6}$)/,message:"Enter valid latitude (-35 to -22 for SA)"}}),type:"number",step:"any",className:"w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500",placeholder:"Latitude (e.g., -26.195246)"}),(null==(r=l.location)||null==(t=r.coordinates)?void 0:t.latitude)&&(0,a.jsx)("p",{className:"mt-1 text-sm text-red-600",children:l.location.coordinates.latitude.message})]}),(0,a.jsxs)("div",{children:[(0,a.jsx)("input",{...i("location.coordinates.longitude",{required:"Longitude is required",pattern:{value:/^-?(([-+]?)([\d]{1,3})((\.)(\d+))?)/,message:"Enter valid longitude (16 to 33 for SA)"}}),type:"number",step:"any",className:"w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500",placeholder:"Longitude (e.g., 28.034088)"}),(null==(n=l.location)||null==(s=n.coordinates)?void 0:s.longitude)&&(0,a.jsx)("p",{className:"mt-1 text-sm text-red-600",children:l.location.coordinates.longitude.message})]})]}),x&&(0,a.jsx)("p",{className:"mt-1 text-sm text-red-600",children:x}),m&&(0,a.jsxs)("div",{className:"mt-2 flex items-center text-sm text-blue-600",children:[(0,a.jsx)(v.A,{className:"w-4 h-4 mr-2 animate-spin"}),"Looking up location information..."]})]})}function L(e){var t,r,s;let{register:n,errors:i,isGeocoding:l}=e;return(0,a.jsxs)("div",{className:"pt-4 border-t border-gray-200",children:[(0,a.jsx)("p",{className:"text-sm text-gray-600 mb-3",children:"Location details (auto-populated from GPS coordinates):"}),(0,a.jsxs)("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[(0,a.jsxs)("div",{children:[(0,a.jsx)("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"City/Town"}),(0,a.jsx)("input",{...n("location.city",{required:"City/Town is required"}),type:"text",className:"w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500 bg-gray-50",placeholder:"Will be auto-populated",readOnly:l}),(null==(t=i.location)?void 0:t.city)&&(0,a.jsx)("p",{className:"mt-1 text-sm text-red-600",children:i.location.city.message})]}),(0,a.jsxs)("div",{children:[(0,a.jsx)("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Municipal District"}),(0,a.jsx)("input",{...n("location.region",{required:"Region is required"}),type:"text",className:"w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500 bg-gray-50",placeholder:"Will be auto-populated",readOnly:l}),(null==(r=i.location)?void 0:r.region)&&(0,a.jsx)("p",{className:"mt-1 text-sm text-red-600",children:i.location.region.message})]})]}),(0,a.jsxs)("div",{className:"mt-4",children:[(0,a.jsx)("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Province"}),(0,a.jsx)("input",{...n("location.province",{required:"Province is required"}),type:"text",className:"w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500 bg-gray-50",placeholder:"Will be auto-populated",readOnly:l}),(null==(s=i.location)?void 0:s.province)&&(0,a.jsx)("p",{className:"mt-1 text-sm text-red-600",children:i.location.province.message})]})]})}function D(e){let{register:t,errors:r}=e;return(0,a.jsxs)("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-4",children:[(0,a.jsxs)("div",{children:[(0,a.jsx)("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Start Date *"}),(0,a.jsx)("input",{...t("startDate",{required:"Start date is required"}),type:"date",className:"w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500"}),r.startDate&&(0,a.jsx)("p",{className:"mt-1 text-sm text-red-600",children:r.startDate.message})]}),(0,a.jsxs)("div",{children:[(0,a.jsx)("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Duration (Months) *"}),(0,a.jsx)("input",{...t("durationMonths",{required:"Duration is required",min:{value:1,message:"Duration must be at least 1 month"},max:{value:60,message:"Duration cannot exceed 60 months"},valueAsNumber:!0}),type:"number",min:"1",max:"60",step:"1",className:"w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500",placeholder:"e.g., 6"}),r.durationMonths&&(0,a.jsx)("p",{className:"mt-1 text-sm text-red-600",children:r.durationMonths.message})]}),(0,a.jsxs)("div",{children:[(0,a.jsx)("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Calculated End Date"}),(0,a.jsx)("input",{...t("endDate"),type:"date",className:"w-full px-3 py-2 border border-gray-200 rounded-md bg-gray-50 cursor-not-allowed",readOnly:!0,title:"This is automatically calculated based on start date and duration"}),(0,a.jsx)("p",{className:"mt-1 text-xs text-gray-500",children:"Calculated from start date + duration"})]})]})}function A(e){let{form:t,clients:r,isClientsLoading:n}=e,{register:i,formState:{errors:l}}=t,{gpsState:o,handleGetCurrentLocation:d,handleGpsInputParse:c,updateGpsInput:u}=function(e){let{watch:t,setValue:r}=e,[a,n]=(0,s.useState)({isGeocoding:!1,geocodingError:null,gpsInput:""}),i=t("startDate"),l=t("durationMonths"),o=t("location.coordinates.latitude"),d=t("location.coordinates.longitude");return(0,s.useEffect)(()=>{if(i&&l&&l>0){let e=new Date(i),t=new Date(e);t.setMonth(e.getMonth()+l),r("endDate",t.toISOString().split("T")[0])}},[i,l,r]),(0,s.useEffect)(()=>{!async function(){if(!o||!d)return;let e=parseFloat(o),t=parseFloat(d);if(!(isNaN(e)||isNaN(t))){var a,s;if(a=e,s=t,!(a>=-35)||!(a<=-22)||!(s>=16)||!(s<=33))return n(e=>({...e,geocodingError:"Coordinates must be within South Africa"}));n(e=>({...e,isGeocoding:!0,geocodingError:null}));try{let a=await C(e,t);a?(r("location.city",a.city),r("location.province",a.province)):n(e=>({...e,geocodingError:"Could not find location information"}))}catch(e){n(e=>({...e,geocodingError:"Failed to lookup location"})),P.Rm.error("Geocoding error:",{data:e},"useBasicInfoForm")}finally{n(e=>({...e,isGeocoding:!1}))}}}()},[o,d,r]),{gpsState:a,handleGetCurrentLocation:async()=>{n(e=>({...e,isGeocoding:!0,geocodingError:null}));try{let e=await new Promise((e,t)=>{if(!navigator.geolocation)return void t(Error("Geolocation is not supported by this browser"));navigator.geolocation.getCurrentPosition(t=>{e({lat:t.coords.latitude,lng:t.coords.longitude})},e=>{t(Error("Geolocation error: ".concat(e.message)))},{enableHighAccuracy:!0,timeout:1e4,maximumAge:3e5})});r("location.coordinates.latitude",e.lat),r("location.coordinates.longitude",e.lng)}catch(e){n(e=>({...e,geocodingError:"Could not get current location"})),P.Rm.error("Geolocation error:",{data:e},"useBasicInfoForm")}finally{n(e=>({...e,isGeocoding:!1}))}},handleGpsInputParse:()=>{if(!a.gpsInput.trim())return;let e=function(e){if(!e||"string"!=typeof e)return null;let t=e.trim(),r=t.match(/^(-?\d+\.?\d*)\s*,\s*(-?\d+\.?\d*)$/);if(r){let e=parseFloat(r[1]),t=parseFloat(r[2]);if(!isNaN(e)&&!isNaN(t))return{lat:e,lng:t}}let a=t.match(/(\d+(?:\.\d+)?(?:°\d+(?:\.\d+)?['′]\d+(?:\.\d+)?["″]?|°)?)\s*([NSEW])\s*,?\s*(\d+(?:\.\d+)?(?:°\d+(?:\.\d+)?['′]\d+(?:\.\d+)?["″]?|°)?)\s*([NSEW])/i);if(a){let[,e,t,r,s]=a,n=E(e,t),i=E(r,s);if(null!==n&&null!==i)return{lat:n,lng:i}}let s=t.match(/^(-?\d+\.?\d*)\s+(-?\d+\.?\d*)$/);if(s){let e=parseFloat(s[1]),t=parseFloat(s[2]);if(!isNaN(e)&&!isNaN(t))return{lat:-1*Math.abs(e),lng:t}}let n=t.match(/-?\d+\.?\d*/g);if(n&&n.length>=2){let e=parseFloat(n[0]),t=parseFloat(n[1]);if(!isNaN(e)&&!isNaN(t))return{lat:e,lng:t}}return null}(a.gpsInput.trim());e?(r("location.coordinates.latitude",e.lat),r("location.coordinates.longitude",e.lng),n(e=>({...e,gpsInput:"",geocodingError:null}))):n(e=>({...e,geocodingError:'Could not parse GPS coordinates. Try formats like: "-34.031085, 18.463559" or "33.9221\xb0 S, 18.4231\xb0 E"'}))},updateGpsInput:e=>{n(t=>({...t,gpsInput:e}))}}}(t);return(0,a.jsxs)("div",{className:"space-y-6",children:[(0,a.jsx)(S,{register:i,errors:l,clients:r,isClientsLoading:n}),(0,a.jsxs)("div",{children:[(0,a.jsx)("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Project Location *"}),(0,a.jsxs)("div",{className:"space-y-4",children:[(0,a.jsx)(I,{register:i,errors:l,gpsState:o,onGetCurrentLocation:d,onGpsInputParse:c,onGpsInputChange:u}),(0,a.jsx)(L,{register:i,errors:l,isGeocoding:o.isGeocoding})]})]}),(0,a.jsx)(D,{register:i,errors:l})]})}var M=r(35537);function k(e){var t;let{form:r,projectManagers:s,isProjectManagersLoading:n}=e,{register:i,formState:{errors:o}}=r;return(0,a.jsxs)("div",{className:"space-y-6",children:[(0,a.jsxs)("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[(0,a.jsxs)("div",{children:[(0,a.jsx)("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Budget (R)"}),(0,a.jsx)("input",{...i("budget.totalBudget",{min:{value:0,message:"Budget must be positive"},valueAsNumber:!0}),type:"number",step:"0.01",className:"w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500",placeholder:"0.00"}),(null==(t=o.budget)?void 0:t.totalBudget)&&(0,a.jsx)("p",{className:"mt-1 text-sm text-red-600",children:o.budget.totalBudget.message})]}),(0,a.jsxs)("div",{children:[(0,a.jsx)("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Priority *"}),(0,a.jsxs)("select",{...i("priority",{required:"Priority is required"}),className:"w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500",children:[(0,a.jsx)("option",{value:M.KB.LOW,children:"Low"}),(0,a.jsx)("option",{value:M.KB.MEDIUM,children:"Medium"}),(0,a.jsx)("option",{value:M.KB.HIGH,children:"High"}),(0,a.jsx)("option",{value:M.KB.CRITICAL,children:"Critical"})]}),o.priority&&(0,a.jsx)("p",{className:"mt-1 text-sm text-red-600",children:o.priority.message})]}),(0,a.jsxs)("div",{children:[(0,a.jsx)("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Status"}),(0,a.jsxs)("select",{...i("status"),className:"w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500",children:[(0,a.jsx)("option",{value:M.Ks.PLANNING,children:"Planning"}),(0,a.jsx)("option",{value:M.Ks.ACTIVE,children:"Active"}),(0,a.jsx)("option",{value:M.Ks.ON_HOLD,children:"On Hold"}),(0,a.jsx)("option",{value:M.Ks.COMPLETED,children:"Completed"}),(0,a.jsx)("option",{value:M.Ks.CANCELLED,children:"Cancelled"})]})]})]}),(0,a.jsxs)("div",{children:[(0,a.jsxs)("div",{className:"flex items-center justify-between mb-2",children:[(0,a.jsx)("label",{className:"block text-sm font-medium text-gray-700",children:"Project Manager *"}),(0,a.jsx)(l(),{href:"/staff",target:"_blank",className:"text-sm text-blue-600 hover:text-blue-800 hover:underline",children:"Manage Staff →"})]}),n?(0,a.jsx)("div",{className:"w-full px-3 py-2 border border-gray-300 rounded-md bg-gray-50",children:"Loading project managers..."}):(0,a.jsxs)(a.Fragment,{children:[(0,a.jsxs)("select",{...i("projectManagerId",{required:"Project Manager is required"}),className:"w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500",children:[(0,a.jsx)("option",{value:"",children:"Select project manager"}),null==s?void 0:s.map(e=>(0,a.jsx)("option",{value:e.id,children:e.name},e.id))]}),0===s.length&&(0,a.jsxs)("p",{className:"mt-2 text-sm text-gray-500",children:["No project managers available.",(0,a.jsx)(l(),{href:"/staff/new",target:"_blank",className:"ml-1 text-blue-600 hover:text-blue-800 hover:underline",children:"Add a staff member"})]})]}),o.projectManagerId&&(0,a.jsx)("p",{className:"mt-1 text-sm text-red-600",children:o.projectManagerId.message})]}),(0,a.jsxs)("div",{children:[(0,a.jsx)("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Team Members"}),(0,a.jsx)("div",{className:"text-sm text-gray-500",children:"Team members can be assigned after project creation"})]}),(0,a.jsxs)("div",{children:[(0,a.jsx)("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Notes"}),(0,a.jsx)("textarea",{...i("description"),rows:4,className:"w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500",placeholder:"Additional notes or requirements"})]})]})}function q(e){var t,r;let{form:s,clientName:n="Unknown",projectManagerName:i="Unassigned"}=e,l=s.getValues(),o=[{title:"Basic Information",items:[{label:"Project Name",value:l.name||"Not specified"},{label:"Description",value:l.description||"No description"},{label:"Client",value:n},{label:"Start Date",value:l.startDate||"Not set"},{label:"End Date",value:l.endDate||"Not set"}]},{title:"Project Details",items:[{label:"Location",value:(null==(t=l.location)?void 0:t.city)?"".concat(l.location.city,", ").concat(l.location.province):"Not specified"},{label:"Budget",value:(null==(r=l.budget)?void 0:r.totalBudget)?"R ".concat(Number(l.budget.totalBudget).toLocaleString()):"Not set"},{label:"Priority",value:l.priority||"Medium"},{label:"Project Manager",value:i},{label:"Notes",value:l.description||"No additional notes"}]}];return(0,a.jsxs)("div",{className:"space-y-6",children:[(0,a.jsxs)("div",{className:"text-center",children:[(0,a.jsx)(d.A,{className:"mx-auto h-12 w-12 text-green-500 mb-4"}),(0,a.jsx)("h3",{className:"text-lg font-medium text-gray-900 mb-2",children:"Review Project Information"}),(0,a.jsx)("p",{className:"text-sm text-gray-600",children:"Please review all information before creating the project"})]}),(0,a.jsx)("div",{className:"bg-gray-50 rounded-lg p-6 space-y-6",children:o.map(e=>(0,a.jsxs)("div",{children:[(0,a.jsx)("h4",{className:"font-medium text-gray-900 mb-3 border-b border-gray-200 pb-2",children:e.title}),(0,a.jsx)("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-3",children:e.items.map(e=>(0,a.jsxs)("div",{className:"flex flex-col",children:[(0,a.jsx)("dt",{className:"text-sm font-medium text-gray-500",children:e.label}),(0,a.jsx)("dd",{className:"mt-1 text-sm text-gray-900",children:e.value})]},e.label))})]},e.title))}),(0,a.jsx)("div",{className:"bg-blue-50 border border-blue-200 rounded-lg p-4",children:(0,a.jsxs)("div",{className:"flex",children:[(0,a.jsx)("div",{className:"flex-shrink-0",children:(0,a.jsx)(d.A,{className:"h-5 w-5 text-blue-400"})}),(0,a.jsxs)("div",{className:"ml-3",children:[(0,a.jsx)("h3",{className:"text-sm font-medium text-blue-800",children:"Ready to create project"}),(0,a.jsx)("div",{className:"mt-2 text-sm text-blue-700",children:(0,a.jsx)("p",{children:'Click "Create Project" to proceed. You can upload SOW documents and make additional changes after the project is created.'})})]})]})})]})}function F(){let e=(0,n.useRouter)(),[t,r]=(0,s.useState)(0),[i,b]=(0,s.useState)(!1),[f,h]=(0,s.useState)(),j=(0,o.mN)({defaultValues:{priority:M.KB.MEDIUM}}),{data:N=[],isLoading:v}=(0,x.Ak)(),{data:C=[],isLoading:E}=(0,p.j$)(),S=(0,g.bL)(),I=async()=>{try{var e;let t=j.getValues();if(!t.clientId)return void alert("Please select a client");if(!t.name)return void alert("Please enter a project name");let r=t.startDate,a=t.endDate;if(!a&&r&&t.durationMonths){let e=new Date(r);e.setMonth(e.getMonth()+t.durationMonths),a=e.toISOString().split("T")[0]}let s={name:t.name,projectName:t.name,projectCode:"PRJ-".concat(Date.now()),clientId:t.clientId,description:t.description||t.notes||"",projectType:"installation",status:t.status||"planning",priority:t.priority,startDate:r,endDate:a||r,budget:(null==(e=t.budget)?void 0:e.totalBudget)||0,projectManager:t.projectManagerId,location:t.location||null};console.log("Submitting project data:",s),console.log("Form data details:",{name:t.name,clientId:t.clientId,projectManagerId:t.projectManagerId,startDate:t.startDate,endDate:t.endDate,location:t.location,budget:t.budget});let n=await S.mutateAsync(s);P.Rm.info("Project created successfully:",{data:n},"ProjectCreationWizard"),h(n.id||n),b(!0)}catch(e){console.error("Project creation error:",e),P.Rm.error("Failed to create project:",{data:e},"ProjectCreationWizard"),alert("Failed to create project: ".concat(e instanceof Error?e.message:"Unknown error"))}},L=null==N?void 0:N.find(e=>e.id===j.watch("clientId")),D=null==C?void 0:C.find(e=>e.id===j.watch("projectManagerId"));return i?(0,a.jsx)("div",{className:"max-w-2xl mx-auto p-6",children:(0,a.jsxs)("div",{className:"bg-white shadow-lg rounded-lg p-8 text-center",children:[(0,a.jsx)("div",{className:"flex justify-center mb-4",children:(0,a.jsx)(d.A,{className:"h-16 w-16 text-green-500"})}),(0,a.jsx)("h2",{className:"text-2xl font-bold text-gray-900 mb-2",children:"Project Created Successfully!"}),(0,a.jsx)("p",{className:"text-gray-600 mb-8",children:"Your project has been created. You can now import the Statement of Work (SOW) to populate project specifications."}),(0,a.jsxs)("div",{className:"space-y-4",children:[(0,a.jsxs)(l(),{href:"/sow-management?projectId=".concat(f),className:"inline-flex items-center justify-center w-full px-6 py-3 text-base font-medium text-white bg-blue-600 border border-transparent rounded-md hover:bg-blue-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-blue-500",children:[(0,a.jsx)(c.A,{className:"h-5 w-5 mr-2"}),"Import SOW from Excel"]}),(0,a.jsxs)(l(),{href:"/projects/".concat(f),className:"inline-flex items-center justify-center w-full px-6 py-3 text-base font-medium text-blue-600 bg-white border border-blue-600 rounded-md hover:bg-blue-50 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-blue-500",children:[(0,a.jsx)(u.A,{className:"h-5 w-5 mr-2"}),"View Project Details"]}),(0,a.jsxs)("button",{onClick:()=>e.push("/projects"),className:"inline-flex items-center justify-center w-full px-6 py-3 text-base font-medium text-gray-700 bg-white border border-gray-300 rounded-md hover:bg-gray-50 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-gray-500",children:["Go to Projects List",(0,a.jsx)(m.A,{className:"h-5 w-5 ml-2"})]})]}),(0,a.jsx)("div",{className:"mt-8 p-4 bg-blue-50 rounded-lg",children:(0,a.jsxs)("p",{className:"text-sm text-blue-800",children:[(0,a.jsx)("strong",{children:"Tip:"})," Importing SOW data will automatically create poles, drops, and fiber specifications for your project, saving you time on manual data entry."]})})]})}):(0,a.jsxs)("div",{className:"max-w-4xl mx-auto p-6",children:[(0,a.jsx)(y,{currentStep:t}),(0,a.jsxs)("form",{className:"bg-white shadow-lg rounded-lg p-6",children:[(()=>{switch(t){case 0:return(0,a.jsx)(A,{form:j,clients:(null==N?void 0:N.map(e=>({id:e.id,name:e.companyName})))||[],isClientsLoading:v});case 1:return(0,a.jsx)(k,{form:j,projectManagers:C,isProjectManagersLoading:E});case 2:return(0,a.jsx)(q,{form:j,clientName:(null==L?void 0:L.companyName)||"Unknown",projectManagerName:(null==D?void 0:D.name)||"Unassigned"});default:return null}})(),(0,a.jsx)(w,{currentStep:t,onPrevious:()=>{t>0&&r(t-1)},onNext:()=>{let e=j.getValues();if(0===t){if(!e.name)return void alert("Please enter a project name");if(!e.clientId)return void alert("Please select a client")}if(1===t&&!e.projectManagerId)return void alert("Please select a project manager");t<2&&r(t+1)},onSubmit:2===t?I:()=>{e.push("/projects")},isSubmitting:S.isPending,isLastStep:2===t})]})]})}},35537:(e,t,r)=>{r.d(t,{Ai:()=>s,KB:()=>i,Ks:()=>n,bd:()=>a});var a=function(e){return e.POLES="poles",e.DROPS="drops",e.CABLE="cable",e.TRENCH="trench",e.OTHER="other",e.PROPOSAL="proposal",e.CONTRACT="contract",e.SOW="sow",e.TECHNICAL_SPEC="technical_spec",e.BUDGET="budget",e.SCHEDULE="schedule",e.REPORT="report",e.FIBRE="fibre",e.GENERAL="general",e.SITE_SURVEY="site_survey",e.TECHNICAL_SPECS="technical_specs",e.EQUIPMENT="equipment",e}({}),s=function(e){return e.PENDING="pending",e.APPROVED="approved",e.REJECTED="rejected",e.NEEDS_REVIEW="needs_review",e}({}),n=function(e){return e.PLANNING="planning",e.ACTIVE="active",e.ON_HOLD="on_hold",e.COMPLETED="completed",e.CANCELLED="cancelled",e}({}),i=function(e){return e.LOW="low",e.MEDIUM="medium",e.HIGH="high",e.CRITICAL="critical",e}({})},59516:(e,t,r)=>{r.d(t,{Ak:()=>d,LC:()=>u,_P:()=>m,_c:()=>x,tH:()=>c}),r(14232);var a=r(67914),s=r(67768),n=r(40097),i=r(49711),l=r(16932);let o={all:["clients"],lists:()=>[...o.all,"list"],list:e=>[...o.lists(),{filter:e}],details:()=>[...o.all,"detail"],detail:e=>[...o.details(),e],active:()=>[...o.all,"active"],summary:()=>[...o.all,"summary"],contactHistory:e=>[...o.all,"contactHistory",e]};function d(){return(0,a.I)({queryKey:o.active(),queryFn:()=>i.L.getActiveClients(),staleTime:6e5})}function c(e){return(0,a.I)({queryKey:o.detail(e),queryFn:()=>i.L.getById(e),enabled:!!e})}function u(){let e=(0,s.jE)();return(0,n.n)({mutationFn:e=>i.L.create(e),onSuccess:()=>{e.invalidateQueries({queryKey:o.all})},onError:e=>{throw l.Rm.error("Failed to create client:",{data:e},"useClients"),e}})}function m(){let e=(0,s.jE)();return(0,n.n)({mutationFn:e=>{let{id:t,data:r}=e;return i.L.update(t,r)},onSuccess:(t,r)=>{let{id:a}=r;e.invalidateQueries({queryKey:o.detail(a)}),e.invalidateQueries({queryKey:o.lists()}),e.invalidateQueries({queryKey:o.active()}),e.invalidateQueries({queryKey:o.summary()})},onError:e=>{throw l.Rm.error("Failed to update client:",{data:e},"useClients"),e}})}function x(){let e=(0,s.jE)();return(0,n.n)({mutationFn:e=>i.L.delete(e),onSuccess:(t,r)=>{e.removeQueries({queryKey:o.detail(r)}),e.invalidateQueries({queryKey:o.lists()}),e.invalidateQueries({queryKey:o.active()}),e.invalidateQueries({queryKey:o.summary()})},onError:e=>{throw l.Rm.error("Failed to delete client:",{data:e},"useClients"),e}})}}}]);