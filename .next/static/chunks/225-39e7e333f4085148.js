"use strict";(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[225],{60225:(t,e,n)=>{n.d(e,{staffNeonService:()=>j});var a=n(28888),r=n(15354),o=n(65364);let i=Number(o.env.NEON_POOL_QUERY_LIMIT||10);!Number.isNaN(i)&&i>0&&(r.Vz.poolQueryLimit=i);let s="__FF_NEON_SQL__",m=function(){let t=globalThis;return t[s]||(t[s]=function(){let t=o.env.DATABASE_URL;if(!t)throw Error("DATABASE_URL is not set. Please configure it in your environment.");return(0,r.lw)(t)}()),t[s]}();function u(){let t=(0,a._)(["\n      SELECT \n        s.*,\n        m.name as manager_name,\n        m.position as manager_position\n      FROM staff s\n      LEFT JOIN staff m ON s.reports_to = m.id\n      ORDER BY s.name ASC\n    "]);return u=function(){return t},t}function c(){let t=(0,a._)(["\n      SELECT \n        s.*,\n        m.name as manager_name,\n        m.position as manager_position\n      FROM staff s\n      LEFT JOIN staff m ON s.reports_to = m.id\n      WHERE s.status = "," AND s.department = ","\n      ORDER BY s.name ASC\n    "]);return c=function(){return t},t}function l(){let t=(0,a._)(["\n      SELECT \n        s.*,\n        m.name as manager_name,\n        m.position as manager_position\n      FROM staff s\n      LEFT JOIN staff m ON s.reports_to = m.id\n      WHERE s.status = ","\n      ORDER BY s.name ASC\n    "]);return l=function(){return t},t}function f(){let t=(0,a._)(["\n      SELECT \n        s.*,\n        m.name as manager_name,\n        m.position as manager_position\n      FROM staff s\n      LEFT JOIN staff m ON s.reports_to = m.id\n      WHERE s.department = ","\n      ORDER BY s.name ASC\n    "]);return f=function(){return t},t}function d(){let t=(0,a._)(["\n    SELECT \n      s.*,\n      m.name as manager_name,\n      m.position as manager_position\n    FROM staff s\n    LEFT JOIN staff m ON s.reports_to = m.id\n    ORDER BY s.name ASC\n  "]);return d=function(){return t},t}function p(){let t=(0,a._)(["\n    SELECT \n      s.*,\n      m.name as manager_name,\n      m.position as manager_position\n    FROM staff s\n    LEFT JOIN staff m ON s.reports_to = m.id\n    WHERE s.id = "," \n    LIMIT 1\n  "]);return p=function(){return t},t}function _(){let t=(0,a._)(["\n    SELECT id, name, position, department, email \n    FROM staff \n    WHERE status = 'ACTIVE'\n    ORDER BY name ASC\n  "]);return _=function(){return t},t}function E(){let t=(0,a._)(["\n    SELECT id, name, position, department, email \n    FROM staff \n    WHERE status = 'ACTIVE' \n      AND (position LIKE '%Manager%' OR position LIKE '%Lead%' OR position = 'MD')\n    ORDER BY name ASC\n  "]);return E=function(){return t},t}async function g(t){var e,n,a,r,o,i;if(!t||!(null==(e=t.status)?void 0:e.length)&&!(null==(n=t.department)?void 0:n.length))return m(u());if((null==(a=t.status)?void 0:a.length)&&(null==(r=t.department)?void 0:r.length)){let e=t.status[0],n=t.department[0];return m(c(),e,n)}if(null==(o=t.status)?void 0:o.length){let e=t.status[0];return m(l(),e)}if(null==(i=t.department)?void 0:i.length){let e=t.department[0];return m(f(),e)}return m(d())}async function R(t){return m(p(),t)}async function y(){return m(_())}async function T(){return m(E())}var h=n(6318);function N(t){return{seconds:Math.floor(t.getTime()/1e3),nanoseconds:t.getTime()%1e3*1e6,toDate:()=>t,toMillis:()=>t.getTime(),isEqual:e=>t.getTime()===e.toMillis()}}function O(t){let e=arguments.length>1&&void 0!==arguments[1]&&arguments[1];return{id:t.id,name:t.name,position:t.position,department:t.department||(e?"Management":void 0),email:t.email,status:"ACTIVE",currentProjectCount:0,maxProjectCount:e?10:5}}var v=n(16932);function C(t){if(!t.employeeId||""===t.employeeId.trim())throw Error("Employee ID is required and cannot be empty");if(!t.name||""===t.name.trim())throw Error("Name is required and cannot be empty");if(!t.email||""===t.email.trim())throw Error("Email is required and cannot be empty")}function I(t){let e=null;if(null!=t){let n=String(t).trim();e=""!==n&&"undefined"!==n&&"null"!==n?n:null}else e=null;return""===e&&(e=null),e}function A(t,e,n){v.Rm.info("1. Raw input data:",{data:JSON.stringify(e,null,2)},"validators"),void 0!==n&&(v.Rm.info("   - String representation:",{data:String(n)},"validators"),v.Rm.info("   - JSON stringify:",{data:JSON.stringify(n)},"validators"),v.Rm.info("   - Trimmed length:",{data:n?String(n).length:"N/A"},"validators"))}function S(t,e,n){v.Rm.error("❌ ".concat(t," ERROR - Detailed error info:"),{data:{message:e instanceof Error?e.message:"Unknown error",stack:e instanceof Error?e.stack:"No stack trace",inputData:n,processedData:{employeeId:n.employeeId,reportsTo:n.reportsTo}}},"validators")}function w(){let t=(0,a._)(["\n      INSERT INTO staff (\n        employee_id, name, email, phone, department, position, \n        status, join_date, reports_to, created_at, updated_at\n      ) VALUES (\n        ",", ",", ",", ",",\n        ",", ",", ",",\n        ",", ",", \n        NOW(), NOW()\n      ) RETURNING *\n    "]);return w=function(){return t},t}function L(){let t=(0,a._)(["\n      SELECT id FROM staff WHERE employee_id = ","\n    "]);return L=function(){return t},t}function D(){let t=(0,a._)(["\n        UPDATE staff SET\n          name = ",",\n          email = ",",\n          phone = ",",\n          department = ",",\n          position = ",",\n          status = ",",\n          reports_to = ",",\n          updated_at = NOW()\n        WHERE employee_id = ","\n        RETURNING *\n      "]);return D=function(){return t},t}function b(){let t=(0,a._)(["\n        INSERT INTO staff (\n          employee_id, name, email, phone, department, position, \n          status, join_date, reports_to, created_at, updated_at\n        ) VALUES (\n          ",", ",", ",", ",",\n          ",", ",", ",",\n          ",", ",", \n          NOW(), NOW()\n        ) RETURNING *\n      "]);return b=function(){return t},t}function k(){let t=(0,a._)(["\n      UPDATE staff SET\n        name = ",",\n        email = ",",\n        phone = ",",\n        department = ",",\n        position = ",",\n        status = ",",\n        reports_to = ",",\n        updated_at = NOW()\n      WHERE id = ","\n      RETURNING *\n    "]);return k=function(){return t},t}function M(){let t=(0,a._)(["DELETE FROM staff WHERE id = ",""]);return M=function(){return t},t}function x(){let t=(0,a._)(["SELECT COUNT(*) as count FROM staff"]);return x=function(){return t},t}function P(){let t=(0,a._)(["SELECT COUNT(*) as count FROM staff WHERE status = 'ACTIVE'"]);return P=function(){return t},t}function F(){let t=(0,a._)(["SELECT COUNT(*) as count FROM staff WHERE status = 'INACTIVE'"]);return F=function(){return t},t}function U(){let t=(0,a._)(["SELECT COUNT(*) as count FROM staff WHERE status = 'ON_LEAVE'"]);return U=function(){return t},t}function W(){let t=(0,a._)(["\n      SELECT department, COUNT(*) as count \n      FROM staff \n      GROUP BY department\n    "]);return W=function(){return t},t}let j={async getAll(t){try{return(await g(t)).map(t=>({...t,managerName:t.manager_name,managerPosition:t.manager_position}))}catch(t){throw v.Rm.error("Error fetching staff:",{data:t},"index"),t}},async getById(t){try{var e,n,a,r;let o=await R(t);if(0===o.length)return null;return{id:(e=o[0]).id,name:e.name||"",email:e.email||"",phone:e.phone||"",position:e.position||"",department:e.department||"",status:e.status||"ACTIVE",employeeId:e.employee_id||"",managerName:e.manager_name||"",managerPosition:e.manager_position||"",startDate:e.join_date?N((0,h.xi)(e.join_date)):N(new Date),alternativePhone:e.alternate_phone||"",contractType:e.type||"PERMANENT",createdAt:e.created_at?N((0,h.xi)(e.created_at)):N(new Date),updatedAt:e.updated_at?N((0,h.xi)(e.updated_at)):N(new Date),createdBy:e.created_by||"",lastModifiedBy:e.last_modified_by||"",experienceYears:e.experience_years||0,specializations:e.specializations||[],workingHours:e.working_hours||"",availableWeekends:null!=(n=e.available_weekends)&&n,availableNights:null!=(a=e.available_nights)&&a,timeZone:e.time_zone||"UTC",activeProjectIds:e.active_project_ids||[],currentProjectCount:e.current_project_count||0,maxProjectCount:e.max_project_count||5,totalProjectsCompleted:e.total_projects_completed||0,averageProjectRating:e.average_project_rating||0,onTimeCompletionRate:e.on_time_completion_rate||0,managerId:e.manager_id,reportsTo:e.reports_to,level:e.level,assignedEquipment:e.assigned_equipment||[],vehicleAssigned:e.vehicle_assigned,toolsAssigned:e.tools_assigned||[],trainingRecords:e.training_records||[],nextTrainingDue:e.next_training_due?N((0,h.xi)(e.next_training_due)):void 0,safetyTrainingExpiry:e.safety_training_expiry?N((0,h.xi)(e.safety_training_expiry)):void 0,endDate:e.end_date?N((0,h.xi)(e.end_date)):void 0,salaryGrade:e.salary_grade,hourlyRate:e.hourly_rate,managerEmployeeId:e.manager_employee_id||"",isActive:null==(r=e.is_active)||r,...e.last_active_date&&{lastActiveDate:N((0,h.xi)(e.last_active_date))},profilePhotoUrl:e.profile_image_url,emergencyContactName:e.emergency_contact_name||"",emergencyContactPhone:e.emergency_contact_phone||"",address:e.address||"",city:e.city||"",province:e.province||"",postalCode:e.postal_code||"",taxNumber:e.tax_number||"",bankAccountNumber:e.bank_account_number||"",bankName:e.bank_name||"",salaryAmount:e.salary_amount||0,benefitsPackage:e.benefits_package||"",workLocation:e.work_location||"",workSchedule:e.work_schedule||"",skills:e.skills||[],certifications:e.certifications||[],performanceRating:e.performance_rating||0,performanceNotes:e.performance_notes||"",bio:e.bio,notes:e.notes||""}}catch(t){throw v.Rm.error("Error fetching staff member:",{data:t},"index"),t}},create:async function(t){try{A("CREATE",t,t.reportsTo),C(t);let e=I(t.reportsTo);return(await m(w(),t.employeeId.trim(),t.name.trim(),t.email.trim(),t.phone.trim(),t.department,t.position,t.status||"ACTIVE",t.startDate||new Date,e))[0]}catch(e){throw S("CREATE",e,t),e}},createOrUpdate:async function(t){try{A("CREATE_OR_UPDATE",t,t.reportsTo),C(t);let e=I(t.reportsTo);if((await m(L(),t.employeeId)).length>0)return(await m(D(),t.name,t.email,t.phone,t.department,t.position,t.status||"ACTIVE",e,t.employeeId))[0];return(await m(b(),t.employeeId,t.name,t.email,t.phone,t.department,t.position,t.status||"ACTIVE",t.startDate||new Date,e))[0]}catch(e){throw S("CREATE_OR_UPDATE",e,t),e}},update:async function(t,e){try{let n=e.reportsTo&&""!==e.reportsTo.trim()?e.reportsTo:null;return(await m(k(),e.name,e.email,e.phone,e.department,e.position,e.status,n,t))[0]}catch(t){throw v.Rm.error("Error updating staff member:",{data:t},"crudOperations"),t}},delete:async function(t){try{await m(M(),t)}catch(t){throw v.Rm.error("Error deleting staff member:",{data:t},"crudOperations"),t}},async getActiveStaff(){try{return(await y()).map(t=>O(t))}catch(t){throw v.Rm.error("Error fetching active staff:",{data:t},"index"),t}},async getProjectManagers(){try{return(await T()).map(t=>O(t,!0))}catch(t){throw v.Rm.error("Error fetching project managers:",{data:t},"index"),t}},getStaffSummary:async function(){try{let t=await m(x()),e=await m(P()),n=await m(F()),a=await m(U()),r=await m(W()),o=parseInt(t[0].count),i=parseInt(e[0].count),s=parseInt(n[0].count),u=parseInt(a[0].count),c={};return r.forEach(t=>{c[t.department]=parseInt(t.count)}),{totalStaff:o,activeStaff:i,inactiveStaff:s,onLeaveStaff:u,availableStaff:i,monthlyGrowth:0,averageProjectLoad:0,staffByDepartment:c,staffByLevel:{},staffBySkill:{},staffByContractType:{},averageExperience:0,utilizationRate:o>0?i/o*100:0,overallocatedStaff:0,underutilizedStaff:0,topPerformers:[],topSkills:[]}}catch(t){throw v.Rm.error("Error fetching staff summary:",{data:t},"statistics"),t}}}}}]);