"use strict";(()=>{var a={};a.id=9271,a.ids=[9271],a.modules={10762:a=>{a.exports=import("@neondatabase/serverless")},22623:(a,b,c)=>{c.a(a,async(a,d)=>{try{c.r(b),c.d(b,{default:()=>h});var e=c(10762),f=c(33462),g=a([e]);e=(g.then?(await g)():g)[0];let i=(0,e.neon)(process.env.DATABASE_URL);async function h(a,b){let{projectId:c}=a.query;if("GET"===a.method)try{let d,e;if(c&&"all"!==c)if((d=await i`
          SELECT * FROM rfqs 
          WHERE project_id = ${c}
          ORDER BY created_at DESC
        `).length>0){let a=d.map(a=>a.id);e=await i`
            SELECT * FROM rfq_items
            WHERE rfq_id = ANY(${a})
            ORDER BY line_number
          `}else e=[];else if((d=await i`
          SELECT 
            r.*,
            (SELECT COUNT(*) FROM quotes WHERE quotes.rfq_id = r.id)::int as quotes_received
          FROM rfqs r
          ORDER BY r.created_at DESC
          LIMIT 100
        `).length>0){let a=d.slice(0,20).map(a=>a.id);e=await i`
            SELECT * FROM rfq_items
            WHERE rfq_id = ANY(${a})
            ORDER BY line_number
            LIMIT 200
          `}else e=[];let g=e.reduce((a,b)=>(a[b.rfq_id]||(a[b.rfq_id]=[]),a[b.rfq_id].push(b),a),{}),h=d.map(a=>({id:a.id,rfqNumber:a.rfq_number,projectId:a.project_id,title:a.title,description:a.description||"",status:a.status,createdDate:a.created_at||new Date().toISOString(),dueDate:a.response_deadline||new Date().toISOString(),items:(g[a.id]||[]).map(a=>({id:a.id,description:a.description,quantity:Number(a.quantity),unit:a.uom,specifications:"string"==typeof a.specifications?a.specifications:JSON.stringify(a.specifications||"")})),suppliers:Array.isArray(a.invited_suppliers)?a.invited_suppliers:a.invited_suppliers?[a.invited_suppliers]:[],quotesReceived:a.quotes_received||0,totalValue:a.total_budget_estimate?Number(a.total_budget_estimate):0,createdBy:a.created_by||"System",updatedAt:a.updated_at||new Date().toISOString()})),j={totalRFQs:h.length,openRFQs:h.filter(a=>"open"===a.status).length,totalValue:h.reduce((a,b)=>a+b.totalValue,0),avgQuotesPerRFQ:h.length>0?h.reduce((a,b)=>a+b.quotesReceived,0)/h.length:0},k=Number(a.query.page)||1,l=Number(a.query.limit)||100;if(a.query.page||a.query.limit)return f.aI.paginated(b,h,{page:k,pageSize:l,total:h.length},void 0,{stats:j});return f.aI.success(b,{rfqs:h,total:h.length},void 0,200,{stats:j})}catch(a){return f.aI.databaseError(b,a,"Failed to fetch RFQs")}if("POST"!==a.method)return f.aI.methodNotAllowed(b,a.method,["GET","POST"]);try{let d=a.body,e={};if(d.title||(e.title="RFQ title is required"),d.projectId||c||(e.projectId="Project ID is required"),d.items&&!Array.isArray(d.items)&&(e.items="Items must be an array"),d.status&&!["draft","open","evaluating","awarded","cancelled"].includes(d.status)&&(e.status="Invalid RFQ status"),Object.keys(e).length>0)return f.aI.validationError(b,e);let g=d.rfqNumber||`RFQ-${new Date().getFullYear()}-${Date.now().toString().slice(-6)}`,h=d.responseDeadline||new Date(Date.now()+2592e6).toISOString(),j=await i`
        INSERT INTO rfqs (
          rfq_number, project_id, title, description, status, 
          response_deadline, invited_suppliers, total_budget_estimate, created_by
        )
        VALUES (
          ${g},
          ${d.projectId||c},
          ${d.title},
          ${d.description||""},
          ${d.status||"draft"},
          ${h},
          ${JSON.stringify(d.suppliers||[])},
          ${d.totalValue||0},
          ${d.createdBy||"System"}
        )
        RETURNING *
      `,k={id:j[0].id,rfqNumber:j[0].rfq_number,projectId:j[0].project_id,title:j[0].title,description:j[0].description||"",status:j[0].status,createdDate:j[0].created_at||new Date().toISOString(),dueDate:j[0].response_deadline||new Date().toISOString(),items:[],suppliers:JSON.parse(j[0].invited_suppliers||"[]"),quotesReceived:0,totalValue:Number(j[0].total_budget_estimate||0),createdBy:j[0].created_by||"System",updatedAt:j[0].updated_at||new Date().toISOString()};return f.aI.created(b,k,"RFQ created successfully")}catch(a){if("23505"===a.code)return f.aI.error(b,f.O4.CONFLICT,"An RFQ with this number already exists");if("23503"===a.code)return f.aI.error(b,f.O4.VALIDATION_ERROR,"Invalid project ID or related reference");return f.aI.databaseError(b,a,"Failed to create RFQ")}}d()}catch(a){d(a)}})},33462:(a,b,c)=>{c.d(b,{O4:()=>d,aI:()=>g});var d=function(a){return a.BAD_REQUEST="BAD_REQUEST",a.UNAUTHORIZED="UNAUTHORIZED",a.FORBIDDEN="FORBIDDEN",a.NOT_FOUND="NOT_FOUND",a.METHOD_NOT_ALLOWED="METHOD_NOT_ALLOWED",a.CONFLICT="CONFLICT",a.VALIDATION_ERROR="VALIDATION_ERROR",a.RATE_LIMIT="RATE_LIMIT",a.PAYLOAD_TOO_LARGE="PAYLOAD_TOO_LARGE",a.INTERNAL_ERROR="INTERNAL_ERROR",a.DATABASE_ERROR="DATABASE_ERROR",a.SERVICE_UNAVAILABLE="SERVICE_UNAVAILABLE",a.GATEWAY_TIMEOUT="GATEWAY_TIMEOUT",a.BUSINESS_RULE_VIOLATION="BUSINESS_RULE_VIOLATION",a.INSUFFICIENT_PERMISSIONS="INSUFFICIENT_PERMISSIONS",a.RESOURCE_LOCKED="RESOURCE_LOCKED",a.DEPENDENCY_ERROR="DEPENDENCY_ERROR",a}({});let e={BAD_REQUEST:400,UNAUTHORIZED:401,FORBIDDEN:403,NOT_FOUND:404,METHOD_NOT_ALLOWED:405,CONFLICT:409,VALIDATION_ERROR:422,RATE_LIMIT:429,PAYLOAD_TOO_LARGE:413,INTERNAL_ERROR:500,DATABASE_ERROR:500,SERVICE_UNAVAILABLE:503,GATEWAY_TIMEOUT:504,BUSINESS_RULE_VIOLATION:422,INSUFFICIENT_PERMISSIONS:403,RESOURCE_LOCKED:423,DEPENDENCY_ERROR:424};class f{static generateMeta(a){return{timestamp:new Date().toISOString(),...a}}static success(a,b,c,d=200,e){let f={success:!0,data:b,...c&&{message:c},meta:this.generateMeta(e)};a.status(d).json(f)}static created(a,b,c="Resource created successfully",d){this.success(a,b,c,201,d)}static noContent(a){a.status(204).end()}static paginated(a,b,c,d,e){let f=Math.ceil(c.total/c.pageSize),g={success:!0,data:b,pagination:{...c,totalPages:f},...d&&{message:d},meta:this.generateMeta(e)};a.status(200).json(g)}static error(a,b,c,d,f){let g=e[b]||500,h={success:!1,error:{code:b,message:c,...d&&{details:d}},meta:this.generateMeta(f)};a.status(g).json(h)}static validationError(a,b,c="Validation failed"){this.error(a,"VALIDATION_ERROR",c,b)}static notFound(a,b,c){let d=c?`${b} with identifier '${c}' not found`:`${b} not found`;this.error(a,"NOT_FOUND",d)}static unauthorized(a,b="Authentication required"){this.error(a,"UNAUTHORIZED",b)}static forbidden(a,b="You do not have permission to perform this action"){this.error(a,"FORBIDDEN",b)}static methodNotAllowed(a,b,c){a.setHeader("Allow",c.join(", ")),this.error(a,"METHOD_NOT_ALLOWED",`Method ${b} not allowed. Allowed methods: ${c.join(", ")}`)}static internalError(a,b,c="An internal error occurred"){console.error("Internal Server Error:",b);this.error(a,"INTERNAL_ERROR",c,void 0)}static databaseError(a,b,c="A database error occurred"){console.error("Database Error:",b);this.error(a,"DATABASE_ERROR",c,void 0)}static setCorsHeaders(a,b="*",c=["GET","POST","PUT","DELETE","PATCH","OPTIONS"],d=["Content-Type","Authorization"]){a.setHeader("Access-Control-Allow-Origin",b),a.setHeader("Access-Control-Allow-Methods",c.join(", ")),a.setHeader("Access-Control-Allow-Headers",d.join(", "))}static handleOptions(a){this.setCorsHeaders(a),a.status(200).end()}}let g={success:f.success,created:f.created,noContent:f.noContent,paginated:f.paginated,error:f.error,validationError:f.validationError,notFound:f.notFound,unauthorized:f.unauthorized,forbidden:f.forbidden,methodNotAllowed:f.methodNotAllowed,internalError:f.internalError,databaseError:f.databaseError,setCorsHeaders:f.setCorsHeaders,handleOptions:f.handleOptions}},75600:a=>{a.exports=require("next/dist/compiled/next-server/pages-api.runtime.prod.js")},80949:(a,b,c)=>{c.a(a,async(a,d)=>{try{c.r(b),c.d(b,{config:()=>o,default:()=>n,handler:()=>m});var e=c(29046),f=c(8667),g=c(33480),h=c(86435),i=c(22623),j=c(58112),k=c(18766),l=a([i]);i=(l.then?(await l)():l)[0];let n=(0,h.M)(i,"default"),o=(0,h.M)(i,"config"),p=new g.PagesAPIRouteModule({definition:{kind:f.A.PAGES_API,page:"/api/procurement/rfq",pathname:"/api/procurement/rfq",bundlePath:"",filename:""},userland:i,distDir:".next",relativeProjectDir:""});async function m(a,b,c){let d=await p.prepare(a,b,{srcPage:"/api/procurement/rfq"});if(!d){b.statusCode=400,b.end("Bad Request"),null==c.waitUntil||c.waitUntil.call(c,Promise.resolve());return}let{query:f,params:g,prerenderManifest:h,routerServerContext:i}=d;try{let c=a.method||"GET",d=(0,j.getTracer)(),e=d.getActiveScopeSpan(),l=p.instrumentationOnRequestError.bind(p),m=async e=>p.render(a,b,{query:{...f,...g},params:g,allowedRevalidateHeaderKeys:[],multiZoneDraftMode:!1,trustHostHeader:!1,previewProps:h.preview,propagateError:!1,dev:p.isDev,page:"/api/procurement/rfq",internalRevalidate:null==i?void 0:i.revalidate,onError:(...b)=>l(a,...b)}).finally(()=>{if(!e)return;e.setAttributes({"http.status_code":b.statusCode,"next.rsc":!1});let f=d.getRootSpanAttributes();if(!f)return;if(f.get("next.span_type")!==k.BaseServerSpan.handleRequest)return void console.warn(`Unexpected root span type '${f.get("next.span_type")}'. Please report this Next.js issue https://github.com/vercel/next.js`);let g=f.get("next.route");if(g){let a=`${c} ${g}`;e.setAttributes({"next.route":g,"http.route":g,"next.span_name":a}),e.updateName(a)}else e.updateName(`${c} ${a.url}`)});e?await m(e):await d.withPropagatedContext(a.headers,()=>d.trace(k.BaseServerSpan.handleRequest,{spanName:`${c} ${a.url}`,kind:j.SpanKind.SERVER,attributes:{"http.method":c,"http.target":a.url}},m))}catch(a){if(p.isDev)throw a;(0,e.sendError)(b,500,"Internal Server Error")}finally{null==c.waitUntil||c.waitUntil.call(c,Promise.resolve())}}d()}catch(a){d(a)}})}};var b=require("../../../webpack-api-runtime.js");b.C(a);var c=b.X(0,[7169],()=>b(b.s=80949));module.exports=c})();