"use strict";(()=>{var a={};a.id=6589,a.ids=[6589],a.modules={10762:a=>{a.exports=import("@neondatabase/serverless")},17516:(a,b,c)=>{c.d(b,{Pi:()=>f,rI:()=>g});class d extends Error{constructor(a,b){super(a),this.originalError=b,this.name="DatabaseError"}}async function e(a,b){let{fallbackData:c,logError:e=!0,retryCount:f=1,timeout:g=3e4}=b;for(let b=0;b<=f;b++)try{let b=new Promise((a,b)=>{setTimeout(()=>{b(new d(`Database query timed out after ${g}ms`))},g)});return await Promise.race([a(),b])}catch(a){e&&console.error(`Database query failed (attempt ${b+1}/${f+1}):`,a),b<f&&await new Promise(a=>setTimeout(a,1e3*Math.pow(2,b)))}return e&&console.warn("All database query attempts failed. Returning fallback data."),c}async function f(a,b){return e(a,{...b,fallbackData:[]})}async function g(a,b){try{let c=await e(a,{...b,fallbackData:void 0,logError:b?.logError??!0});if(void 0===c)return{success:!1,error:"Database mutation failed after all retry attempts"};return{success:!0,data:c}}catch(a){return{success:!1,error:a instanceof Error?a.message:"Unknown error occurred"}}}},33462:(a,b,c)=>{c.d(b,{O4:()=>d,aI:()=>g});var d=function(a){return a.BAD_REQUEST="BAD_REQUEST",a.UNAUTHORIZED="UNAUTHORIZED",a.FORBIDDEN="FORBIDDEN",a.NOT_FOUND="NOT_FOUND",a.METHOD_NOT_ALLOWED="METHOD_NOT_ALLOWED",a.CONFLICT="CONFLICT",a.VALIDATION_ERROR="VALIDATION_ERROR",a.RATE_LIMIT="RATE_LIMIT",a.PAYLOAD_TOO_LARGE="PAYLOAD_TOO_LARGE",a.INTERNAL_ERROR="INTERNAL_ERROR",a.DATABASE_ERROR="DATABASE_ERROR",a.SERVICE_UNAVAILABLE="SERVICE_UNAVAILABLE",a.GATEWAY_TIMEOUT="GATEWAY_TIMEOUT",a.BUSINESS_RULE_VIOLATION="BUSINESS_RULE_VIOLATION",a.INSUFFICIENT_PERMISSIONS="INSUFFICIENT_PERMISSIONS",a.RESOURCE_LOCKED="RESOURCE_LOCKED",a.DEPENDENCY_ERROR="DEPENDENCY_ERROR",a}({});let e={BAD_REQUEST:400,UNAUTHORIZED:401,FORBIDDEN:403,NOT_FOUND:404,METHOD_NOT_ALLOWED:405,CONFLICT:409,VALIDATION_ERROR:422,RATE_LIMIT:429,PAYLOAD_TOO_LARGE:413,INTERNAL_ERROR:500,DATABASE_ERROR:500,SERVICE_UNAVAILABLE:503,GATEWAY_TIMEOUT:504,BUSINESS_RULE_VIOLATION:422,INSUFFICIENT_PERMISSIONS:403,RESOURCE_LOCKED:423,DEPENDENCY_ERROR:424};class f{static generateMeta(a){return{timestamp:new Date().toISOString(),...a}}static success(a,b,c,d=200,e){let f={success:!0,data:b,...c&&{message:c},meta:this.generateMeta(e)};a.status(d).json(f)}static created(a,b,c="Resource created successfully",d){this.success(a,b,c,201,d)}static noContent(a){a.status(204).end()}static paginated(a,b,c,d,e){let f=Math.ceil(c.total/c.pageSize),g={success:!0,data:b,pagination:{...c,totalPages:f},...d&&{message:d},meta:this.generateMeta(e)};a.status(200).json(g)}static error(a,b,c,d,f){let g=e[b]||500,h={success:!1,error:{code:b,message:c,...d&&{details:d}},meta:this.generateMeta(f)};a.status(g).json(h)}static validationError(a,b,c="Validation failed"){this.error(a,"VALIDATION_ERROR",c,b)}static notFound(a,b,c){let d=c?`${b} with identifier '${c}' not found`:`${b} not found`;this.error(a,"NOT_FOUND",d)}static unauthorized(a,b="Authentication required"){this.error(a,"UNAUTHORIZED",b)}static forbidden(a,b="You do not have permission to perform this action"){this.error(a,"FORBIDDEN",b)}static methodNotAllowed(a,b,c){a.setHeader("Allow",c.join(", ")),this.error(a,"METHOD_NOT_ALLOWED",`Method ${b} not allowed. Allowed methods: ${c.join(", ")}`)}static internalError(a,b,c="An internal error occurred"){console.error("Internal Server Error:",b);this.error(a,"INTERNAL_ERROR",c,void 0)}static databaseError(a,b,c="A database error occurred"){console.error("Database Error:",b);this.error(a,"DATABASE_ERROR",c,void 0)}static setCorsHeaders(a,b="*",c=["GET","POST","PUT","DELETE","PATCH","OPTIONS"],d=["Content-Type","Authorization"]){a.setHeader("Access-Control-Allow-Origin",b),a.setHeader("Access-Control-Allow-Methods",c.join(", ")),a.setHeader("Access-Control-Allow-Headers",d.join(", "))}static handleOptions(a){this.setCorsHeaders(a),a.status(200).end()}}let g={success:f.success,created:f.created,noContent:f.noContent,paginated:f.paginated,error:f.error,validationError:f.validationError,notFound:f.notFound,unauthorized:f.unauthorized,forbidden:f.forbidden,methodNotAllowed:f.methodNotAllowed,internalError:f.internalError,databaseError:f.databaseError,setCorsHeaders:f.setCorsHeaders,handleOptions:f.handleOptions}},62485:(a,b,c)=>{c.a(a,async(a,d)=>{try{c.r(b),c.d(b,{config:()=>o,default:()=>n,handler:()=>m});var e=c(29046),f=c(8667),g=c(33480),h=c(86435),i=c(87335),j=c(58112),k=c(18766),l=a([i]);i=(l.then?(await l)():l)[0];let n=(0,h.M)(i,"default"),o=(0,h.M)(i,"config"),p=new g.PagesAPIRouteModule({definition:{kind:f.A.PAGES_API,page:"/api/projects",pathname:"/api/projects",bundlePath:"",filename:""},userland:i,distDir:".next",relativeProjectDir:""});async function m(a,b,c){let d=await p.prepare(a,b,{srcPage:"/api/projects"});if(!d){b.statusCode=400,b.end("Bad Request"),null==c.waitUntil||c.waitUntil.call(c,Promise.resolve());return}let{query:f,params:g,prerenderManifest:h,routerServerContext:i}=d;try{let c=a.method||"GET",d=(0,j.getTracer)(),e=d.getActiveScopeSpan(),l=p.instrumentationOnRequestError.bind(p),m=async e=>p.render(a,b,{query:{...f,...g},params:g,allowedRevalidateHeaderKeys:[],multiZoneDraftMode:!1,trustHostHeader:!1,previewProps:h.preview,propagateError:!1,dev:p.isDev,page:"/api/projects",internalRevalidate:null==i?void 0:i.revalidate,onError:(...b)=>l(a,...b)}).finally(()=>{if(!e)return;e.setAttributes({"http.status_code":b.statusCode,"next.rsc":!1});let f=d.getRootSpanAttributes();if(!f)return;if(f.get("next.span_type")!==k.BaseServerSpan.handleRequest)return void console.warn(`Unexpected root span type '${f.get("next.span_type")}'. Please report this Next.js issue https://github.com/vercel/next.js`);let g=f.get("next.route");if(g){let a=`${c} ${g}`;e.setAttributes({"next.route":g,"http.route":g,"next.span_name":a}),e.updateName(a)}else e.updateName(`${c} ${a.url}`)});e?await m(e):await d.withPropagatedContext(a.headers,()=>d.trace(k.BaseServerSpan.handleRequest,{spanName:`${c} ${a.url}`,kind:j.SpanKind.SERVER,attributes:{"http.method":c,"http.target":a.url}},m))}catch(a){if(p.isDev)throw a;(0,e.sendError)(b,500,"Internal Server Error")}finally{null==c.waitUntil||c.waitUntil.call(c,Promise.resolve())}}d()}catch(a){d(a)}})},75600:a=>{a.exports=require("next/dist/compiled/next-server/pages-api.runtime.prod.js")},81761:(a,b,c)=>{c.d(b,{x:()=>d});function d(a){return{userId:"demo-user-123",sessionId:"demo-session",user:{id:"demo-user-123",email:"demo@fibreflow.com",name:"Demo User",role:"admin"}}}},87335:(a,b,c)=>{c.a(a,async(a,d)=>{try{c.r(b),c.d(b,{default:()=>j});var e=c(81761),f=c(10762),g=c(17516),h=c(33462),i=a([f]);f=(i.then?(await i)():i)[0];let k=(0,f.neon)(process.env.DATABASE_URL);async function j(a,b){if(h.aI.setCorsHeaders(b),"OPTIONS"===a.method)return h.aI.handleOptions(b);let{userId:c}=(0,e.x)(a);if(!c)return h.aI.unauthorized(b);try{switch(a.method){case"GET":if(a.query.id){let c=await (0,g.Pi)(async()=>k`
              SELECT p.*, c.client_name 
              FROM projects p
              LEFT JOIN clients c ON p.client_id = c.id::text::uuid
              WHERE p.id = ${a.query.id}
            `,{logError:!0});if(0===c.length)return h.aI.notFound(b,"Project",a.query.id);return h.aI.success(b,c[0])}{let a=await (0,g.Pi)(async()=>k`
              SELECT p.*, c.client_name 
              FROM projects p
              LEFT JOIN clients c ON p.client_id = c.id::text::uuid
              ORDER BY p.created_at DESC NULLS LAST
            `,{logError:!0,retryCount:2});return h.aI.success(b,a||[],0===a.length?"No projects found":void 0)}case"POST":let c=a.body,d=await (0,g.rI)(async()=>k`
            INSERT INTO projects (
              project_code, project_name, client_id, description, 
              project_type, status, priority, start_date, end_date, 
              budget, project_manager, location
            )
            VALUES (
              ${c.project_code}, ${c.project_name}, 
              ${c.client_id}, ${c.description},
              ${c.project_type}, ${c.status||"active"},
              ${c.priority||"medium"}, ${c.start_date},
              ${c.end_date}, ${c.budget},
              ${c.project_manager}, ${c.location}
            )
            RETURNING *
          `,{logError:!0});if(!d.success)return h.aI.databaseError(b,Error(d.error||"Failed to create project"),d.error||"Failed to create project");return h.aI.created(b,d.data?.[0],"Project created successfully");case"PUT":if(!a.query.id)return h.aI.validationError(b,{id:"Project ID is required"});let e=a.body,f=await (0,g.rI)(async()=>k`
            UPDATE projects SET
              project_name = COALESCE(${e.project_name}, project_name),
              client_id = COALESCE(${e.client_id}, client_id),
              description = COALESCE(${e.description}, description),
              project_type = COALESCE(${e.project_type}, project_type),
              status = COALESCE(${e.status}, status),
              priority = COALESCE(${e.priority}, priority),
              start_date = COALESCE(${e.start_date}, start_date),
              end_date = COALESCE(${e.end_date}, end_date),
              budget = COALESCE(${e.budget}, budget),
              project_manager = COALESCE(${e.project_manager}, project_manager),
              location = COALESCE(${e.location}, location),
              updated_at = NOW()
            WHERE id = ${a.query.id}
            RETURNING *
          `,{logError:!0});if(!f.success)return h.aI.databaseError(b,Error(f.error||"Failed to update project"),f.error||"Failed to update project");return h.aI.success(b,f.data?.[0],"Project updated successfully");case"DELETE":if(!a.query.id)return h.aI.validationError(b,{id:"Project ID is required"});let i=await (0,g.rI)(async()=>k`DELETE FROM projects WHERE id = ${a.query.id}`,{logError:!0});if(!i.success)return h.aI.databaseError(b,Error(i.error||"Failed to delete project"),i.error||"Failed to delete project");return h.aI.success(b,null,"Project deleted successfully");default:return h.aI.methodNotAllowed(b,a.method,["GET","POST","PUT","DELETE"])}}catch(a){return h.aI.internalError(b,a)}}d()}catch(a){d(a)}})}};var b=require("../../webpack-api-runtime.js");b.C(a);var c=b.X(0,[7169],()=>b(b.s=62485));module.exports=c})();