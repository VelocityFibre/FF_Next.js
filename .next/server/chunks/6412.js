"use strict";exports.id=6412,exports.ids=[6412],exports.modules={25269:(a,b,c)=>{c.a(a,async(a,d)=>{try{c.d(b,{M:()=>l});var e=c(8732),f=c(74952),g=c(44233),h=c(82015),i=c(77020),j=a([i]);i=(j.then?(await j)():j)[0];let k=(0,h.memo)(({title:a,value:b,icon:c,color:d,trend:j,subtitle:k,description:l,route:m,onClick:n,isLoading:o=!1,error:p=null,className:q,variant:r="default",showTrend:s=!0,formatValue:t})=>{let u=(0,g.useRouter)(),v=(0,h.useCallback)(()=>{!p&&(n?n():m&&u.push(m))},[n,m,u,p]),w=t?t(b):"number"==typeof b?b.toLocaleString():b,x=()=>{if(!j)return null;switch(j.direction){case"up":return(0,e.jsx)(f.ntg,{className:"w-4 h-4 text-green-500"});case"down":return(0,e.jsx)(f.klo,{className:"w-4 h-4 text-red-500"});case"stable":return(0,e.jsx)(f.Hsy,{className:"w-4 h-4 text-gray-500"});default:return null}},y=()=>{if(!j)return"text-gray-500";switch(j.direction){case"up":return"text-green-600";case"down":return"text-red-600";default:return"text-gray-600"}};return o?(0,e.jsxs)("div",{className:(0,i.cn)("bg-white rounded-lg border border-gray-200 shadow-sm","animate-pulse","compact"===r?"p-4":"p-6",q),children:[(0,e.jsxs)("div",{className:"flex items-start justify-between mb-4",children:[(0,e.jsxs)("div",{className:"flex-1",children:[(0,e.jsx)("div",{className:"h-4 bg-gray-200 rounded w-3/4 mb-2"}),"compact"!==r&&(0,e.jsx)("div",{className:"h-3 bg-gray-200 rounded w-1/2"})]}),(0,e.jsx)("div",{className:"w-12 h-12 bg-gray-200 rounded-lg"})]}),(0,e.jsxs)("div",{className:"space-y-2",children:[(0,e.jsx)("div",{className:"h-8 bg-gray-200 rounded w-1/2"}),"detailed"===r&&(0,e.jsx)("div",{className:"h-3 bg-gray-200 rounded w-1/3"})]})]}):p?(0,e.jsxs)("div",{className:(0,i.cn)("bg-red-50 border border-red-200 rounded-lg","compact"===r?"p-4":"p-6",q),children:[(0,e.jsxs)("div",{className:"flex items-center space-x-2 text-red-600",children:[(0,e.jsx)(f.RIJ,{className:"w-5 h-5"}),(0,e.jsxs)("span",{className:"text-sm font-medium",children:["Error loading ",a]})]}),(0,e.jsx)("p",{className:"text-xs text-red-500 mt-1 truncate",children:p})]}):(0,e.jsxs)("div",{className:(0,i.cn)("group relative overflow-hidden bg-white rounded-lg border border-gray-200 shadow-sm","hover:shadow-md transition-all duration-200",(n||m)&&!p&&"cursor-pointer hover:border-gray-300","compact"===r&&"p-4","compact"!==r&&"p-6",q),onClick:v,children:[(0,e.jsx)("div",{className:"absolute top-0 left-0 right-0 h-1 rounded-t-lg",style:{backgroundColor:d}}),(0,e.jsxs)("div",{children:[(0,e.jsxs)("div",{className:"flex items-start justify-between mb-4",children:[(0,e.jsxs)("div",{className:"flex-1 min-w-0",children:[(0,e.jsx)("h3",{className:(0,i.cn)("font-semibold text-gray-900 truncate","compact"===r?"text-base":"text-lg"),children:a}),k&&"compact"!==r&&(0,e.jsx)("p",{className:"text-sm text-gray-600 mt-1 leading-relaxed",children:k})]}),(0,e.jsx)("div",{className:(0,i.cn)("flex-shrink-0 rounded-lg flex items-center justify-center ml-4","compact"===r?"w-10 h-10":"w-12 h-12"),style:{backgroundColor:d},children:(0,e.jsx)(c,{className:(0,i.cn)("text-white","compact"===r?"w-5 h-5":"w-6 h-6")})})]}),(0,e.jsxs)("div",{className:"space-y-2",children:[(0,e.jsx)("div",{className:"flex items-baseline",children:(0,e.jsx)("span",{className:(0,i.cn)("font-bold text-gray-900","compact"===r?"text-2xl":"text-3xl"),children:w})}),"detailed"===r&&(0,e.jsxs)("div",{className:"space-y-1",children:[s&&j&&(0,e.jsxs)("div",{className:"flex items-center space-x-1",children:[x(),(0,e.jsxs)("span",{className:(0,i.cn)("text-sm font-medium",y()),children:[j.percentage>0?"+":"",j.percentage.toFixed(1),"%",j.label&&` ${j.label}`]})]}),l&&(0,e.jsx)("p",{className:"text-sm text-gray-500",children:l})]}),"detailed"!==r&&s&&j&&(0,e.jsxs)("div",{className:"flex items-center space-x-1",children:[x(),(0,e.jsxs)("span",{className:(0,i.cn)("text-xs font-medium",y()),children:[j.percentage>0?"+":"",j.percentage.toFixed(1),"%"]})]})]})]}),(0,e.jsx)("div",{className:"absolute inset-0 bg-gradient-to-r from-transparent to-transparent group-hover:from-white/5 group-hover:to-transparent transition-all duration-200 pointer-events-none"})]})}),l=(0,h.memo)(({cards:a,columns:b=3,className:c})=>(0,e.jsx)("div",{className:(0,i.cn)("grid gap-6",(()=>{switch(b){case 2:return"grid-cols-1 md:grid-cols-2";case 3:default:return"grid-cols-1 md:grid-cols-2 lg:grid-cols-3";case 4:return"grid-cols-1 md:grid-cols-2 lg:grid-cols-4";case 5:return"grid-cols-1 md:grid-cols-2 lg:grid-cols-3 xl:grid-cols-5";case 6:return"grid-cols-1 md:grid-cols-2 lg:grid-cols-3 xl:grid-cols-6"}})(),c),children:a.map((a,b)=>(0,e.jsx)(k,{...a},`${a.title}-${b}`))}));l.displayName="StatsGrid",d()}catch(a){d(a)}})},38268:(a,b,c)=>{c.d(b,{e6:()=>h,ni:()=>i,tu:()=>j});var d=c(82015),e=c(70039),f=c(49888);class g{static async getDashboardStats(){try{let a=await e.L.getDashboardStats();return{totalProjects:a.totalProjects,activeProjects:a.activeProjects,completedProjects:a.completedProjects,completedTasks:a.completedTasks,teamMembers:a.teamMembers,openIssues:a.openIssues,polesInstalled:a.polesInstalled,dropsCompleted:a.dropsCompleted,fiberInstalled:a.fiberInstalled,totalRevenue:a.totalRevenue,contractorsActive:a.contractorsActive,contractorsPending:a.contractorsPending,boqsActive:a.boqsActive,rfqsActive:a.rfqsActive,supplierActive:a.supplierActive,reportsGenerated:a.reportsGenerated,performanceScore:a.performanceScore,qualityScore:a.qualityScore,onTimeDelivery:a.onTimeDelivery,budgetUtilization:a.budgetUtilization}}catch(a){return f.Rm.error("Error fetching dashboard statistics:",{data:a},"dashboardStatsService"),this.getEmptyStats()}}static async getProjectStatistics(){try{let a=await ProjectQueryService.getAllProjects(),b=await ProjectQueryService.getActiveProjects(),c=a.filter(a=>a.status===ProjectStatus.COMPLETED),d=a.reduce((a,b)=>a+(b.budget||0),0),e=c.reduce((a,b)=>a+(b.budget||0),0),f=c.filter(a=>{if(!a.endDate||!a.actualEndDate)return!1;let b=a.actualEndDate instanceof Date?a.actualEndDate:"string"==typeof a.actualEndDate?new Date(a.actualEndDate):a.actualEndDate?.toDate?.()||new Date,c=a.endDate instanceof Date?a.endDate:"string"==typeof a.endDate?new Date(a.endDate):a.endDate?.toDate?.()||new Date;return b<=c}),g=c.length>0?f.length/c.length*100:0;return{total:a.length,active:b.length,completed:c.length,completedTasks:this.calculateCompletedTasks(a),performanceScore:this.calculatePerformanceScore(a),qualityScore:this.calculateQualityScore(c),onTimeDelivery:g,budgetUtilization:d>0?e/d*100:0}}catch(a){return f.Rm.error("Error getting project statistics:",{data:a},"dashboardStatsService"),{total:0,active:0,completed:0,completedTasks:0,performanceScore:0,qualityScore:0,onTimeDelivery:0,budgetUtilization:0}}}static async getStaffStatistics(){try{return{total:(await staffQueryService.getStaffSummary()).activeStaff,openIssues:0}}catch(a){return f.Rm.error("Error getting staff statistics:",{data:a},"dashboardStatsService"),{total:0,openIssues:0}}}static async getClientStatistics(){try{let a=await clientQueryService.getClientSummary();return{totalRevenue:a.totalProjectValue,activeClients:a.activeClients}}catch(a){return f.Rm.error("Error getting client statistics:",{data:a},"dashboardStatsService"),{totalRevenue:0,activeClients:0}}}static async getInfrastructureStatistics(){try{let a=(await sql`
        SELECT 
          COALESCE(SUM(CASE WHEN type = 'pole' THEN quantity ELSE 0 END), 0) as poles,
          COALESCE(SUM(CASE WHEN type = 'drop' THEN quantity ELSE 0 END), 0) as drops,
          COALESCE(SUM(CASE WHEN type = 'fiber' THEN length ELSE 0 END), 0) as fiber
        FROM infrastructure_installations 
        WHERE status = 'completed'
      `.catch(()=>[{poles:0,drops:0,fiber:0}]))[0]||{poles:0,drops:0,fiber:0};return{poles:parseInt(a.poles)||0,drops:parseInt(a.drops)||0,fiber:parseInt(a.fiber)||0}}catch(a){return{poles:0,drops:0,fiber:0}}}static async getProcurementStatistics(){try{let[a,b,c,d]=await Promise.all([sql`SELECT COUNT(*) as count FROM boqs WHERE status = 'active'`.catch(()=>[{count:0}]),sql`SELECT COUNT(*) as count FROM rfqs WHERE status = 'active'`.catch(()=>[{count:0}]),sql`SELECT COUNT(*) as count FROM suppliers WHERE status = 'active'`.catch(()=>[{count:0}]),sql`
          SELECT 
            COUNT(CASE WHEN status = 'active' THEN 1 END) as active,
            COUNT(CASE WHEN status = 'pending' THEN 1 END) as pending
          FROM contractors
        `.catch(()=>[{active:0,pending:0}])]);return{boqsActive:parseInt(a[0]?.count)||0,rfqsActive:parseInt(b[0]?.count)||0,suppliersActive:parseInt(c[0]?.count)||0,contractorsActive:parseInt(d[0]?.active)||0,contractorsPending:parseInt(d[0]?.pending)||0,reportsGenerated:0}}catch(a){return{boqsActive:0,rfqsActive:0,suppliersActive:0,contractorsActive:0,contractorsPending:0,reportsGenerated:0}}}static calculateCompletedTasks(a){return 5*a.filter(a=>"COMPLETED"===a.status||"FINISHED"===a.status).length}static calculatePerformanceScore(a){if(0===a.length)return 0;let b=a.filter(a=>"COMPLETED"===a.status||"FINISHED"===a.status);return 0===b.length?0:Math.min(b.length/a.length*100,100)}static calculateQualityScore(a){return a.length,0}static async getDashboardTrends(){try{let a=new Date().toISOString(),b=new Date(Date.now()-2592e6).toISOString(),c=await e.L.getDashboardTrends(b,a,"monthly"),d={},f=await this.getDashboardStats();return Object.entries(f).forEach(([a,b])=>{let e=c.projects?.trends?.[a]||c.revenue?.trends?.[a]||c.staff?.trends?.[a];d[a]={value:"number"==typeof b?b:0,direction:e||"stable",percentage:0}}),d}catch(c){f.Rm.error("Error fetching dashboard trends:",{data:c},"dashboardStatsService");let a=await this.getDashboardStats(),b={};return Object.entries(a).forEach(([a,c])=>{b[a]={value:"number"==typeof c?c:0,direction:"stable",percentage:0}}),b}}static getEmptyStats(){return{totalProjects:0,activeProjects:0,completedProjects:0,completedTasks:0,teamMembers:0,openIssues:0,polesInstalled:0,dropsCompleted:0,fiberInstalled:0,totalRevenue:0,contractorsActive:0,contractorsPending:0,boqsActive:0,rfqsActive:0,supplierActive:0,reportsGenerated:0,performanceScore:0,qualityScore:0,onTimeDelivery:0,budgetUtilization:0}}}function h(){let[a,b]=(0,d.useState)({stats:{totalProjects:0,activeProjects:0,completedProjects:0,completedTasks:0,teamMembers:0,openIssues:0,polesInstalled:0,dropsCompleted:0,fiberInstalled:0,totalRevenue:0,contractorsActive:0,contractorsPending:0,boqsActive:0,rfqsActive:0,supplierActive:0,reportsGenerated:0,performanceScore:0,qualityScore:0,onTimeDelivery:0,budgetUtilization:0},trends:{},isLoading:!0,error:null,lastUpdated:null}),c=(0,d.useCallback)(async()=>{try{b(a=>({...a,isLoading:!0,error:null}));let[a,c]=await Promise.all([g.getDashboardStats(),g.getDashboardTrends()]);b({stats:a,trends:c,isLoading:!1,error:null,lastUpdated:new Date})}catch(a){f.Rm.error("Failed to load dashboard data:",{data:a},"useDashboardData"),b(b=>({...b,isLoading:!1,error:a instanceof Error?a.message:"Failed to load dashboard data"}))}},[]),e=(0,d.useCallback)(a=>a>=1e6?`${(a/1e6).toFixed(1)}M`:a>=1e3?`${(a/1e3).toFixed(1)}K`:a.toString(),[]),h=(0,d.useCallback)(a=>new Intl.NumberFormat("en-ZA",{style:"currency",currency:"ZAR",minimumFractionDigits:0,maximumFractionDigits:0}).format(a),[]),i=(0,d.useCallback)(a=>`${a.toFixed(1)}%`,[]),j=(0,d.useCallback)(a=>{switch(a){case"up":return"text-green-600";case"down":return"text-red-600";default:return"text-gray-600"}},[]),k=(0,d.useCallback)(a=>{switch(a){case"up":return"↗";case"down":return"↘";default:return"→"}},[]);return{...a,loadDashboardData:c,formatNumber:e,formatCurrency:h,formatPercentage:i,getTrendColor:j,getTrendIcon:k}}function i(){let a=h(),b={activeProjects:a.stats.activeProjects,teamMembers:a.stats.teamMembers,completedTasks:a.stats.completedTasks,openIssues:a.stats.openIssues,polesInstalled:a.stats.polesInstalled,totalRevenue:a.stats.totalRevenue,qualityScore:a.stats.qualityScore,onTimeDelivery:a.stats.onTimeDelivery,performanceScore:a.stats.performanceScore};return{...a,stats:b}}function j(){let a=h(),b={reportsGenerated:a.stats.reportsGenerated,activeProjects:a.stats.activeProjects,totalRevenue:a.stats.totalRevenue,performanceScore:a.stats.performanceScore,completedTasks:a.stats.completedTasks,teamMembers:a.stats.teamMembers};return{...a,stats:b}}},48053:(a,b,c)=>{c.d(b,{Pj:()=>e,Sl:()=>f,ZM:()=>g});var d=c(74952);let e=(a,b,c)=>[{title:"Active Projects",value:a.activeProjects,icon:d.BmN,color:"#3B82F6",trend:b.activeProjects,subtitle:"Currently in progress",description:"Projects actively being worked on",route:"/app/projects",variant:"detailed",formatValue:c.formatNumber},{title:"Team Members",value:a.teamMembers,icon:d.zWC,color:"#10B981",trend:b.teamMembers,subtitle:"Active staff",description:"Total active team members",route:"/app/staff",variant:"detailed",formatValue:c.formatNumber},{title:"Completed Tasks",value:a.completedTasks,icon:d.rAV,color:"#059669",trend:b.completedTasks,subtitle:"This month",description:"Successfully completed tasks",route:"/app/tasks",variant:"detailed",formatValue:c.formatNumber},{title:"Open Issues",value:a.openIssues,icon:d.hcu,color:"#F59E0B",trend:b.openIssues,subtitle:"Requires attention",description:"Issues awaiting resolution",route:"/app/issues",variant:"detailed",formatValue:c.formatNumber},{title:"Poles Installed",value:a.polesInstalled,icon:d.sDd,color:"#8B5CF6",trend:b.polesInstalled,subtitle:"Total installed",description:"Infrastructure deployment progress",route:"/app/projects/pole-tracker",variant:"detailed",formatValue:c.formatNumber},{title:"Total Revenue",value:a.totalRevenue,icon:d.G9t,color:"#059669",trend:b.totalRevenue,subtitle:"This month",description:"Revenue generated from projects",route:"/app/analytics",variant:"detailed",formatValue:c.formatCurrency}],f=(a,b,c)=>[{title:"Total Poles",value:a.polesInstalled,icon:d.sDd,color:"#3B82F6",trend:b.polesInstalled,subtitle:"Infrastructure deployed",description:"Total poles installed across projects",route:"/app/projects/pole-tracker",variant:"detailed",formatValue:c.formatNumber},{title:"Total Drops",value:a.dropsCompleted,icon:d.MJO,color:"#8B5CF6",trend:b.dropsCompleted,subtitle:"Connections made",description:"Customer connections completed",route:"/app/projects/drops",variant:"detailed",formatValue:c.formatNumber},{title:"Fiber Installed",value:a.fiberInstalled,icon:d.Ilq,color:"#F59E0B",trend:b.fiberInstalled,subtitle:"Meters deployed",description:"Total fiber optic cable installed",route:"/app/projects/fiber",variant:"detailed",formatValue:a=>`${c.formatNumber(a)}m`},{title:"Revenue",value:a.totalRevenue,icon:d.G9t,color:"#10B981",trend:b.totalRevenue,subtitle:"Total earnings",description:"Revenue from all projects",route:"/app/analytics/revenue",variant:"detailed",formatValue:c.formatCurrency},{title:"Active Teams",value:a.teamMembers,icon:d.zWC,color:"#059669",trend:b.teamMembers,subtitle:"Working teams",description:"Teams currently active",route:"/app/staff/teams",variant:"detailed",formatValue:c.formatNumber}],g=(a,b,c)=>[{title:"Reports Generated",value:a.reportsGenerated,icon:d.iUU,color:"#3B82F6",trend:b.reportsGenerated,subtitle:"This month",description:"Reports created and generated",route:"/app/reports",variant:"detailed",formatValue:c.formatNumber},{title:"Active Projects",value:a.activeProjects,icon:d.BmN,color:"#8B5CF6",trend:b.activeProjects,subtitle:"Being tracked",description:"Projects included in reports",route:"/app/projects",variant:"detailed",formatValue:c.formatNumber},{title:"Revenue Tracked",value:a.totalRevenue,icon:d.G9t,color:"#10B981",trend:b.totalRevenue,subtitle:"Financial data",description:"Revenue tracked in reports",route:"/app/reports/financial",variant:"detailed",formatValue:c.formatCurrency},{title:"Performance Score",value:a.performanceScore,icon:d.ntg,color:"#F59E0B",trend:b.performanceScore,subtitle:"Overall rating",description:"Average performance metrics",route:"/app/reports/performance",variant:"detailed",formatValue:c.formatPercentage},{title:"Data Points",value:a.completedTasks,icon:d.WmV,color:"#6B7280",trend:b.completedTasks,subtitle:"Tracked metrics",description:"Total data points collected",route:"/app/reports/data",variant:"detailed",formatValue:c.formatNumber},{title:"Team Coverage",value:a.teamMembers,icon:d.ekZ,color:"#059669",trend:b.teamMembers,subtitle:"Members reporting",description:"Team members in reports",route:"/app/reports/teams",variant:"detailed",formatValue:c.formatNumber}]},70039:(a,b,c)=>{c.d(b,{L:()=>e});class d{async fetch(a,b){try{let c=await fetch(`/api${a}`,{...b,headers:{"Content-Type":"application/json",...b?.headers}});if(!c.ok)throw Error(`API request failed: ${c.status} ${c.statusText}`);let d=await c.json();if(!d.success)throw Error(d.error||"API request failed");return d.data||d}catch(b){throw console.error(`Analytics API error (${a}):`,b),b}}async getDashboardStats(a){let b=new URLSearchParams;return a?.startDate&&b.append("startDate",a.startDate),a?.endDate&&b.append("endDate",a.endDate),this.fetch(`/analytics/dashboard/stats?${b}`)}async getDashboardSummary(a){let b=new URLSearchParams({period:a.type});return this.fetch(`/analytics/dashboard/summary?${b}`)}async getDashboardTrends(a,b,c="month"){let d=new URLSearchParams({startDate:a,endDate:b,groupBy:c});return this.fetch(`/analytics/dashboard/trends?${d}`)}async getProjectSummary(a){let b=new URLSearchParams;return a&&b.append("projectId",a),this.fetch(`/analytics/projects/summary?${b}`)}async getProjectPerformance(a,b){let c=new URLSearchParams({projectId:a,metrics:b.join(",")});return this.fetch(`/analytics/projects/performance?${c}`)}async getProjectTrends(a,b){let c=new URLSearchParams({projectId:a,period:b.type,...b.startDate&&{startDate:b.startDate},...b.endDate&&{endDate:b.endDate}});return this.fetch(`/analytics/projects/trends?${c}`)}async compareProjects(a,b){return this.fetch("/analytics/projects/comparison",{method:"POST",body:JSON.stringify({projectIds:a,metrics:b})})}async getKPIs(a){let b=new URLSearchParams;return a&&b.append("category",a),this.fetch(`/analytics/kpis?${b}`)}async calculateKPIs(a,b){return this.fetch("/analytics/kpis/calculate",{method:"POST",body:JSON.stringify({kpiIds:a,parameters:b})})}async getKPITargets(){return this.fetch("/analytics/kpis/targets")}async setKPITargets(a){return this.fetch("/analytics/kpis/targets",{method:"POST",body:JSON.stringify({targets:a})})}async getStaffStatistics(a){let b=new URLSearchParams;return a&&b.append("filters",JSON.stringify(a)),this.fetch(`/analytics/staff/statistics?${b}`)}async getStaffPerformance(a,b){let c=new URLSearchParams;return a&&c.append("staffId",a),b&&c.append("period",b.type),this.fetch(`/analytics/staff/performance?${c}`)}async getStaffTrends(a,b=12){let c=new URLSearchParams({months:b.toString()});return a&&c.append("department",a),this.fetch(`/analytics/staff/trends?${c}`)}async getTeamAnalytics(a){let b=new URLSearchParams;return a&&b.append("teamId",a),this.fetch(`/analytics/staff/teams?${b}`)}async getUtilizationRates(a,b){let c=new URLSearchParams({period:a.type});return b&&c.append("department",b),a.startDate&&c.append("startDate",a.startDate),a.endDate&&c.append("endDate",a.endDate),this.fetch(`/analytics/staff/utilization?${c}`)}async getFinancialSummary(a,b,c){let d=new URLSearchParams({period:a.type});return b&&d.append("projectId",b),c&&d.append("clientId",c),this.fetch(`/analytics/financial/summary?${d}`)}async getBudgetAnalysis(a,b,c){let d=new URLSearchParams;return a&&d.append("projectId",a),b&&d.append("clientId",b),c&&d.append("department",c),this.fetch(`/analytics/financial/budgets?${d}`)}async generateReport(a,b){return this.fetch("/analytics/reports/generate",{method:"POST",body:JSON.stringify({reportType:a,parameters:b})})}}let e=new d}};